<article xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" article-type="research-article"><?properties open_access?><?DTDIdentifier.IdentifierValue -//NLM//DTD Journal Publishing DTD v2.3 20070202//EN?><?DTDIdentifier.IdentifierType public?><?SourceDTD.DTDName journalpublishing.dtd?><?SourceDTD.Version 2.3?><?ConverterInfo.XSLTName jp2nlmx2.xsl?><?ConverterInfo.Version 2?><front><journal-meta><journal-id journal-id-type="nlm-ta">J Appl Crystallogr</journal-id><journal-id journal-id-type="publisher-id">J. Appl. Cryst.</journal-id><journal-title-group><journal-title>Journal of Applied Crystallography</journal-title></journal-title-group><issn pub-type="ppub">0021-8898</issn><publisher><publisher-name>International Union of Crystallography</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="pmcid">2875182</article-id><article-id pub-id-type="publisher-id">ea5118</article-id><article-id pub-id-type="doi">10.1107/S0021889810010782</article-id><article-id pub-id-type="coden">JACGAR</article-id><article-id pub-id-type="pii">S0021889810010782</article-id><article-categories><subj-group subj-group-type="heading"><subject>Research Papers</subject></subj-group></article-categories><title-group><article-title>Autoindexing with outlier rejection and identification of superimposed lattices</article-title><alt-title>Autoindexing with outlier rejection</alt-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Sauter</surname><given-names>Nicholas K.</given-names></name><xref ref-type="aff" rid="a">a</xref><xref ref-type="corresp" rid="cor">*</xref></contrib><contrib contrib-type="author"><name><surname>Poon</surname><given-names>Billy K.</given-names></name><xref ref-type="aff" rid="a">a</xref></contrib><aff id="a"><label>a</label>Physical Biosciences Division, Lawrence Berkeley National Laboratory, One Cyclotron Road, Berkeley, CA 94720, <country>USA</country></aff></contrib-group><author-notes><corresp id="cor">Correspondence e-mail: <email>nksauter@lbl.gov</email></corresp></author-notes><pub-date pub-type="ppub"><day>01</day><month>6</month><year>2010</year></pub-date><pub-date pub-type="epub"><day>30</day><month>4</month><year>2010</year></pub-date><pub-date pub-type="pmc-release"><day>30</day><month>4</month><year>2010</year></pub-date><!-- PMC Release delay is 0 months and 0 days and was based on the
							<pub-date pub-type="epub"/>. --><volume>43</volume><issue>Pt 3</issue><issue-id pub-id-type="publisher-id">j100300</issue-id><fpage>611</fpage><lpage>616</lpage><history><date date-type="received"><day>06</day><month>1</month><year>2010</year></date><date date-type="accepted"><day>22</day><month>3</month><year>2010</year></date></history><permissions><copyright-statement>&#169; Sauter and Poon 2010</copyright-statement><copyright-year>2010</copyright-year><license license-type="open-access" xlink:href="http://creativecommons.org/licenses/by/2.0/uk/"><license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution Licence, which permits unrestricted use, distribution, and reproduction in any medium, provided the original authors and source are cited.</license-p></license></permissions><self-uri xlink:type="simple" xlink:href="http://dx.doi.org/10.1107/S0021889810010782">A full version of this article is available from Crystallography Journals Online.</self-uri><abstract abstract-type="toc"><p>After autoindexing, Bragg spot candidates that do not fit on the model lattice can be identified, providing a potentially useful measure of sample quality and giving an avenue for indexing a second lattice, if one is present.</p></abstract><abstract><p>Constructing a model lattice to fit the observed Bragg diffraction pattern is straightforward for perfect samples, but indexing can be challenging when artifacts are present, such as poorly shaped spots, split crystals giving multiple closely aligned lattices and outright superposition of patterns from aggregated microcrystals. To optimize the lattice model against marginal data, refinement can be performed using a subset of the observations from which the poorly fitting spots have been discarded. Outliers are identified by assuming a Gaussian error distribution for the best-fitting spots and points diverging from this distribution are culled. The set of remaining observations produces a superior lattice model, while the rejected observations can be used to identify a second crystal lattice, if one is present. The prevalence of outliers provides a potentially useful measure of sample quality. The described procedures are implemented for macromolecular crystallography within the autoindexing program <italic>labelit.index</italic> (<ext-link ext-link-type="uri" xlink:href="http://cci.lbl.gov/labelit">http://cci.lbl.gov/labelit</ext-link>).</p></abstract><kwd-group><kwd>autoindexing</kwd><kwd>outlier rejection</kwd><kwd>superimposed lattices</kwd><kwd>sample quality</kwd></kwd-group></article-meta></front><body><sec id="sec1" sec-type="introduction"><label>1.</label><title>Introduction</title><p>&#8216;How good is this sample?&#8217; and &#8216;How well does the model fit the data?&#8217; are pertinent questions throughout the process of structure solution, driving critical experimental decisions even at the initial step of eliciting the crystal lattice from the raw diffraction image. Algorithms for determining and refining the lattice description are well understood, and are implemented by many data-processing packages such as <italic>MOSFLM</italic> (Leslie, 1999<xref ref-type="bibr" rid="bb14"> &#9654;</xref>), <italic>HKL</italic> (Otwinowski &amp; Minor, 1997<xref ref-type="bibr" rid="bb16"> &#9654;</xref>), <italic>XDS</italic> (Kabsch, 2010<italic>a</italic>
            <xref ref-type="bibr" rid="bb12"> &#9654;</xref>,<italic>b</italic>
            <xref ref-type="bibr" rid="bb13"> &#9654;</xref>) and <italic>d*TREK</italic> (Pflugrath, 1999<xref ref-type="bibr" rid="bb18"> &#9654;</xref>). Generally, candidate Bragg spots are selected from the diffraction image and their observed laboratory coordinates are converted into reciprocal space by an appropriate geometric construction (Arndt &amp; Wonacott, 1977<xref ref-type="bibr" rid="bb3"> &#9654;</xref>; reviewed by Dauter, 1999<xref ref-type="bibr" rid="bb6"> &#9654;</xref>). Lattice periodicity is detected by one of several autoindexing procedures (<italic>e.g.</italic> Steller <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb27"> &#9654;</xref>), leading to a lattice model with nine degrees of freedom: three unit-cell lengths, three unit-cell angles and three librations of the lattice with respect to the laboratory axes (Fig. 1<xref ref-type="fig" rid="fig1"> &#9654;</xref>
            <italic>a</italic>). The predictive power of the lattice model makes accurate data integration possible; in particular, it is used to deduce image coordinates for all of the reflections (Rossmann &amp; van Beek, 1999<xref ref-type="bibr" rid="bb21"> &#9654;</xref>), even those with a low intensity level that would not otherwise be distinguishable from the background level.</p><p>The unit-cell model, or rather seven of its nine degrees of freedom (cell lengths, cell angles and libration about the<italic> z</italic> axis or direction of incident X-rays) are readily optimized, since they produce direct changes in the expected Bragg spot positions. By comparing the predicted and observed Bragg positions, a best-fit model can be obtained by least-squares refinement. High-accuracy refinements of librations about the <italic>x</italic> and<italic> y</italic> axes are outside the scope of this paper, as small rotations about these axes do not produce first-order changes in the expected spot positions. The accepted approach in this regard is to integrate the Bragg intensities over a full or partial data set, giving spot-intensity profiles over a sequence of <italic>y</italic> rotations. These profiles determine high-accuracy <italic>x</italic>- and <italic>y</italic>-rotational orientations through a post-refinement algorithm (Rossmann <italic>et al.</italic>, 1979<xref ref-type="bibr" rid="bb20"> &#9654;</xref>; Winkler <italic>et al.</italic>, 1979<xref ref-type="bibr" rid="bb29"> &#9654;</xref>), and the resulting lattice model is then used as the basis for a second, more accurate, round of integration.</p><p>This paper focuses only on what is achievable with the observed center-of-mass spot positions from the best-measured spots (Fig. 2<xref ref-type="fig" rid="fig2"> &#9654;</xref>
            <italic>a</italic>). There is good reason to emphasize this initial characterization of raw images (prior to data reduction), since high-throughput crystal screening is relied upon increasingly to identify the best crystalline samples prior to the collection of full data sets. Crystal screening, which is now a standard option at many synchroton beamlines (Soltis <italic>et al.</italic>, 2008<xref ref-type="bibr" rid="bb26"> &#9654;</xref>), examines numerous samples sequentially under robotic control. A typical protocol involves the collection of two diffraction patterns spaced 90&#176; apart on the <italic>y</italic>-rotational axis, which is enough data to gain a general understanding of the quality of the sample. Software server frameworks such as <italic>Web-Ice</italic> (Gonz&#225;lez <italic>et al.</italic>, 2008<xref ref-type="bibr" rid="bb9"> &#9654;</xref>) or <italic>EDNA</italic> (Incardona <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb11"> &#9654;</xref>) execute autoindexing trials for each crystal, generating a summary report that lists characteristics such as the signal strength and limiting resolution. One important quality measure is the r.m.s. deviation (in laboratory space) between the observed and predicted positions of the best-measured spots. Even in the absence of post-refinement, the lattice model ought to predict spot positions with sub-pixel accuracy, so in the best cases the r.m.s. spot displacement is expected to be less than the CCD pixel size, typically about 100&#8197;&#181;m.</p><p>In less favorable cases, it is challenging to refine the lattice model in a well behaved manner. If the operative method is to minimize the variance <inline-formula><inline-graphic xlink:href="j-43-00611-efi1.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> between observed spot centroids <bold>r</bold>
            <sub>obs</sub> and predicted spot positions <bold>r</bold>
            <sub>calc</sub> for the <italic>N</italic> best-measured spots, <disp-formula id="fd1"><graphic xlink:href="j-43-00611-efd1"/></disp-formula>then one must check the implicit assumption that the observations have been paired with the correct Miller index <bold>h</bold>
            <sub><italic>i</italic></sub>. This assumption breaks down for many experimental samples where Miller indices are difficult or impossible to assign. One example is seen in Fig. 2<xref ref-type="fig" rid="fig2"> &#9654;</xref>, where the lattice may be modulated (Wagner &amp; Sch&#246;nleber, 2009<xref ref-type="bibr" rid="bb28"> &#9654;</xref>), generating satellite spots and streaks that are spaced along the <italic>c</italic>* axis. Another problematic phenomenon (&#167;3<xref ref-type="sec" rid="sec3"/>) is the superposition of multiple lattices, which requires a decision as to which spots to associate with a given lattice model. Clearly, in these cases, the assignment of observations to the wrong Miller index will artificially inflate the r.m.s. deviation value [which is &#963;<sub><italic>r</italic></sub> in equation (1)<xref ref-type="disp-formula" rid="fd1"/>]. Moreover, the refined lattice model will be biased by the outliers, thus degrading any crystal quality measures that depend on an accurate knowledge of the lattice (including the signal strength and limiting resolution). Here we develop a simple statistical test to decide, automatically, which observations should be included in equation (1)<xref ref-type="disp-formula" rid="fd1"/> and which should be rejected as outliers, thus improving the general computational outcome.</p></sec><sec id="sec2"><label>2.</label><title>Computational methods</title><p>Raw diffraction images for a number of published protein structures were downloaded from the Joint Center for Structural Genomics (JCSG; <ext-link ext-link-type="uri" xlink:href="http://www.jcsg.org">http://www.jcsg.org</ext-link>) to be used as test cases. Images from hen egg-white lysozyme containing superimposed lattices from two crystals were obtained by Peter Zwart at Beamline 5.0.1 of the Advanced Light Source at Berkeley. Software development was greatly facilitated by the framework provided by the open-source Computational Crystallography Toolbox (<italic>cctbx</italic>; Grosse-Kunstleve <italic>et al.</italic>, 2002<xref ref-type="bibr" rid="bb10"> &#9654;</xref>).</p><p>Raw data are analyzed with a spot-finding program (<italic>DISTL</italic>; Zhang <italic>et al.</italic>, 2006<xref ref-type="bibr" rid="bb31"> &#9654;</xref>), with a view to eliminating various types of signal artifacts prior to any further analysis. The rules applied (determined by trial and error) have been described elsewhere (Sauter <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb22"> &#9654;</xref>; Sauter &amp; Zwart, 2009<xref ref-type="bibr" rid="bb24"> &#9654;</xref>) and are only briefly repeated here. Spots are retained for analysis only if they have smooth profiles that are well separated from their neighbors. Falloff of the spot count as a function of resolution is used to determine conservative outer- and inner-resolution cutoffs. Additional filters reject spots that are unusually intense, large or small in pixel area, or skewed in shape. Spots are ignored if they are too close to the rotation spindle for accurate positional evaluation.</p><p>Further analysis is performed on the spots once the tentative lattice model is established by autoindexing. A formula given previously [equation (8) of Sauter <italic>et al.</italic> (2004<xref ref-type="bibr" rid="bb22"> &#9654;</xref>)] converts an observed spot position <bold>r</bold> to a real-valued Miller index <bold>f</bold>, the components of which are rounded off to produce the likely integer-valued Miller index <bold>h</bold>. Index <bold>h</bold> is not always well defined for a rotation photograph; the rotation of the sample about the <italic>y</italic> axis (typically anywhere from 0.1 to 1.0&#176;) may produce differing <bold>h</bold> values for a particular <bold>r</bold> position at the beginning and end of the rotation, in which case the observed spot is removed from consideration. The difference <bold>f</bold>&#160;&#8722;&#160;<bold>h</bold> is expected to have small fractional components. Conversely, large component values may indicate an outlier. Indeed, we are able to filter out ice-ring artifacts by detecting peaks in a plot of |<bold>f</bold>&#160;&#8722;&#160;<bold>h</bold>| <italic>versus</italic> resolution, usefully supplementing the detection of ice rings by additional plots of background-corrected pixel intensities and number of candidate spots <italic>versus</italic> resolution. Yet despite all this attention to heuristics for classifying outliers, there are still numerous examples of undetected split spots, fragmented ice rings and superimposed lattices that work their way into the target function [equation&#160;(1)<xref ref-type="disp-formula" rid="fd1"/>] for optimizing the lattice model.</p><p>We therefore resort to statistical assumptions to help sort the spots. Two populations are posited, a collection of outliers that do not fit the lattice model, and a normally distributed collection of lattice spots that fit the model, albeit with some uncertainty. The normally distributed lattice spots are taken to deviate from their predicted positions in the plane of the detector with a Gaussian probability distribution in each coordinate, <italic>x</italic> and <italic>y</italic>. We make the further simplifying assumptions that the individual coordinate deviations &#916;<italic>x</italic> and &#916;<italic>y</italic> (Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>
            <italic>a</italic>) are uncorrelated and that their variances are equal (<inline-formula><inline-graphic xlink:href="j-43-00611-efi2.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>). This permits the total deviation between the observed and predicted positions, <disp-formula id="fd2"><graphic xlink:href="j-43-00611-efd2"/></disp-formula>to be modeled with a Rayleigh probability distribution (which may be thought of as an extension of the Gaussian distribution into two dimensions), <disp-formula id="fd3"><graphic xlink:href="j-43-00611-efd3"/></disp-formula>where &#963;<sup>2</sup> = <inline-formula><inline-graphic xlink:href="j-43-00611-efi3.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> = <inline-formula><inline-graphic xlink:href="j-43-00611-efi4.jpg" mimetype="image" mime-subtype="gif"/></inline-formula> = <inline-formula><inline-graphic xlink:href="j-43-00611-efi5.jpg" mimetype="image" mime-subtype="gif"/></inline-formula>.</p><p>With this framework in place, the goal now is to separate observations that do and do not appear to fit a Rayleigh distribution. The total group of <italic>N</italic> observations is sorted in order of increasing &#916;<italic>r</italic> (Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>
            <italic>c</italic>), indexed by the symbol <italic>k</italic> (<italic>k</italic> = 0, 1, &#8230;, <italic>N</italic>&#160;&#8722;&#160;1). A useful tool for interpreting this series is the cumulative distribution function, or probability that an observation will have a &#916;<italic>r</italic> lower than a given value, <disp-formula id="fd4"><graphic xlink:href="j-43-00611-efd4"/></disp-formula>It is assumed that the spots with the smallest &#916;<italic>r</italic> values will form a safe group (with no outliers) from which to model the variance in this equation. We therefore take a reasonable subset (40% of the well measured spots with the lowest &#916;<italic>r</italic>; see below) and optimize the value of &#963; by least-squares minimization of a function <italic>f</italic> that characterizes the vertical difference between the observed and calculated cumulative distribution curves in Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>(<italic>c</italic>), <disp-formula id="fd5"><graphic xlink:href="j-43-00611-efd5"/></disp-formula>In this equation, the observed distribution function &#934;<sub>obs</sub> is just a straight-line function, (2<italic>k</italic> + 1)/2<italic>N</italic>, that spreads the observations along the vertical axis of Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>(<italic>c</italic>), while the calculated distribution function &#934;<sub>calc</sub> is equation (4)<xref ref-type="disp-formula" rid="fd4"/> evaluated at the &#916;<italic>r</italic> position of the <italic>k</italic>th observation. Modeling the variance with equation (5)<xref ref-type="disp-formula" rid="fd5"/> is expected to be superior to using equation (1)<xref ref-type="disp-formula" rid="fd1"/>, since we are fairly confident that equation (5)<xref ref-type="disp-formula" rid="fd5"/> samples only the variation of spots that truly belong to the lattice, and not the outliers that may be present in the total ensemble of <italic>N</italic> spots. With the cumulative distribution function [equation (4)<xref ref-type="disp-formula" rid="fd4"/>] now established, it is possible to define an outlier as an observation for which &#916;<italic>r</italic> is too far away from the idealized curve of equation (4)<xref ref-type="disp-formula" rid="fd4"/>. A good cutoff is a distance of &#963; [represented by the green bar in Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>(<italic>c</italic>)], <italic>i.e.</italic> spots are classified as outliers when <disp-formula id="fd6"><graphic xlink:href="j-43-00611-efd6"/></disp-formula>It is important to understand that this cutoff criterion does not penalize observations that depart from the mean by many standard deviations. For example, if the sample size is extremely large it would be perfectly acceptable for a non-outlying spot to have &#916;<italic>r</italic>&#160;=&#160;6&#963;. Rather than impose an arbitrary &#963; cutoff, outliers are identified when the incidence of high &#916;<italic>r</italic> values exceeds that expected from a Rayleigh distribution. This approach accounts for the sample size in a natural way, as others have done in different contexts (Read, 1999<xref ref-type="bibr" rid="bb19"> &#9654;</xref>; Zwart <italic>et al.</italic>, 2005<xref ref-type="bibr" rid="bb32"> &#9654;</xref>).</p><p>The statistical model for outlier rejection is applied immediately after autoindexing at the computational stage (Fig. 1<xref ref-type="fig" rid="fig1"> &#9654;</xref>
            <italic>b</italic>) where the lattice model is still expressed as a triclinic cell. Subsequent to outlier rejection, the model is re-refined [again based on the target function in equation (1)<xref ref-type="disp-formula" rid="fd1"/>] and the cell is analyzed to discover the possible Bravais types (Sauter <italic>et al.</italic>, 2006<xref ref-type="bibr" rid="bb23"> &#9654;</xref>) prior to data integration.</p></sec><sec id="sec3" sec-type="results"><label>3.</label><title>Results</title><p>To assess the lattice quality from a variety of crystal samples, 22 protein structures were selected from the JCSG data archive, spanning a wide subset of Bravais types. As indicated in Table 1<xref ref-type="table" rid="table1"> &#9654;</xref>, diffraction properties such as limiting resolution varied over a considerable range, as did the experimental conditions such as the width of the rotation angle (not shown). Lattice deviation statistics computed from one rotation image in each data set (generally the first image) reveal a broad spectrum of sample qualities, with one sample (<ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=3bgu">3bgu</ext-link>) exhibiting a second lattice and two others presenting Bragg spots that are split in half (<ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1vr8">1vr8</ext-link>) or streaked in long rows (<ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1vk8">1vk8</ext-link>; Fig.&#160;2<xref ref-type="fig" rid="fig2"> &#9654;</xref>). Separately, a test image from a lysozyme sample containing two lattices was analyzed (Fig. 4<xref ref-type="fig" rid="fig4"> &#9654;</xref>).</p><p>Each diffraction pattern was autoindexed with <italic>LABELIT</italic> (Sauter <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb22"> &#9654;</xref>) and the resulting lattice refined based on its agreement with the center-of-mass positions of the <italic>N</italic> best-candidate Bragg spots [equation (1)<xref ref-type="disp-formula" rid="fd1"/>]. Our procedure for rejecting outliers is illustrated in Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref> for the <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1vk8">1vk8</ext-link> diffraction pattern. Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>(<italic>a</italic>) plots the &#916;<italic>x</italic> and &#916;<italic>y</italic> deviations of the observed spots from their predicted positions, although the outliers that are several millimeters away from the nearest expected lattice point (Fig.&#160;2<xref ref-type="fig" rid="fig2"> &#9654;</xref>
            <italic>b</italic>) are beyond the extent of this graph. The ordered sequence of &#916;<italic>r</italic> values is shown in Fig.&#160;3<xref ref-type="fig" rid="fig3"> &#9654;</xref>(<italic>c</italic>), along with the best-fit cumulative distribution function [&#934;(&#916;<italic>r</italic>), blue curve] which is modeled on the 40% of observations with the lowest &#916;<italic>r</italic> values (red spots). In all cases examined, choosing the best-conforming subset of Bragg spots in this manner shows that the errors in the spot positions are described reasonably well by a Rayleigh distribution [equations (3)<xref ref-type="disp-formula" rid="fd3"/> and (4)<xref ref-type="disp-formula" rid="fd4"/>]. The modeled parameter describing the distribution (&#963;) is not very sensitive to the exact fraction of spots included; comparable results are obtained upon inclusion of anywhere from 25 to 55% of the spots. A command-line option was added to <italic>labelit.index</italic> to set this parameter (see &#167;4<xref ref-type="sec" rid="sec4"/>).</p><p>In the case of sample <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1vk8">1vk8</ext-link>, a full 80% of the chosen spots coincide with the Rayleigh distribution (blue line, Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>
            <italic>c</italic>), while the remaining observations (those above the green cutoff line) depart markedly from this ideal. These are interpreted as outliers, and are thus removed from the list of observations. Another round of lattice refinement ensues, this time producing &#916;<italic>x</italic> and &#916;<italic>y</italic> deviations with a much tighter distribution about the model (Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>
            <italic>b</italic>). Also, an ordered plot of &#916;<italic>r</italic> values shows that the entire set of remaining observations adheres extremely well to a Rayleigh distribution (Fig.&#160;3<xref ref-type="fig" rid="fig3"> &#9654;</xref>
            <italic>d</italic>). The improvement in the model is not confined to the <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1vk8">1vk8</ext-link> case; indeed, the r.m.s. deviation between model and experiment (&#963;<sub><italic>r</italic></sub>) decreases after a second round of model refinement, sometimes dramatically, in every instance where outliers are rejected (Table 1<xref ref-type="table" rid="table1"> &#9654;</xref>).</p><p>For the crystals containing two lattices (<ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=3bgu">3bgu</ext-link> and lysozyme), the initial lattice refinement target (for refining the predominant lattice) is contaminated with spot observations from the second lattice. The r.m.s. spot deviations (887 and 586&#8197;&#181;m, respectively) are therefore exceptionally large. However, the statistical rejection of outliers successfully removes these observations, such that the second round of lattice refinement produces much lower spot deviations (66 and 100&#8197;&#181;m) that are typical of single-crystal samples. Furthermore, the identification of the outlying spots provides an opportunity to index the second lattice: a separate round of autoindexing based on just the outliers (Fig. 1<xref ref-type="fig" rid="fig1"> &#9654;</xref>
            <italic>b</italic>) produces good lattice models, although the spot deviations of 586 and 321&#8197;&#181;m are fairly high. The significance of this result is that it is not necessary to determine manually which spots to identify with the second lattice prior to autoindexing based on painstaking visual inspection. The two superimposed lysozyme lattices discerned in this manner are depicted in Fig. 4<xref ref-type="fig" rid="fig4"> &#9654;</xref>.</p><p>As explained in &#167;1<xref ref-type="sec" rid="sec1"/> above, the automated crystal-screening experiments that are the intended focus of this paper often rely on acquiring two images spaced 90&#176; apart on the <italic>y</italic>-rotational axis. We simulated such data sets by selecting widely spaced images from the JCSG archive. Statistical rejection of outliers from these two-image data sets (data not shown) did not differ remarkably from the one-image trials listed in Table&#160;1<xref ref-type="table" rid="table1"> &#9654;</xref>, either in the ability to improve the model fit or the ability to conform the remaining spots to a Rayleigh model. Certain minor details did change when considering the two images together, <italic>e.g.</italic> the additional lattice was not as pronounced in the second <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=3bgu">3bgu</ext-link> image and the spot splitting was not as severe in the second <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1vr8">1vr8</ext-link> image. In other data sets such as <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1vm6">1vm6</ext-link>, the percentage of spots rejected as outliers increased slightly, apparently because the lattice model proved to be a better fit for one of the two images (data not shown).</p></sec><sec id="sec4" sec-type="discussion|interpretation"><label>4.</label><title>Discussion</title><p>Within the crystal-screening paradigm, tens or hundreds of similar crystal samples may be evaluated for optimal diffraction before one or two are selected for data collection (Page <italic>et al.</italic>, 2005<xref ref-type="bibr" rid="bb17"> &#9654;</xref>). Automated software tools can facilitate this process by providing measures of sample quality (such as the signal-to-noise ratio, limiting resolution, r.m.s. deviation, mosaicity and number of ice-ring artifacts) in real time as the data are acquired. Except for the quantification of ice rings, these standard quality measures focus on the diffracted lattice itself. What have been lacking are reliable measures for the interference caused by non-lattice artifacts, which might degrade the integration of the Bragg signal or the subtraction of background, thus reducing the quality of the structure factors. Two of the statistics presented in Table 1<xref ref-type="table" rid="table1"> &#9654;</xref> appear to capture this information. Firstly, the number of outliers (expressed as a percentage of total Bragg spot candidates after ice rings have been removed) measures the prevalence of signals that do not belong to the canonical lattice. Secondly, the severity of the outliers (computed as the Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>
            <italic>c</italic> area bounded by the observed spots, the blue curve and the green cutoff line, in units of &#963;) gauges how far the outliers are from the lattice. High values of these measures in Table 1<xref ref-type="table" rid="table1"> &#9654;</xref> correlate with the visual recognition of stray spots in the <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1vk8">1vk8</ext-link>, <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=3bgu">3bgu</ext-link>, <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1vr8">1vr8</ext-link> and lysozyme images. These statistics may therefore prove useful for crystal screening in combination with the standard measures mentioned above.</p><p>The new methods described here &#8211; statistical rejection of outliers followed by re-refinement of the lattice model &#8211; have been added to the default flowchart within the autoindexing program <italic>labelit.index</italic> (Fig. 1<xref ref-type="fig" rid="fig1"> &#9654;</xref>
            <italic>b</italic>). Although the program normally operates with image data as the only input, a few command-line options have been added (described in the online manual) for generating plots such as those shown in Figs. 2<xref ref-type="fig" rid="fig2"> &#9654;</xref>&#8211;4<xref ref-type="fig" rid="fig3"> &#9654;</xref>
            <xref ref-type="fig" rid="fig4"> &#9654;</xref>, or for disabling outlier rejection altogether. Presently, the indexing of a second lattice is not part of the default procedure. Rather, it is intended that a high percentage of outliers will alert the user to the possibility of a second lattice, whereupon <italic>labelit.index</italic> may be run a second time with a command-line flag set to follow the &#8216;additional lattice&#8217; indexing path shown in Fig. 1<xref ref-type="fig" rid="fig1"> &#9654;</xref>(<italic>b</italic>).</p><p>The discovery of additional lattices performed here and elsewhere (Buts <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb5"> &#9654;</xref>) raises the question of how to handle data reduction. Standard programs such as <italic>MOSFLM</italic>, <italic>HKL</italic>, <italic>XDS</italic> and <italic>d*TREK</italic> treat only one lattice at a time, so separate data-reduction runs will have to be performed to integrate the Bragg signals from each lattice. Care must be taken with pairs of reflections from different lattices that either overlap or come close enough such that the background subtraction performed for one lattice is biased by the Bragg signal from another lattice. One approach, implemented in the program <italic>UNTANGLE</italic> (Buts <italic>et al.</italic>, 2004<xref ref-type="bibr" rid="bb5"> &#9654;</xref>), is to enumerate and reject problematic pairs of reflections before the data sets are merged together. Other programs such as <italic>PROW</italic> (Bourgeois <italic>et al.</italic>, 1998<xref ref-type="bibr" rid="bb4"> &#9654;</xref>) and <italic>EVAL15</italic> (Schreurs <italic>et al.</italic>, 2010<xref ref-type="bibr" rid="bb25"> &#9654;</xref>) preserve the information that is present in near or overlapping signals by jointly integrating and deconvoluting the neighboring spots.</p><p>The need for software tools to analyze multiple lattices is likely to increase. In contrast with the present practice of transferring individual crystals to the goniometer stage, some new sample-preparation technologies have focused on the <italic>in situ</italic> collection of data without removing crystals from their growth chamber. These protocols, involving samples grown in capillaries (Yadav <italic>et al.</italic>, 2005<xref ref-type="bibr" rid="bb30"> &#9654;</xref>) or on microfluidic plates (Ng <italic>et al.</italic>, 2008<xref ref-type="bibr" rid="bb15"> &#9654;</xref>; Gerdts <italic>et al.</italic>, 2008<xref ref-type="bibr" rid="bb8"> &#9654;</xref>; Emamzadah <italic>et al.</italic>, 2009<xref ref-type="bibr" rid="bb7"> &#9654;</xref>), omit the step where crystals are separated from each other, so it is quite possible for the incident X-ray beam to impinge on two crystals simultaneously. The early outlier-based detection of additional lattices (&#167;3<xref ref-type="sec" rid="sec3"/>) could either be used automatically to trigger special data-reduction protocols, or be deployed as part of a system of safeguards to avoid collecting such data sets altogether.</p><p>At the same time, one must keep in mind the assumptions underlying the present methods. Autoindexing must succeed prior to outlier analysis, so even if there are multiple lattices, one of them must be sufficiently predominant so that its unit-cell axes can be discerned by the autoindexing methodology (Steller <italic>et al.</italic>, 1997<xref ref-type="bibr" rid="bb27"> &#9654;</xref>, in the case of <italic>labelit.index</italic>). Outlier detection relies on the assumption that there is a safely known subset of observations (we assume 40% here) that truly coincides with the main lattice. Finally, if the outliers are used as a basis for determining a second lattice, we again assume that there is a predominant signal to be found, so it may be difficult to apply the present method to a superposition of three or more lattices.</p><p>The procedures described here are included in the software package <italic>LABELIT</italic>, available for download by non-commercial users at <ext-link ext-link-type="uri" xlink:href="http://cci.lbl.gov/labelit">http://cci.lbl.gov/labelit</ext-link>, and for licensing by commercial users. <italic>LABELIT</italic> is also included with the <italic>PHENIX</italic> package (Adams <italic>et al.</italic>, 2002<xref ref-type="bibr" rid="bb2"> &#9654;</xref>, 2010<xref ref-type="bibr" rid="bb1"> &#9654;</xref>), available for download at <ext-link ext-link-type="uri" xlink:href="http://www.phenix-online.org">http://www.phenix-online.org</ext-link>.</p></sec></body><back><ack><p>The authors thank Ashley Deacon (Joint Center for Structural Genomics) for creating the archive of full data sets associated with published JCSG structures, making it possible to test new methods such as those described here. Peter Zwart (Berkeley Center for Structural Biology of the Lawrence Berkeley National Laboratory) provided the lysozyme data set. Ralf Grosse-Kunstleve (Lawrence Berkeley National Laboratory) and David Richardson (Duke University) engaged in helpful discussions. We thank the <funding-source>NIH</funding-source> for financial support of the <italic>LABELIT</italic> project (grant No. <award-id>1R01GM77071</award-id>). This work was partially supported by DOE contract No. DE-AC02-05CH11231.</p></ack><ref-list><title>References</title><ref id="bb1"><mixed-citation publication-type="other">Adams, P. D. <italic>et al.</italic> (2010). <italic>Acta Cryst.</italic> D<bold>66</bold>, 213&#8211;221.</mixed-citation></ref><ref id="bb2"><mixed-citation publication-type="other">Adams, P. D., Grosse-Kunstleve, R. W., Hung, L.-W., Ioerger, T. R., McCoy, A. J., Moriarty, N. W., Read, R. J., Sacchettini, J. C., Sauter, N. K. &amp; Terwilliger, T. C. (2002). <italic>Acta Cryst.</italic> D<bold>58</bold>, 1948&#8211;1954.</mixed-citation></ref><ref id="bb3"><mixed-citation publication-type="other">Arndt, U. W. &amp; Wonacott, A. J. (1977). Editors. <italic>The Rotation Method in Crystallography</italic>, p. 83. Amsterdam: North Holland.</mixed-citation></ref><ref id="bb4"><mixed-citation publication-type="other">Bourgeois, D., Nurizzo, D., Kahn, R. &amp; Cambillau, C. (1998). <italic>J. Appl. Cryst.</italic><bold>31</bold>, 22&#8211;35.</mixed-citation></ref><ref id="bb5"><mixed-citation publication-type="other">Buts, L., Dao-Thi, M.-H., Wyns, L. &amp; Loris, R. (2004). <italic>Acta Cryst.</italic> D<bold>60</bold>, 983&#8211;984.</mixed-citation></ref><ref id="bb6"><mixed-citation publication-type="other">Dauter, Z. (1999). <italic>Acta Cryst.</italic> D<bold>55</bold>, 1703&#8211;1717.</mixed-citation></ref><ref id="bb7"><mixed-citation publication-type="other">Emamzadah, S., Petty, T. J., De Almeida, V., Nishimura, T., Joly, J., Ferrer, J.-L. &amp; Halazonetis, T. D. (2009). <italic>Acta Cryst.</italic> D<bold>65</bold>, 913&#8211;920.</mixed-citation></ref><ref id="bb8"><mixed-citation publication-type="other">Gerdts, C. J., Elliott, M., Lovell, S., Mixon, M. B., Napuli, A. J., Staker, B. L., Nollert, P. &amp; Stewart, L. (2008). <italic>Acta Cryst.</italic> D<bold>64</bold>, 1116&#8211;1122.</mixed-citation></ref><ref id="bb9"><mixed-citation publication-type="other">Gonz&#225;lez, A., Moorhead, P., McPhillips, S. E., Song, J., Sharp, K., Taylor, J. R., Adams, P. D., Sauter, N. K. &amp; Soltis, S. M. (2008). <italic>J. Appl. Cryst.</italic><bold>41</bold>, 176&#8211;184.</mixed-citation></ref><ref id="bb10"><mixed-citation publication-type="other">Grosse-Kunstleve, R. W., Sauter, N. K., Moriarty, N. W. &amp; Adams, P.&#160;D. (2002). <italic>J. Appl. Cryst.</italic><bold>35</bold>, 126&#8211;136.</mixed-citation></ref><ref id="bb11"><mixed-citation publication-type="other">Incardona, M.-F., Bourenkov, G. P., Levik, K., Pieritz, R. A., Popov, A. N. &amp; Svensson, O. (2009). <italic>J. Synchrotron Rad.</italic><bold>16</bold>, 872&#8211;879.</mixed-citation></ref><ref id="bb12"><mixed-citation publication-type="other">Kabsch, W. (2010<italic>a</italic>). <italic>Acta Cryst.</italic> D<bold>66</bold>, 125&#8211;132.</mixed-citation></ref><ref id="bb13"><mixed-citation publication-type="other">Kabsch, W. (2010<italic>b</italic>). <italic>Acta Cryst.</italic> D<bold>66</bold>, 133&#8211;144.</mixed-citation></ref><ref id="bb14"><mixed-citation publication-type="other">Leslie, A. G. W. (1999). <italic>Acta Cryst.</italic> D<bold>55</bold>, 1696&#8211;1702.</mixed-citation></ref><ref id="bb15"><mixed-citation publication-type="other">Ng, J. D., Clark, P. J., Stevens, R. C. &amp; Kuhn, P. (2008). <italic>Acta Cryst.</italic> D<bold>64</bold>, 189&#8211;197.</mixed-citation></ref><ref id="bb16"><mixed-citation publication-type="other">Otwinowski, Z. &amp; Minor, W. (1997). <italic>Methods Enzymol.</italic><bold>276</bold>, 307&#8211;326.</mixed-citation></ref><ref id="bb17"><mixed-citation publication-type="other">Page, R., Deacon, A. M., Lesley, S. A. &amp; Stevens, R. C. (2005). <italic>J. Struct. Funct. Genomics</italic>, <bold>6</bold>, 209&#8211;217.</mixed-citation></ref><ref id="bb18"><mixed-citation publication-type="other">Pflugrath, J. W. (1999). <italic>Acta Cryst.</italic> D<bold>55</bold>, 1718&#8211;1725.</mixed-citation></ref><ref id="bb19"><mixed-citation publication-type="other">Read, R. J. (1999). <italic>Acta Cryst.</italic> D<bold>55</bold>, 1759&#8211;1764.</mixed-citation></ref><ref id="bb21"><mixed-citation publication-type="other">Rossmann, M. G. &amp; van Beek, C. G. (1999). <italic>Acta Cryst.</italic> D<bold>55</bold>, 1631&#8211;1640.</mixed-citation></ref><ref id="bb20"><mixed-citation publication-type="other">Rossmann, M. G., Leslie, A. G. W., Abdel-Meguid, S. S. &amp; Tsukihara, T. (1979). <italic>J. Appl. Cryst.</italic><bold>12</bold>, 570&#8211;581.</mixed-citation></ref><ref id="bb22"><mixed-citation publication-type="other">Sauter, N. K., Grosse-Kunstleve, R. W. &amp; Adams, P. D. (2004). <italic>J. Appl. Cryst.</italic><bold>37</bold>, 399&#8211;409.</mixed-citation></ref><ref id="bb23"><mixed-citation publication-type="other">Sauter, N. K., Grosse-Kunstleve, R. W. &amp; Adams, P. D. (2006). <italic>J. Appl. Cryst.</italic><bold>39</bold>, 158&#8211;168.</mixed-citation></ref><ref id="bb24"><mixed-citation publication-type="other">Sauter, N. K. &amp; Zwart, P. H. (2009). <italic>Acta Cryst.</italic> D<bold>65</bold>, 553&#8211;559.</mixed-citation></ref><ref id="bb25"><mixed-citation publication-type="other">Schreurs, A. M. M., Xian, X. &amp; Kroon-Batenburg, L. M. J. (2010). <italic>J. Appl. Cryst.</italic><bold>43</bold>, 70&#8211;82.</mixed-citation></ref><ref id="bb26"><mixed-citation publication-type="other">Soltis, S. M. <italic>et al.</italic> (2008). <italic>Acta Cryst.</italic> D<bold>64</bold>, 1210&#8211;1221.</mixed-citation></ref><ref id="bb27"><mixed-citation publication-type="other">Steller, I., Bolotovsky, R. &amp; Rossmann, M. G. (1997). <italic>J. Appl. Cryst.</italic><bold>30</bold>, 1036&#8211;1040.</mixed-citation></ref><ref id="bb28"><mixed-citation publication-type="other">Wagner, T. &amp; Sch&#246;nleber, A. (2009). <italic>Acta Cryst.</italic> B<bold>65</bold>, 249&#8211;268.</mixed-citation></ref><ref id="bb29"><mixed-citation publication-type="other">Winkler, F. K., Schutt, C. E. &amp; Harrison, S. C. (1979). <italic>Acta Cryst.</italic> A<bold>35</bold>, 901&#8211;911.</mixed-citation></ref><ref id="bb30"><mixed-citation publication-type="other">Yadav, M. K., Gerdts, C. J., Sanishvili, R., Smith, W. W., Roach, L. S., Ismagilov, R. F., Kuhn, P. &amp; Stevens, R. C. (2005). <italic>J. Appl. Cryst.</italic><bold>38</bold>, 900&#8211;905.</mixed-citation></ref><ref id="bb31"><mixed-citation publication-type="other">Zhang, Z., Sauter, N. K., van den Bedem, H., Snell, G. &amp; Deacon, A.&#160;M. (2006). <italic>J. Appl. Cryst.</italic><bold>39</bold>, 112&#8211;119.</mixed-citation></ref><ref id="bb32"><mixed-citation publication-type="other">Zwart, P. H., Grosse-Kunstleve, R. W. &amp; Adams, P. D. (2005). <italic>CCP4 Newsl.</italic><bold>43</bold>, contribution 7.</mixed-citation></ref></ref-list></back><floats-group><fig id="fig1" position="float"><label>Figure 1</label><caption><p>Protocol for outlier detection. (<italic>a</italic>) Data-acquisition geometry, showing librations of the crystal about the incident beam (<italic>z</italic> axis) and goniometer rotation axis (<italic>y</italic> axis). (<italic>b</italic>) Computational procedure showing steps that are executed within the program <italic>labelit.index</italic>. New outlier detection steps developed in this paper are indicated by an asterisk (*) and the alternative pathway for indexing the second lattice (if one is present) is indicated by a dagger symbol (&#8224;).</p></caption><graphic xlink:href="j-43-00611-fig1"/></fig><fig id="fig2" position="float"><label>Figure 2</label><caption><p>Detail of the 1&#176; rotation image used for analyzing outliers for Protein Data Bank (PDB) entry <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1vk8">1vk8</ext-link>. (<italic>a</italic>) Red circles are the candidate Bragg spots accepted for the initial lattice refinement, after two rounds of heuristic spot filters. Spot intensity is one criterion for accepting these candidate observations, but other characteristics have disqualifed many of the brightest Bragg spots in this case. Specifically, the heuristic rules select signals for which the centroids are extremely well measured, namely round sharp spot profiles that are baseline-separated from neighboring signals. Thus, the Bragg signals exhibiting satellite spots and streaks oriented along the vertical <italic>c</italic>*-axis direction are excluded from refinement. (<italic>b</italic>) Yellow boxes show the predicted Bragg positions on the initially refined lattice model. Observations have been recolored to indicate their status with respect to this predicted lattice. Red dots represent the 40% of spots closest to their predicted positions, used for determining the Rayleigh distribution &#963; in Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>(<italic>c</italic>). Pink spots are those determined to be outliers by the statistical test [equation (6)<xref ref-type="disp-formula" rid="fd6"/>], very much in agreement with the visual impression. Orange dots are the remaining observations.</p></caption><graphic xlink:href="j-43-00611-fig2"/></fig><fig id="fig3" position="float"><label>Figure 3</label><caption><p>Analysis of <ext-link ext-link-type="uri" xlink:href="http://scripts.iucr.org/cgi-bin/cr.cgi?rm=pdb&amp;pdbId=1vk8">1vk8</ext-link> outliers. (<italic>a</italic>) and (<italic>b</italic>) are scatter plots of the deviation between observed and predicted Bragg spot positions for (<italic>a</italic>) the initially refined lattice model and (<italic>b</italic>) the re-refined lattice model after outlier rejection. The blue circles in (<italic>a</italic>) and (<italic>b</italic>) are the expected limits that should contain 95% of the spots, based on the Rayleigh distributions modeled in (<italic>c</italic>) and (<italic>d</italic>), respectively. (<italic>c</italic>) and (<italic>d</italic>) are cumulative distribution functions (blue curves) calculated on the subset of observations (red dots) containing the 40% of spots with the smallest values of &#916;<italic>r</italic>. Pink dots represent outliers with &#916;<italic>r</italic> values more than &#963; away from the expected curve (green bar). The outliers have been removed in the second refinement round shown in (<italic>b</italic>) and (<italic>d</italic>). Orange dots are the remaining observations.</p></caption><graphic xlink:href="j-43-00611-fig3"/></fig><fig id="fig4" position="float"><label>Figure 4</label><caption><p>Indexing of two superimposed lysozyme diffraction patterns. (<italic>a</italic>) The primary lattice model (yellow boxes) after an initial round of refinement, where colored dots represent the spots included in the lattice refinement. Color coding is the same as used in Figs. 2<xref ref-type="fig" rid="fig2"> &#9654;</xref> and 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>. Red spots are the subset safely considered to be part of the primary lattice, while pink spots are the outliers identified by equation (6)<xref ref-type="disp-formula" rid="fd6"/> (consistent with the visual impression). (<italic>b</italic>) The lattice that results from a second round of autoindexing using only the pink-coded outliers as data. Spot color codes are the same as in (<italic>a</italic>). The new lattice in (<italic>b</italic>) is clearly consistent with the pink (outlying) observations.</p></caption><graphic xlink:href="j-43-00611-fig4"/></fig><table-wrap id="table1" position="float"><label>Table 1</label><caption><title>Improvement of the lattice model after outlier rejection</title><p>Results shown here represent the analysis of a single rotation image. &#963;<sub><italic>r</italic></sub> is the r.m.s. difference between observed and predicted spot positions as defined in equation&#160;(1)<xref ref-type="disp-formula" rid="fd1"/>. &#963; is a standard deviation fitted to the 40% of observations (before outlier rejection) that are closest to their corresponding predicted positions, as illustrated in Fig. 3<xref ref-type="fig" rid="fig3"> &#9654;</xref>(<italic>c</italic>).</p></caption></table-wrap></floats-group></article>