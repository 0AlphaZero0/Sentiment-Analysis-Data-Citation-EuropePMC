<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.1 20151215//EN" "JATS-archivearticle1.dtd"> 
<article xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" article-type="research-article"><?properties open_access?><?DTDIdentifier.IdentifierValue -//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1 20151215//EN?><?DTDIdentifier.IdentifierType public?><?SourceDTD.DTDName JATS-journalpublishing1.dtd?><?SourceDTD.Version 1.1?><?ConverterInfo.XSLTName jp2nlmx2.xsl?><?ConverterInfo.Version 1?><front><journal-meta><journal-id journal-id-type="nlm-ta">Syst Biol</journal-id><journal-id journal-id-type="iso-abbrev">Syst. Biol</journal-id><journal-id journal-id-type="publisher-id">sysbio</journal-id><journal-title-group><journal-title>Systematic Biology</journal-title></journal-title-group><issn pub-type="ppub">1063-5157</issn><issn pub-type="epub">1076-836X</issn><publisher><publisher-name>Oxford University Press</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="pmcid">5920299</article-id><article-id pub-id-type="pmid">29186587</article-id><article-id pub-id-type="doi">10.1093/sysbio/syx090</article-id><article-id pub-id-type="publisher-id">syx090</article-id><article-categories><subj-group subj-group-type="heading"><subject>Regular Articles</subject></subj-group></article-categories><title-group><article-title><SecTag type="TITLE"><text><SENT sid="0" pm="."><plain>Effective Online Bayesian Phylogenetics via Sequential Monte Carlo with Guided Proposals </plain></SENT>
</text></SecTag></article-title></title-group><contrib-group><contrib contrib-type="author"><name><surname>Fourment</surname><given-names>Mathieu</given-names></name><xref ref-type="aff" rid="syx090-AFF1">1</xref><xref ref-type="corresp" rid="syx090-COR1"/></contrib><contrib contrib-type="author"><name><surname>Claywell</surname><given-names>Brian C</given-names></name><xref ref-type="aff" rid="syx090-AFF2">2</xref></contrib><contrib contrib-type="author"><name><surname>Dinh</surname><given-names>Vu</given-names></name><xref ref-type="aff" rid="syx090-AFF2">2</xref></contrib><contrib contrib-type="author"><name><surname>McCoy</surname><given-names>Connor</given-names></name><xref ref-type="aff" rid="syx090-AFF2">2</xref></contrib><contrib contrib-type="author"><name><surname>Matsen IV</surname><given-names>Frederick A</given-names></name><xref ref-type="aff" rid="syx090-AFF2">2</xref></contrib><contrib contrib-type="author"><name><surname>Darling</surname><given-names>Aaron E</given-names></name><xref ref-type="aff" rid="syx090-AFF1">1</xref></contrib></contrib-group><contrib-group><contrib contrib-type="editor"><name><surname>Suskso</surname><given-names>Edward</given-names></name><role>Associate Editor</role></contrib></contrib-group><aff id="syx090-AFF1"><label>1</label>
<italic>ithree institute, University of Technology Sydney, Ultimo, NSW 2007, Australia</italic>
</aff><aff id="syx090-AFF2"><label>2</label>
<italic>Fred Hutchinson Cancer Research Center, Seattle, WA 98109, USA</italic>
</aff><author-notes><corresp id="syx090-COR1">Correspondence to be sent to: ithree institute, University of Technology Sydney, PO Box 123, Ultimo, NSW 2007, Australia; E-mail: <email>mathieu.fourment@uts.edu.au</email>.</corresp></author-notes><pub-date pub-type="ppub"><month>5</month><year>2018</year></pub-date><pub-date pub-type="epub" iso-8601-date="2017-11-27"><day>27</day><month>11</month><year>2017</year></pub-date><pub-date pub-type="pmc-release"><day>27</day><month>11</month><year>2017</year></pub-date><volume>67</volume><issue>3</issue><fpage>490</fpage><lpage>502</lpage><history><date date-type="received"><day>2</day><month>6</month><year>2017</year></date><date date-type="rev-recd"><day>16</day><month>11</month><year>2017</year></date><date date-type="accepted"><day>20</day><month>11</month><year>2017</year></date></history><permissions><copyright-statement>© The Author(s) 2017. Published by Oxford University Press, on behalf of the Society of Systematic Biologists.</copyright-statement><copyright-year>2017</copyright-year><license license-type="cc-by" xlink:href="http://creativecommons.org/licenses/by/4.0/"><license-p>This is an Open Access article distributed under the terms of the Creative Commons Attribution License (<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted reuse, distribution, and reproduction in any medium, provided the original work is properly cited.</license-p></license></permissions><self-uri xlink:href="syx090.pdf"/><related-article id="d35e161" related-article-type="companion" ext-link-type="doi" xlink:href="10.1093/sysbio/syx087"/><abstract><title><text><SENT sid="1" pm="."><plain>Abstract </plain></SENT>
</text></title><p><SecTag type="ABS"><text><SENT sid="2" pm="."><plain>Modern infectious disease outbreak surveillance produces continuous streams of sequence data which require phylogenetic analysis as data arrives. </plain></SENT>
<SENT sid="3" pm="."><plain>Current software packages for Bayesian phylogenetic inference are unable to quickly incorporate new sequences as they become available, making them less useful for dynamically unfolding evolutionary stories. </plain></SENT>
<SENT sid="4" pm="."><plain>This limitation can be addressed by applying a class of Bayesian statistical inference algorithms called sequential Monte Carlo (SMC) to conduct online inference, wherein new data can be continuously incorporated to update the estimate of the posterior probability distribution. </plain></SENT>
<SENT sid="5" pm="."><plain>In this article, we describe and evaluate several different online phylogenetic sequential Monte Carlo (OPSMC) algorithms. </plain></SENT>
<SENT sid="6" pm="."><plain>We show that proposing new phylogenies with a density similar to the Bayesian prior suffers from poor performance, and we develop “guided” proposals that better match the proposal density to the posterior. </plain></SENT>
<SENT sid="7" pm="."><plain>Furthermore, we show that the simplest guided proposals can exhibit pathological behavior in some situations, leading to poor results, and that the situation can be resolved by heating the proposal density. </plain></SENT>
<SENT sid="8" pm="."><plain>The results demonstrate that relative to the widely used MCMC-based algorithm implemented in MrBayes, the total time required to compute a series of phylogenetic posteriors as sequences arrive can be significantly reduced by the use of OPSMC, without incurring a significant loss in accuracy. </plain></SENT>
</text></SecTag></p></abstract><SecTag type="KEYWORD"><kwd-group kwd-group-type="author"><kwd>Bayesian inference</kwd><kwd>online inference</kwd><kwd>phylogenetics</kwd><kwd>sequential Monte Carlo</kwd></kwd-group></SecTag><funding-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">National Science Foundation</named-content><named-content content-type="funder-identifier">10.13039/100000001</named-content></funding-source><award-id>DMS-1223057</award-id><award-id>CISE-1564137</award-id></award-group><award-group award-type="grant"><funding-source><named-content content-type="funder-name">National Institutes of Health</named-content><named-content content-type="funder-identifier">10.13039/100000002</named-content></funding-source><award-id>U54-GM111274</award-id></award-group></funding-group><counts><page-count count="13"/></counts></article-meta></front><body><p><text><SENT sid="9" pm="."><plain>Phylogenetic techniques are quickly becoming an essential tool in the investigation and surveillance of infectious disease outbreaks (Gardy et al. 2015; Neher and Bedford 2015; Rusu et al. 2015). </plain></SENT>
<SENT sid="12" pm="."><plain>Meanwhile, advances in DNA sequencing technology have made the generation of complete genome data for isolates of bacteria and viruses a routine practice in public health laboratories. </plain></SENT>
<SENT sid="13" pm="."><plain>These genome data are collected into public databases such as the FDA GenomeTrakr (FDA 2016), which in 2016 accumulated new data at an average rate of over 1000 pathogen genomes per week. </plain></SENT>
<SENT sid="14" pm="."><plain>Sequencing technology itself continues to evolve, with new devices based on nanopore detection capable of generating a continuous stream of sequence data, supporting interactive real-time analysis (Loose et al. 2016). </plain></SENT>
</text></p><p><text><SENT sid="16" pm="."><plain>Ideally these new data streams would be matched with appropriate sequence analysis tools, including Bayesian phylogenetic inference. </plain></SENT>
<SENT sid="17" pm="."><plain>Bayesian inference has particular value in epidemiological investigations due to its ability to operate on models with a wide range of unknown parameters, including divergence times, lineage-specific mutation rates, population demographics, and geography (Lemey et al. 2009; Kühnert et al. 2014). </plain></SENT>
<SENT sid="20" pm="."><plain>However, all current methods for Bayesian inference treat the data set as a static entity that has been observed in its entirety at the time that computation of the posterior probability distribution begins. </plain></SENT>
<SENT sid="21" pm="."><plain>Updating a data set with new sequences, as might be required when a new case of an infection is presented and sequenced, necessitates that the entire analysis be restarted. </plain></SENT>
</text></p><p><text><SENT sid="22" pm="."><plain>Although Izquierdo-Carrasco et al. (2014) have proposed a maximum likelihood approach to update a phylogenetic tree with new sequences, no such tool exists for Bayesian phylogenetic inference. </plain></SENT>
<SENT sid="23" pm="."><plain>Each run using popular Bayesian phylogenetic inference tools like MrBayes (Ronquist et al. 2012) or BEAST (Bouckaert et al. 2014) can take days or weeks of CPU time to approximate a posterior distribution for realistic models and data sets. </plain></SENT>
<SENT sid="26" pm="."><plain>The inability to quickly incorporate new data into an existing analysis is a major impediment to the use of Bayesian phylogenetics as a decision support tool for infectious disease management and surveillance, where interventions are most likely to be effective if made within hours or days. </plain></SENT>
</text></p><p><text><SENT sid="27" pm="."><plain>Recently, Dinh et al. (2016) described a theoretical framework for updating a phylogenetic posterior approximation, called Online Phylogenetic Sequential Monte Carlo (OPSMC). </plain></SENT>
<SENT sid="28" pm="."><plain>An overview of OPSMC is given in Figure 1. </plain></SENT>
<SENT sid="29" pm="."><plain>At each generation, a population of particles representing a posterior sample of trees on \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$n-1$\end{document} sequences is updated to give a sample from the corresponding posterior on \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$n$\end{document} sequences. </plain></SENT>
<SENT sid="30" pm="."><plain>Optionally, one or more Metropolis–Hastings steps (not shown in the figure) can be applied to increase the effective sample size. Dinh et al. (2016) show consistency of OPSMC in terms of weak convergence: as the number of particles goes to infinity, the weighted average of a test function over a collection of particles converges to the integral of that test function with respect to the posterior distribution. </plain></SENT>
<SENT sid="31" pm="."><plain>In addition, the effective sample size (ESS) (defined below) is bounded below by a constant multiple of the number of particles. </plain></SENT>
<SENT sid="32" pm="."><plain>However, even given these attractive theoretical properties, it was not clear if OPSMC could be translated into a competitive sampler. </plain></SENT>
<SENT sid="33" pm="."><plain>In addition, more research is needed on the design of effective transition kernels for OPSMC, a subject of some debate in related literature (Teh et al. 2008; Bouchard-Côté et al. 2012). </plain></SENT>
</text></p><SecTag type="FIG"><fig id="F1" orientation="portrait" position="float"><label>Figure 1.</label><caption><p><text><SENT sid="36" pm="."><plain>An overview of the OPSMC algorithm as implemented in \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document}. </plain></SENT>
<SENT sid="37" pm="."><plain>Panel A) shows a population of particles going through an SMC iteration. </plain></SENT>
<SENT sid="38" pm="."><plain>For each particle, a new sequence (taxon) \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\psi_n$\end{document} is attached to the tree using proposal \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$Q^n(\cdot)$\end{document}, its weight is computed, and particles are resampled using the weights. </plain></SENT>
<SENT sid="39" pm="."><plain>Panel B) depicts the three-step proposal applied by \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} to a single particle. </plain></SENT>
</text></p></caption><graphic xlink:href="syx090f1"/></fig></SecTag><p><text><SENT sid="40" pm="."><plain>In this work, we implement OPSMC with a variety of transition kernels and compare their ability to efficiently update phylogenetic posteriors with new data. </plain></SENT>
<SENT sid="41" pm="."><plain>In particular, we compare the efficiency of naïve proposals to guided proposals showing that the extra effort required to compute a guided proposal leads to a significant overall improvement in sampler efficiency. </plain></SENT>
<SENT sid="42" pm="."><plain>Finally, we discuss prospects for the incorporation of OPSMC into widely used algorithms and software packages for Bayesian phylogenetic inference. </plain></SENT>
<SENT sid="43" pm="."><plain>For this article, we restrict ourselves to “pure” SMC without Metropolis–Hastings steps. </plain></SENT>
<SENT sid="44" pm="."><plain>Our implementation is available at <ext-link ext-link-type="uri" xlink:href="https://github.com/OnlinePhylo/sts/">https://github.com/OnlinePhylo/sts/</ext-link>. </plain></SENT>
</text></p><p><text><SENT sid="45" pm="."><plain>Our results build upon several key pieces of previous work on building trees using SMC via subtree merging. Teh et al. (2008) were the first to describe the use of Sequential Monte Carlo for Bayesian inference of tree-structured models. Bouchard-Côté et al. (2012) adapted that work to infer rooted, ultrametric phylogenetic trees. Wang et al. (2015) showed that SMC could also be applied to unrooted phylogenetic trees and provided an implementation of the algorithm and performance comparison with the widely used MrBayes software. </plain></SENT>
<SENT sid="46" pm="."><plain>Because each of these methods proceeds by joining the roots of subtrees merged by previous steps, they can only add additional sequences at the root of the tree. </plain></SENT>
<SENT sid="47" pm="."><plain>Thus each of those previous contributions is only appropriate for the case where the data set is static and completely known when inference begins. </plain></SENT>
</text></p><p><text><SENT sid="48" pm="."><plain>In contrast, our work relaxes those assumptions to evaluate algorithms for online inference. Dinh et al. (2016) was the first to describe a theoretical framework to extend phylogenetic SMC approaches to online inference. </plain></SENT>
<SENT sid="49" pm="."><plain>In parallel work, Everitt et al. (2016) have also described an online phylogenetic inference step as part of a larger framework of SMC methods for spaces of varying dimension (see also Everitt et al. 2017). </plain></SENT>
<SENT sid="51" pm="."><plain>We will compare our work and that of these authors in the Discussion. </plain></SENT>
</text></p><SecTag type="METHODS"><sec sec-type="materials|methods" id="SEC1"><title><text><SENT sid="52" pm="."><plain>Material and Methods </plain></SENT>
</text></title><sec id="SEC1.1"><title><text><SENT sid="53" pm="."><plain>Definitions </plain></SENT>
</text></title><p><text><SENT sid="54" pm="."><plain>In Bayesian inference, we are interested in estimating the posterior distribution of a model conditioned on data. </plain></SENT>
<SENT sid="55" pm="."><plain>In phylogenetics, the data are a set of nucleotide or amino acid sequences \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\boldsymbol{\psi} = (\psi_1, \psi_2,\dots, \psi_N)$\end{document} collected from \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$N$\end{document} taxa, wherein the homologous nucleotides among sequences have been identified and grouped as sites (columns) in a sequence alignment (Felsenstein 2004). </plain></SENT>
<SENT sid="56" pm="."><plain>We assume that alignment sites are independent and identically distributed (IID) and that mutation events along each branch of a phylogenetic tree \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\tau$\end{document} occur independently accordingly to a continuous time Markov chain. </plain></SENT>
<SENT sid="57" pm="."><plain>In this article, we use the Jukes–Cantor (Jukes et al. 1969) substitution model with equal base frequencies and equal transition rates. </plain></SENT>
</text></p><p><text><SENT sid="59" pm="."><plain>The posterior probability of a phylogenetic tree with topology \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\tau$\end{document} and branch lengths \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\mathbf{l} = (l_1, \dots, l_{2N-3})$\end{document} conditioned on \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\boldsymbol{\psi}$\end{document} follows from Bayes Theorem: \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}\[ \pi(\tau, \mathbf{l} \mid \boldsymbol{\psi}) = \frac{\mathbb{P}(\boldsymbol{\psi} \mid \tau, \mathbf{l}) \pi(\tau, \mathbf{l}) }{\mathbb{P}(\boldsymbol{\psi})}, \]\end{document} where \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\mathbb{P}(\boldsymbol{\psi} \mid \tau, \mathbf{l})$\end{document} is the phylogenetic likelihood calculated using the standard Felsenstein pruning algorithm (Felsenstein 2004), and \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\pi(\tau, \mathbf{l})$\end{document} is the prior on the topology and branch lengths of the phylogenetic tree. </plain></SENT>
<SENT sid="60" pm="."><plain>We define \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\hat \pi(\tau, \mathbf{l} \mid \boldsymbol{\psi})$\end{document} as the unnormalized posterior density \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\mathbb{P}(\boldsymbol{\psi} \mid \tau, \mathbf{l}) \pi(\tau, \mathbf{l})$\end{document}. </plain></SENT>
<SENT sid="61" pm="."><plain>For unrooted trees, branch length priors are usually assumed to be IID with a simple distribution such as truncated uniform or exponential. </plain></SENT>
<SENT sid="62" pm="."><plain>A prior can also be specified on the unrooted topologies, a common choice being the uniform distribution. </plain></SENT>
<SENT sid="63" pm="."><plain>The marginal likelihood of the model \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\mathbb{P}(\boldsymbol{\psi})=\sum \int{\mathbb{P}(\boldsymbol{\psi}, \tau, \mathbf{l})}$\end{document} is analytically intractable. </plain></SENT>
<SENT sid="64" pm="."><plain>Therefore, the joint posterior distribution is usually approximated using Monte Carlo methods. </plain></SENT>
</text></p></sec><sec id="SEC1.2"><title><text><SENT sid="65" pm="."><plain>Sequential Monte Carlo </plain></SENT>
</text></title><p><text><SENT sid="66" pm="."><plain>SMC algorithms are a class of sampling methods that have been extensively investigated in the context of sequential Bayesian inference. </plain></SENT>
<SENT sid="67" pm="."><plain>We consider that data arrive sequentially \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\psi_1, \dots, \psi_N$\end{document}, and we wish to update the approximation of a probability distribution. </plain></SENT>
</text></p><p><text><SENT sid="68" pm="."><plain>The idea is to track, at each generation \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$n$\end{document}, a collection of \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$K_n$\end{document} particles \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$t_1^n, \dots, t_{K_n}^n$\end{document} associated with positive weights \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$w_1^n, \dots, w_{K_n}^n$\end{document} whose empirical distribution converges to the target distribution \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\pi_n$\end{document} (the target distribution is the distribution of interest, in the present case a posterior distribution on trees). </plain></SENT>
</text></p><p><text><SENT sid="69" pm="."><plain>Given a collection of weighted particles from the previous generation \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$n$\end{document} the algorithm applies the three steps: resampling, mutation, and reweighting. </plain></SENT>
</text></p><p><text><SENT sid="70" pm="."><plain>The resampling step prunes particles associated with low weights. </plain></SENT>
<SENT sid="71" pm="."><plain>This step is optional and is typically triggered when the ESS (Beskos et al. 2014) of the particle collection drops below a predetermined threshold. </plain></SENT>
<SENT sid="73" pm="."><plain>The ESS for a collection of particles with normalized weight \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$w_i^n$\end{document} for the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$i$\end{document}th particle at generation \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$n$\end{document} is \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}\[ \operatorname{ESS}_n= \left(\sum_{i=1}^{K_n} w_i^n\right)^2 \left/ \sum_{i=1}^{K_n} (w_i^n)^2 \right.. \]\end{document} </plain></SENT>
</text></p><p><text><SENT sid="74" pm="."><plain>Resampling obtains \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$K_{n+1}$\end{document} particles, \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$s_1^{n}, \dots, s_{K_{n+1}}^{n}$\end{document}, via a multinomial distribution on the particles \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$t_1^{n}, \dots, t_{K_{n}}^{n}$\end{document} parameterized with the weights \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$w_1^{n}, \dots, w_{K_{n}}^{n}$\end{document}. </plain></SENT>
<SENT sid="75" pm="."><plain>Alternatively, more sophisticated resampling methods such as stratified resampling (Kitagawa 1996) and residual resampling can be used in order to reduce the variance of the new particle population (Doucet et al. 2001; Del Moral et al. 2012). </plain></SENT>
</text></p><p><text><SENT sid="78" pm="."><plain>The mutation step draws \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$K_{n+1}$\end{document} new particles from a proposal distribution \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$Q^n(s_i^{n} \rightarrow t_i^{n+1})$\end{document} for \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$i=1, \dots, K_{n+1}$\end{document}. </plain></SENT>
</text></p><p><text><SENT sid="79" pm="."><plain>The unnormalized weight \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\tilde{w}_{i}^{n+1}$\end{document} of each particle \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$t_i^{n+1}$\end{document} is updated: \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}\[ \tilde{w}_i^{n+1} = \frac{\hat \pi_{n+1}(t_i^{n+1})}{\hat \pi_{n}(s_i^{n}) Q^n(s_i^{n} \rightarrow t_i^{n+1})}; \]\end{document} </plain></SENT>
</text></p><p><text><SENT sid="80" pm="."><plain>In the OPSMC context, we can approximate the integral for any function \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\phi$\end{document} with respect to the posterior distribution \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\pi_{n}$\end{document} using normalized weights \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$w_i^{n}$\end{document}: \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}\[ \sum_{i=1}^{K_{n}} w_i^{n} \phi(t_i^{n}) \approx \frac{1}{V_n} \sum_\tau \int_{[0,\infty]^{2n-3}} \phi(\tau, l) \pi_{n}(\tau, l) dl, \]\end{document} where \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$V_n$\end{document} is the number of different topologies. </plain></SENT>
</text></p><p><text><SENT sid="81" pm="."><plain>The SMC sampler initializes each particle with equal weights \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$w_i^0 = 1/K_0$\end{document} for all \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$i = 1, \dots, K_0$\end{document}. </plain></SENT>
</text></p></sec><sec id="SEC1.3"><title><text><SENT sid="82" pm="."><plain>Online Phylogenetic Sequential Monte Carlo </plain></SENT>
</text></title><p><text><SENT sid="83" pm="."><plain>Given an initial set of phylogenetic trees that represent a sample from the posterior distribution, we set out to update the posterior approximation represented by these samples with new sequences using an OPSMC. </plain></SENT>
</text></p><p><text><SENT sid="84" pm="."><plain>In the OPSMC context, each particle represents a phylogenetic tree. </plain></SENT>
<SENT sid="85" pm="."><plain>These particles are initialized using a sample of trees generated by a Bayesian method such as the MCMC algorithm implemented in MrBayes. </plain></SENT>
</text></p><p><text><SENT sid="86" pm="."><plain>While the state space of standard SMCs is of fixed dimension, the model complexity and dimension in the OPSMC setting increases as the number of taxa increases. </plain></SENT>
<SENT sid="87" pm="."><plain>Indeed, the number of tree topologies increases superexponentially with the number of taxa for both rooted and unrooted trees (St. John 2016). </plain></SENT>
<SENT sid="88" pm="."><plain>In addition to the discrete component of the tree space, the addition of each taxon requires additional continuous parameters. </plain></SENT>
<SENT sid="89" pm="."><plain>For rooted trees with a molecular clock, each additional taxon introduces two new parameters (the coalescence time and the identity of the branch where the new lineage attaches) whereas three parameters are introduced in the nonclock case: the attachment branch, the attachment position on the attachment branch, and the length of the pendant branch leading to the new taxon. </plain></SENT>
<SENT sid="90" pm="."><plain>Unless stated otherwise, in the rest of the article trees are assumed to be unrooted with no clock and that the continuous-time Markov mutation process is reversible. </plain></SENT>
<SENT sid="91" pm="."><plain>Nevertheless, it will be convenient for the purposes of description that the trees have been given an arbitrary root. </plain></SENT>
</text></p><p><text><SENT sid="92" pm="."><plain>The OPSMC algorithm assumes that sequences arrive sequentially one by one: even if several new sequences have become available, every particle will incorporate the same sequence at a given generation. </plain></SENT>
<SENT sid="93" pm="."><plain>This simplification circumvents the overcounting problem highlighted in Bouchard-Côté et al. (2012) and Wang et al. (2015) who showed that uniform tree proposals were biased toward balanced tree topologies. </plain></SENT>
<SENT sid="94" pm="."><plain>It should be clear that, unlike previously described phylogenetic SMCs, the OPSMC method does not require specifying an extension over a forest of trees since each particle represents a single tree. </plain></SENT>
</text></p><p><text><SENT sid="95" pm="."><plain>Each of the proposals follows a three step process: </plain></SENT>
</text></p><p><text><SENT sid="96" pm="."><plain>Choose an attachment branch \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$e$\end{document} from \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$2n-3$\end{document} branches.Choose location \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$x$\end{document} along \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$e$\end{document} to attach the new taxon. </plain></SENT>
<SENT sid="97" pm="."><plain>We refer to \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$x$\end{document} as the distal length: distance from the attachment location to the end of the edge that is farthest away from the root of the tree. </plain></SENT>
<SENT sid="98" pm="."><plain>In these proposals, the length of the attachment branch does not change.Propose a new pendant branch length \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$y$\end{document} leading to the new taxon. </plain></SENT>
</text></p><p><text><SENT sid="99" pm="."><plain>One can mix and match choices for each of these steps from the following strategies. </plain></SENT>
</text></p><p><text><SENT sid="100" pm="."><plain>We encode each step with a single letter to distinguish among the possible methods used at that step (Table 1). </plain></SENT>
<SENT sid="101" pm="."><plain>We will use the resulting three-letter code to describe a complete proposal strategy: for example the LAF proposal uses the L method for the first step, A for the second step, and F for the third step. </plain></SENT>
<SENT sid="102" pm="."><plain>Some of the methods are decorated with a tilde in order to distinguish heated from unheated proposals (the exact meaning of a heated proposal will be clarified below). </plain></SENT>
</text></p><p><text><SENT sid="103" pm="."><plain>Table 1.A summary of the proposal distributions for the three steps: first, sampling an attachment edge, second, sampling a position at which to attach the new pendant branch, and third, sampling a pendant branch lengthStep 1Step 2Step 3   Uniform [\documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{U}}$\end{document}] \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$ X \sim \mathcal{U}(0, |e|)$\end{document} [U] \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$Y \sim \operatorname{Exp}(\lambda=10)$\end{document} [P]Likelihood [\documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}]/[L] \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$X \sim \mathcal{N} (x_{\text{MLE}},\,|e|/4)$\end{document}, \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$0 \leq X \leq |e|$\end{document} [N] \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$Y \sim \operatorname{Exp}(\lambda=1/y_{\text{MLE}})$\end{document} [M]Parsimony [\documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{P}}$\end{document}]/[P] \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$X \sim \mathcal{N} (x_{\text{MLE}},\,I(x_{\text{MLE}})^{-1/2})$\end{document}, \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$0 \leq X \leq |e|$\end{document} [A] \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$Y \sim \textsf{lcfit}$\end{document} [F]Notes: The one-letter code of each sampling strategy is between square brackets. </plain></SENT>
<SENT sid="104" pm="."><plain>In Step 1, the one-letter code is decorated with a tilde for nonheated proposal. </plain></SENT>
</text></p><p><text><SENT sid="105" pm="."><plain>In the remainder of this section, we describe different proposals for each of the three steps and for each step two broad classes of methods are described. </plain></SENT>
<SENT sid="106" pm="."><plain>The simplest methods are called unguided proposals. </plain></SENT>
<SENT sid="107" pm="."><plain>Although unguided proposals are fast and simple to implement they tend to generate a very large number of particles with low likelihoods. </plain></SENT>
<SENT sid="108" pm="."><plain>This causes much CPU time to be expended on calculating likelihoods and SMC weights for particles that ultimately drop out of the posterior approximation during the weighted resampling step. </plain></SENT>
<SENT sid="109" pm="."><plain>Guided proposals refer to more complex methods that use the data to get more accurate proposals. </plain></SENT>
</text></p><p><text><SENT sid="110" pm="."><plain>Step 1: attachment branch choice.— Uniform (\documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{U}}$\end{document}) proposals: The unguided uniform proposals are the simplest proposal scheme investigated in this article, and they bear similarities to the “PriorPrior” proposal described in Teh et al. (2008). </plain></SENT>
<SENT sid="111" pm="."><plain>In our implementation of uniform proposals, the attachment branch is chosen uniformly among all branches. </plain></SENT>
<SENT sid="112" pm="."><plain>Alternatively, the branch can be selected with weight proportional to its length.Likelihood (\documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}) proposals: For each branch in the current tree, an attachment weight for the new taxon is calculated as described below. </plain></SENT>
<SENT sid="113" pm="."><plain>The attachment branch is then drawn randomly according to a multinomial distribution parameterized with the attachment branch weights.Calculating the maximum likelihood attachment configuration for each branch is computationally expensive, so we instead resort to a heuristic approach inspired by a similar strategy used in \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{pplacer}$\end{document} (Matsen et al. 2010). </plain></SENT>
<SENT sid="115" pm="."><plain>The new taxon is attached in the middle of each branch and likelihoods are calculated using a set of predetermined branch lengths. </plain></SENT>
<SENT sid="116" pm="."><plain>By default OPSMC calculates the tree likelihood with pendant branch length equal to 0 and separately with the pendant branch length set to the median branch length from the first tree in the initial posterior sample of trees we want to update with the new taxa.This allows discarding branches that are unlikely candidates (i.e. low probability) for attaching the new taxon. </plain></SENT>
<SENT sid="117" pm="."><plain>The resulting attachment location is selected from a multinomial distribution with weights equal to the highest likelihood among the set of pendant branch lengths tested for each branch.This heuristic could be refined at the cost of additional compute time. </plain></SENT>
<SENT sid="118" pm="."><plain>For example the likelihood profile of a fixed number of edges with the highest attachment probability can be improved by testing more attachment locations and additional potential pendant branch lengths (e.g., {0, median/2, median} instead of {0, median}). </plain></SENT>
<SENT sid="119" pm="."><plain>Alternatively, the posterior probability of attachment on each branch could be calculated directly (Matsen et al. 2010); however, this may be too time consuming to be a practical improvement.Parsimony (\documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{P}}$\end{document}) proposal: Alternatively, multinomial weights can be derived using parsimony scores, which are simply calculated using the first pass of the Fitch (1971) algorithm. </plain></SENT>
<SENT sid="121" pm="."><plain>The unnormalized attachment weight \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\tilde{g}_i$\end{document} for the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$i$\end{document}th branch is calculated with the heuristic \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}\[ \tilde{g}_i = \exp(\min(S) - s_i), \]\end{document} where \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$S=(s_i, \dots, s_{2n-3})$\end{document} is a vector containing the parsimony score of each attachment branch.Heated parsimony (P) and likelihood (L) proposals: Through our simulations we noted that when simply normalizing the parsimony scores or likelihoods to a sampling distribution, the probability of the highest scoring branch is often several log units higher than the attachment probabilities of the other branches. </plain></SENT>
<SENT sid="122" pm="."><plain>Therefore, the proposal often chooses the same branch with high probability. </plain></SENT>
<SENT sid="123" pm="."><plain>Unfortunately, for some sequences and tree configurations this attachment branch proposal algorithm can, with high probability, propose tree topologies that have low posterior support. </plain></SENT>
<SENT sid="124" pm="."><plain>That is, the attachment branch proposal distribution and posterior distribution can be poorly matched for some trees and sequences.To mitigate the impact of poorly matching proposal and posterior distributions, we explored a “heated” proposal distribution created by raising the attachment probabilities to the power \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\alpha = 0.05$\end{document}. </plain></SENT>
<SENT sid="125" pm="."><plain>This approach is inspired by the Metropolis-coupled MCMC method (Geyer 1991) in which the posterior distribution of a hot chain is exponentiated with a number less than one, hence flattening out the posterior distribution. </plain></SENT>
<SENT sid="126" pm="."><plain>The one-letter code of nonheated proposals is decorated with a tilde. </plain></SENT>
<SENT sid="127" pm="."><plain>For example, \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document} refers to the nonheated likelihood-based proposal, and \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textrm{L}$\end{document} denotes the corresponding heated proposal. </plain></SENT>
<SENT sid="128" pm="."><plain>In our implementation, \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\alpha$\end{document} was chosen by evaluating a range of possible values on an independent simulated test data set and is fixed throughout the simulations presented in the result section. </plain></SENT>
<SENT sid="129" pm="."><plain>Tuning the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\alpha$\end{document} parameter might improve the efficiency of the sampler. </plain></SENT>
<SENT sid="130" pm="."><plain>We have not explored this possibility.Step 2: distal length choice.— Uniform (U) proposal: The location on the attachment branch \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$e$\end{document} to attach the pendant branch is drawn from a uniform distribution, \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$X \sim \mathcal{U}(0, |e|)$\end{document}, where \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$|e|$\end{document} is the length of branch \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$e$\end{document}.Maximum likelihood normal (N) proposal: In this proposal scheme, the attachment location along branch \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$a$\end{document} of the new branch and the pendant branch length are coestimated using maximum likelihood. </plain></SENT>
<SENT sid="131" pm="."><plain>The distal length \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$x$\end{document} is then drawn from a truncated normal distribution with location parameter \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\mu$\end{document} equal to the maximum likelihood estimate (MLE) of the distal branch length. </plain></SENT>
<SENT sid="132" pm="."><plain>The distribution is truncated below 0 and above the length of the attachment branch. </plain></SENT>
<SENT sid="133" pm="."><plain>The scale parameter \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\sigma$\end{document} is arbitrarily chosen to be \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\sigma=|e|/4$\end{document}. </plain></SENT>
<SENT sid="134" pm="."><plain>The distal length is set to 0 for \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$|e| &lt; 1 \times 10^{-8}$\end{document}.Maximum likelihood asymptotic (A) proposal: This method proceeds in the same manner as N, except that the standard deviation in the proposal distribution is found using the posterior distribution around its maximum. </plain></SENT>
<SENT sid="135" pm="."><plain>Specifically, we use a quadratic approximation to the log likelihood distribution \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\mathcal{L}$\end{document} centered on the MLE of \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$x$\end{document}. </plain></SENT>
<SENT sid="136" pm="."><plain>That is, \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}\[ X \sim \mathcal{N}(x_{\text{MLE}}, [I(x_{\text{MLE}})]^{-1/2}), \]\end{document} where \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$I(x_{\text{MLE}})$\end{document} is the observed information \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}\[ I(x_{\text{MLE}})=-\frac{d^2}{dx^2} \mathcal{L}(x_{\text{MLE}} \mid \boldsymbol{\psi}). \]\end{document}The MLE is obtained using the Brent method (Brent 1973), a standard univariate optimization technique, and the observed information is calculated using the analytic second derivative of the log-likelihood with respect to the branch length \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$x$\end{document}.Step 3: branch length choice.— Prior (P) proposal: The pendant branch length is simply drawn from the prior (e.g., \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$Y \sim \operatorname{Exp}(10)$\end{document}).Maximum likelihood (M) proposal: The first guided method to draw the pendant branch length is similar in spirit to Step 2: the branch length is drawn from an exponential distribution with mean equal to the MLE of the pendant branch as calculated in the previous step. \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{lcfit}$\end{document} (F) proposal: The second method makes use of a surrogate log-likelihood function to approximate the marginal posterior distribution of the pendant branch. </plain></SENT>
<SENT sid="137" pm="."><plain>This four-parameter surrogate function, called \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{lcfit}$\end{document}, is specialized to the task of approximating single-branch phylogenetic likelihood functions (<ext-link ext-link-type="uri" xlink:href="https://github.com/matsengrp/lcfit">https://github.com/matsengrp/lcfit</ext-link>; Claywell et al. 2017). </plain></SENT>
<SENT sid="139" pm="."><plain>For completeness we outline the method here.Let \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$f$\end{document} be the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{lcfit}$\end{document} function, which is defined by four non-negative parameters, and evaluated at branch lengths \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$t$\end{document}: \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{} \begin{align*} &amp; f(c,m,r,b;t)\\ &amp;\quad{} = c \log[(1+e^{-r(t+b)})/2] + m \log[(1-e^{-r(t+b)})/2]. \end{align*}\end{document}Ignoring the parameter \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$b$\end{document}, this is the log-likelihood function of the binary substitution model on a two-taxon sequence alignment with \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$c$\end{document} constant sites, \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$m$\end{document} mutated sites, and substitution rate \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$r$\end{document}. </plain></SENT>
<SENT sid="140" pm="."><plain>The parameter \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$b$\end{document} effectively allows truncation of the left-hand side of the curve, which enables modeling of likelihood curves with nonzero likelihood at \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$t=0$\end{document}. </plain></SENT>
</text></p><p><text><SENT sid="141" pm="."><plain>One can fit the likelihood curve efficiently with access to the maximum likelihood branch length, an estimate of the second derivative at this location, and several other sampled points. </plain></SENT>
<SENT sid="142" pm="."><plain>By setting the surrogate second derivative equal to the estimated second derivative at the maximum likelihood branch length, one reduces the fitting problem to a 2D fit which can be performed using least squares (Claywell et al. 2017). </plain></SENT>
<SENT sid="144" pm="."><plain>Once the parameters of the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{lcfit}$\end{document} surrogate are fit, one can use rejection sampling to obtain samples from the surrogate posterior formed by the product of the surrogate \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{lcfit}$\end{document} likelihood and the branch length prior. </plain></SENT>
</text></p></sec><sec id="SEC1.4"><title><text><SENT sid="145" pm="."><plain>Simulations </plain></SENT>
</text></title><p><text><SENT sid="146" pm="."><plain>We generated five replicates of 10, 50, and 100 taxon trees under the birth-death process (\documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\lambda=6$\end{document}, \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\mu=2$\end{document}) using the R package TreeSim (Stadler 2017). </plain></SENT>
<SENT sid="147" pm="."><plain>Data sets will be labeled DxTy where the x is the replicate index and the y corresponds to the number of taxa (e.g., data set D1T10 is the first of five data sets containing 10 taxa). </plain></SENT>
<SENT sid="148" pm="."><plain>For each tree a nucleotide alignment with 1000 sites was simulated using the Jukes–Cantor substitution model (JC69) using \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{bppseqgen}$\end{document} from the Bio++ package (Guéguen et al. 2013). </plain></SENT>
<SENT sid="150" pm="."><plain>The posterior distribution of each phylogeny was approximated in two independent runs using MrBayes with three chains (i.e., two heated chains) for 300,000 iterations, ensuring an average standard deviation of split frequencies (ASDSF) below 0.01. </plain></SENT>
<SENT sid="151" pm="."><plain>A uniform prior on the topology and an exponential prior with mean 0.1 on branch lengths were specified. </plain></SENT>
<SENT sid="152" pm="."><plain>The chain was thinned down to 1000 samples, of which the first 250 iterations were discarded. </plain></SENT>
</text></p><p><text><SENT sid="153" pm="."><plain>For each data set, 1, 3, or 5 sequences were removed and the posterior distribution of each tree was approximated again using MrBayes, as described above. </plain></SENT>
</text></p><p><text><SENT sid="154" pm="."><plain>The resulting posteriors were used as a starting point for inference with the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} software (described below). </plain></SENT>
<SENT sid="155" pm="."><plain>The, 1, 3, or 5 removed sequences were sequentially added to MrBayes posterior samples using \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} to approximate the full posterior. \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} used the same priors as in the MrBayes analysis. </plain></SENT>
<SENT sid="156" pm="."><plain>We tested various numbers of particles in our SMC runs, each of which was a multiple of the number of trees in the original sample (in this case, 750). </plain></SENT>
<SENT sid="157" pm="."><plain>Define the particle factor to be the number of particles in the SMC divided by the number of trees in the original sample. </plain></SENT>
<SENT sid="158" pm="."><plain>If we use a particle factor of two and the MrBayes tree file contains 100 trees, then the total number of particles throughout the analysis will be 200. </plain></SENT>
<SENT sid="159" pm="."><plain>In other words, \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} will generate two particles for each tree in the Mrbayes tree file. </plain></SENT>
</text></p></sec></sec></SecTag><SecTag type="RESULTS"><sec sec-type="results" id="SEC2"><title><text><SENT sid="160" pm="."><plain>Results </plain></SENT>
</text></title><p><text><SENT sid="161" pm="."><plain>We implemented a prototype of OPSMC in an open source software package called \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document}. \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} implements several different transition kernels for updating a phylogenetic posterior with new sequences. </plain></SENT>
<SENT sid="162" pm="."><plain>These transition kernels are described in detail in the Methods section and include a uniform proposal and more sophisticated proposals that were developed with the aim of sampling updated trees more efficiently. </plain></SENT>
<SENT sid="163" pm="."><plain>As a prototype developed to test transition kernels rather than for practical use, the current \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} software implements only the JC69 model and uses the stratified resampling technique (Kitagawa 1996) as implemented in SMCTC (Johansen 2009). </plain></SENT>
<SENT sid="164" pm="."><plain>The current \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} implementation can update an existing posterior distribution produced by MrBayes with new sequences. \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} is available from <ext-link ext-link-type="uri" xlink:href="http://github.com/OnlinePhylo/sts">http://github.com/OnlinePhylo/sts</ext-link>. </plain></SENT>
</text></p><p><text><SENT sid="165" pm="."><plain>We evaluated the sequence addition proposals on data sets consisting of 10, 50, and 100 taxa using a variety of proposal step combinations for the transition kernel. </plain></SENT>
<SENT sid="166" pm="."><plain>These proposal combinations are indicated using a three letter code as described above. </plain></SENT>
<SENT sid="167" pm="."><plain>For example, in the following results “\documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{U}}$\end{document}UP” denotes a nonheated transition kernel constructed by proposing a branch uniformly at random (Step 1 \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{U}}$\end{document}), then proposing an attachment location uniformly along this branch (Step 2 U), and finally drawing a pendant branch length from the prior (Step 3 P). </plain></SENT>
</text></p><p><text><SENT sid="168" pm="."><plain>In order to understand whether OPSMC is providing an accurate posterior approximation, we compare the OPSMC results after the addition of 1, 2, and 5 sequences to what was obtained by running MrBayes on the same data sets. </plain></SENT>
<SENT sid="169" pm="."><plain>In what follows, we present the results based on data sets D1T50 and D1T100 in detail. </plain></SENT>
<SENT sid="170" pm="."><plain>Analysis of the other data sets showed similar results, and these are provided as <ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/sysbio/article-lookup/doi/10.1093/sysbio/syx090#supplementary-data">supplementary material</ext-link> available on Dryad at <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.5061/dryad.n7n85">http://dx.doi.org/10.5061/dryad.n7n85</ext-link>. </plain></SENT>
</text></p><sec id="SEC2.1"><title><text><SENT sid="171" pm="."><plain>ESS from OPSMC </plain></SENT>
</text></title><p><text><SENT sid="172" pm="."><plain>In the following sections, we report the final ESS of the particle population in the last iteration before resampling. </plain></SENT>
<SENT sid="173" pm="."><plain>The guided proposals showed clearly superior ESS compared to the uniform proposal with any particle factor (Fig. 2). </plain></SENT>
<SENT sid="174" pm="."><plain>The ESS produced by guided proposals also shows a strong linear relationship with the number of particles. </plain></SENT>
<SENT sid="175" pm="."><plain>This relationship was predicted by Dinh et al. (2016), where the ESS of the sampler was bounded below by a constant multiple of the number of particles. </plain></SENT>
<SENT sid="176" pm="."><plain>These linear regressions have different slopes, suggesting that as the user targets higher ESSs the differences between proposals become more important. </plain></SENT>
<SENT sid="177" pm="."><plain>In Figure 2, we find that proposals using likelihood to select an attachment branch (Step 1 L) have higher ESS than parsimony, while use of \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{lcfit}$\end{document} to propose pendant branch lengths (Step 3 F) yields a large advantage in ESS. </plain></SENT>
</text></p><SecTag type="FIG"><fig id="F2" orientation="portrait" position="float"><label>Figure 2.</label><caption><p><text><SENT sid="178" pm="."><plain>Mean ESS as a function of the particle factor across every data set. </plain></SENT>
</text></p></caption><graphic xlink:href="syx090f2"/></fig></SecTag><p><text><SENT sid="179" pm="."><plain>As discussed further below, we unfortunately cannot always equate high ESS with good quality posterior samples since ESS alone does not guarantee the OPSMC is sampling a high-probability region. </plain></SENT>
<SENT sid="180" pm="."><plain>Therefore, we performed a detailed comparison with the MrBayes posteriors. </plain></SENT>
</text></p></sec><sec id="SEC2.2"><title><text><SENT sid="181" pm="."><plain>Comparison of Posteriors from SMC and MrBayes MCMC </plain></SENT>
</text></title><p><text><SENT sid="182" pm="."><plain>We investigated the difference of split frequencies between the samples generated by \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} and MrBayes. </plain></SENT>
<SENT sid="183" pm="."><plain>Split frequencies for each tree were calculated using scripts from Bali-Phy (Suchard and Redelings 2006). </plain></SENT>
<SENT sid="184" pm="."><plain>As a reference, we calculated the absolute differences between split posteriors generated by two independent chains in MrBayes. </plain></SENT>
<SENT sid="185" pm="."><plain>Similarly, we calculated the absolute difference between split frequencies between trees generated from one of the two MrBayes runs and the tree sample generated by \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document}. Figures 3 and 4 shows the absolute difference between split frequencies using the LAF and PAF on several data sets. </plain></SENT>
<SENT sid="186" pm="."><plain>Under the assumption that the MCMC implemented in MrBayes has been run long enough to accurately approximate the true posterior, the ability of each OPSMC proposal scheme to approximate the true posterior distribution can be assessed by comparing the distribution of their split frequencies to that produced by MrBayes. </plain></SENT>
<SENT sid="187" pm="."><plain>The split distribution for every analysis (Table 2 and <ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/sysbio/article-lookup/doi/10.1093/sysbio/syx090#supplementary-data">Supplementary</ext-link> Figs. </plain></SENT>
<SENT sid="188" pm="."><plain>S11–S25 available on Dryad) confirms the superiority of LAF and PAF over less sophisticated proposals. </plain></SENT>
<SENT sid="189" pm="."><plain>We also measured the distance between the maximum likelihood tree inferred with PhyML (Guindon et al. 2010) and each tree in the MrBayes posterior samples and the OPSMC posterior samples using the weighted Robinson–Foulds (L1-norm) distance (Robinson and Foulds 1981) calculated with the DendroPy library (Sukumaran and Holder 2010). </plain></SENT>
<SENT sid="191" pm="."><plain>The results also suggest that guided proposals, especially PAF and LAF, yield superior posterior approximations to those produced by \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{U}}$\end{document}UP (<ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/sysbio/article-lookup/doi/10.1093/sysbio/syx090#supplementary-data">Supplementary</ext-link> Figs. </plain></SENT>
<SENT sid="192" pm="."><plain>S26–S40 available on Dryad). </plain></SENT>
</text></p><SecTag type="FIG"><fig id="F3" orientation="portrait" position="float"><label>Figure 3.</label><caption><p><text><SENT sid="193" pm="."><plain>Absolute value of the difference between the split frequencies of \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} and MrBayes. </plain></SENT>
<SENT sid="194" pm="."><plain>These results are for data set D1T50. </plain></SENT>
<SENT sid="195" pm="."><plain>Labels on the right of the y-axis indicate which taxa were removed. </plain></SENT>
</text></p></caption><graphic xlink:href="syx090f3"/></fig></SecTag><SecTag type="FIG"><fig id="F4" orientation="portrait" position="float"><label>Figure 4.</label><caption><p><text><SENT sid="196" pm="."><plain>Absolute value of the difference between the split frequencies of \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} and MrBayes. </plain></SENT>
<SENT sid="197" pm="."><plain>These results are for data set D1T100. </plain></SENT>
<SENT sid="198" pm="."><plain>Labels on the right of the y-axis indicate which taxa were removed. </plain></SENT>
</text></p></caption><graphic xlink:href="syx090f4"/></fig></SecTag><p><text><SENT sid="199" pm="."><plain>Table 2.Summary statistics of the absolute value of the difference between the split frequencies of \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} and MrBayes These results are for data set D1T10 with particle factors equal to 1 and 100 Particle factor 1Particle factor 100ProposalMeanStandard deviationMeanStandard deviation \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{U}}$\end{document}UP0.121840.189940.0298680.05839 \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}NM0.043560.090560.0146810.03399 \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}AF0.015900.036000.0140100.03067LAF0.011850.022750.0094470.01598PAF0.013760.024320.0092280.01551Notes: These results are for data set D1T10 with particle factors equal to 1 and 100. </plain></SENT>
</text></p></sec><sec id="SEC2.3"><title><text><SENT sid="200" pm="."><plain>Measuring Convergence with the Average Standard Deviation of Split Frequencies (ASDSF) </plain></SENT>
</text></title><p><text><SENT sid="201" pm="."><plain>The average standard deviation of split frequencies (ASDSF) (Lakner et al. 2008; Ronquist et al. 2012) is a widely employed statistic used to assess the convergence of independent MCMC analyses. </plain></SENT>
<SENT sid="204" pm="."><plain>The ASDSF approaches zero when the set of topologies contained in the posterior approximations of different Monte Carlo sampling runs have converged. </plain></SENT>
<SENT sid="205" pm="."><plain>We used this metric to determine whether the posterior approximation produced by sequential taxon addition in \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} is similar to that which would have been produced by simply running MrBayes on the complete data set. </plain></SENT>
<SENT sid="206" pm="."><plain>We calculated the ASDSF between the updated posterior distribution generated by \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} and an independent MrBayes analysis on the full data set. </plain></SENT>
<SENT sid="207" pm="."><plain>It is common practice to use ASDSF as a convergence criterion, stopping Bayesian MCMC once the ASDSF is less than 0.01 (Lakner et al. 2008). </plain></SENT>
</text></p><p><text><SENT sid="209" pm="."><plain>We find that that guided proposals can yield an ASDSF less than 0.01, even with relatively small particle factors (Fig. 5 and <ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/sysbio/article-lookup/doi/10.1093/sysbio/syx090#supplementary-data">Supplementary</ext-link> Figs. </plain></SENT>
<SENT sid="210" pm="."><plain>S7–S9 available on Dryad). </plain></SENT>
<SENT sid="211" pm="."><plain>In contrast, unguided proposals such as \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{U}}$\end{document}UP consistently yielded posterior approximations with an ASDSF that was an order of magnitude higher (worse), even when large particle systems were employed (particle factor 100, with 75,000 particles). </plain></SENT>
<SENT sid="212" pm="."><plain>Also, the simple likelihood-based guided proposals (Step 1 \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}) fail to yield posterior approximations that meet the convergence criterion, whereas their heated relatives perform much better. </plain></SENT>
</text></p><SecTag type="FIG"><fig id="F5" orientation="portrait" position="float"><label>Figure 5.</label><caption><p><text><SENT sid="213" pm="."><plain>Average standard deviation of split frequencies (ASDSF) between \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} and MrBayes posterior samples. </plain></SENT>
<SENT sid="214" pm="."><plain>These results are for the three data sets D1T10, D1T50, D1T100, and include several particle factors. </plain></SENT>
<SENT sid="215" pm="."><plain>The first row shows the results for every proposal while the second row only shows the LAF and PAF results. </plain></SENT>
<SENT sid="216" pm="."><plain>The horizontal line represents the ASDSF calculated using two chains in MrBayes. </plain></SENT>
<SENT sid="217" pm="."><plain>The horizontal dashed line marks 0.01, a common convergence criterion. </plain></SENT>
</text></p></caption><graphic xlink:href="syx090f5"/></fig></SecTag><p><text><SENT sid="218" pm="."><plain>We also investigated OPSMC’s ability to build trees without a starting set of trees using \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} with the LAF proposal. </plain></SENT>
<SENT sid="219" pm="."><plain>Most of the tree samples for data sets containing 10 taxa appeared to be good posterior approximations, as suggested by the ASDSF (<ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/sysbio/article-lookup/doi/10.1093/sysbio/syx090#supplementary-data">Supplementary</ext-link> Fig. </plain></SENT>
<SENT sid="220" pm="."><plain>S10 available on Dryad). </plain></SENT>
<SENT sid="221" pm="."><plain>In contrast, the posterior distributions of larger data sets were poorly approximated, with only a few replicates yielding ASDSFs below 0.01. </plain></SENT>
</text></p></sec><sec id="SEC2.4"><title><text><SENT sid="222" pm="."><plain>Compute Time of OPSMC Proposal Schemes </plain></SENT>
</text></title><p><text><SENT sid="223" pm="."><plain>In previous studies of phylogenetic SMC (Bouchard-Côté et al. 2012; Wang et al. 2015), the number of peeling recurrences were used as a proxy to compare the running time of different proposals. </plain></SENT>
<SENT sid="226" pm="."><plain>Since some nonlikelihood aspects of our implementation (such as calculation of the parsimony score in the PAF proposal) incur a non-negligible compute load, we directly investigated the wall clock time for each proposal instead. </plain></SENT>
</text></p><p><text><SENT sid="227" pm="."><plain>As expected, we find that uniform proposals are at least an order of magnitude faster per proposal operation than the guided proposals (<ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/sysbio/article-lookup/doi/10.1093/sysbio/syx090#supplementary-data">Supplementary</ext-link> Figs. </plain></SENT>
<SENT sid="228" pm="."><plain>S4–S6 available on Dryad). </plain></SENT>
<SENT sid="229" pm="."><plain>The timing results also suggest that in the current implementation, the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{lcfit}$\end{document} approximation (Step 3 F) incurs a significant cost in compute time relative to the other approaches. </plain></SENT>
</text></p><p><text><SENT sid="230" pm="."><plain>However, when measured in terms of compute time required per unit of ESS in the resulting sample, we find that the guided proposals outperform \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{U}}$\end{document}UP by a large margin (Fig. 6). </plain></SENT>
<SENT sid="231" pm="."><plain>We note that in SMC, a high ESS is necessary (but not sufficient) for an accurate posterior approximation. </plain></SENT>
<SENT sid="232" pm="."><plain>Interestingly, the results show that the extra compute time used by the normal approximation in Step 2 and \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{lcfit}$\end{document} in Step 3 may be justified since the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}AF proposal has on average superior ESS per unit time relative to \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}NM. </plain></SENT>
<SENT sid="233" pm="."><plain>For some replicates (e.g., D5T10) the runtime-to-ESS ratio is much higher for the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}NM and \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}AF proposals than for the heated proposals. </plain></SENT>
<SENT sid="234" pm="."><plain>The ESSs of those runs are extremely low (<ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/sysbio/article-lookup/doi/10.1093/sysbio/syx090#supplementary-data">Supplementary</ext-link> Fig. </plain></SENT>
<SENT sid="235" pm="."><plain>S2 available on Dryad), highlighting that some data sets are more difficult to analyze (see also <ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/sysbio/article-lookup/doi/10.1093/sysbio/syx090#supplementary-data">Supplementary</ext-link> Figs. </plain></SENT>
<SENT sid="236" pm="."><plain>S1–S3 available on Dryad). </plain></SENT>
</text></p><SecTag type="FIG"><fig id="F6" orientation="portrait" position="float"><label>Figure 6.</label><caption><p><text><SENT sid="237" pm="."><plain>Running time in minutes per ESS unit for each proposal method. </plain></SENT>
<SENT sid="238" pm="."><plain>These results are for every data set and include all five particle factors. </plain></SENT>
<SENT sid="239" pm="."><plain>Numerical labels on top of each subplot give the number of taxa in each data set. </plain></SENT>
</text></p></caption><graphic xlink:href="syx090f6"/></fig></SecTag><p><text><SENT sid="240" pm="."><plain>Next, we evaluated compute time in a situation that commonly arises in genomic epidemiology, where an updated phylogenetic posterior is desired every time a new sequence becomes available. </plain></SENT>
<SENT sid="241" pm="."><plain>We thus simulated the sequential arrival of five taxa, comparing the time required for \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} to update posteriors against the approach of sampling each of the five posteriors from scratch with MCMC. </plain></SENT>
<SENT sid="242" pm="."><plain>These new sequences are added to an existing data set containing 45 or 95 sequences. </plain></SENT>
<SENT sid="243" pm="."><plain>In an offline setting, this is equivalent to running MrBayes once each on alignments containing 46 to 50 or 96 to 100 sequences. </plain></SENT>
<SENT sid="244" pm="."><plain>We compared the total amount of time for the five MrBayes runs to a single run of \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} with the same five sequences. </plain></SENT>
<SENT sid="245" pm="."><plain>For each method, we report the minimum particle factor required to compute a posterior approximation that meets the widely used Monte Carlo convergence criterion of an ASDSF lower than 0.01 (Fig. 7). </plain></SENT>
<SENT sid="246" pm="."><plain>For example, using LAF on data set D1T10, the ASDSFs obtained with particle factors 1, 5, 10, 50, and 100 were 0.011, 0.009, 0.007, 0.006, and 0.006 respectively. </plain></SENT>
<SENT sid="247" pm="."><plain>We therefore report the running time associated with particle factor 5 since it is the lowest particle factor with ASDSF below 0.01. </plain></SENT>
<SENT sid="248" pm="."><plain>The plot shows the results based on ten data sets (D1T50-D5T50 and D1T100-D5T100) that we described above and for each replicate the five sequences were sequentially added in three different orders across three runs. </plain></SENT>
<SENT sid="249" pm="."><plain>Runs from \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} that do not reach an ASDSF below 0.01 are not included in the plots, therefore each panel contains at most 15 points for \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document}. </plain></SENT>
<SENT sid="250" pm="."><plain>We find that \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} is faster than MrBayes and that PAF and LAF required a particle factor of only one in 11 and 14 cases, respectively, for data sets containing 50 sequences. </plain></SENT>
<SENT sid="251" pm="."><plain>LAF performed marginally better than PAF for the larger 100 taxon data set, wherein the LAF proposal reached the target ASDSF 12 times while PAF reached it 11 times (<ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/sysbio/article-lookup/doi/10.1093/sysbio/syx090#supplementary-data">Supplementary</ext-link> Table S1 available on Dryad). </plain></SENT>
<SENT sid="252" pm="."><plain>In contrast, \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{U}}$\end{document}UP was not able to sample trees that would meet the convergence criterion. </plain></SENT>
</text></p><SecTag type="FIG"><fig id="F7" orientation="portrait" position="float"><label>Figure 7.</label><caption><p><text><SENT sid="253" pm="."><plain>Running time in minutes (on a log scale) to sequentially add five new sequences to a data set of 45 or 95 sequences with MrBayes and \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document}. </plain></SENT>
<SENT sid="254" pm="."><plain>Here \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} is run with particle factors ranging from 1 to 100 and the lowest time reported that achieved an ASDSF less than 0.010. </plain></SENT>
<SENT sid="255" pm="."><plain>Runs for which no particle factors resulted in an ASDSF less than 0.010 are not shown on the plot. </plain></SENT>
<SENT sid="256" pm="."><plain>Results are based on five data sets in which the taxa were added in three different orders, resulting in at most 15 data points. </plain></SENT>
<SENT sid="257" pm="."><plain>For example, the LAF plots contain 14 and 12 data points for data sets consisting of 50 and 100 sequences, respectively (see <ext-link ext-link-type="uri" xlink:href="https://academic.oup.com/sysbio/article-lookup/doi/10.1093/sysbio/syx090#supplementary-data">Supplementary</ext-link> Table S1 available on Dryad for a full description of the other proposals). </plain></SENT>
</text></p></caption><graphic xlink:href="syx090f7"/></fig></SecTag><p><text><SENT sid="258" pm="."><plain>The other nonheated methods provide intermediate results. </plain></SENT>
<SENT sid="259" pm="."><plain>We note that opportunities exist for further reduction of compute time required for \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} (see Discussion), and that more significant efforts have been made to optimize MrBayes 3.2 (Ronquist et al. 2012), so the results here could be interpreted as a rough lower bound for the speed advantage that OPSMC may have over sequential runs of MCMC. </plain></SENT>
</text></p></sec></sec></SecTag><SecTag type="DISCUSS"><sec sec-type="discussion" id="SEC3"><title><text><SENT sid="261" pm="."><plain>Discussion </plain></SENT>
</text></title><p><text><SENT sid="262" pm="."><plain>Here, we have implemented the OPSMC framework described by Dinh et al. (2016) and evaluated how several alternative proposal schemes behave on synthetic data sets. </plain></SENT>
</text></p><sec id="SEC3.1"><title><text><SENT sid="263" pm="."><plain>Related Work </plain></SENT>
</text></title><p><text><SENT sid="264" pm="."><plain>Everitt et al. (2016) have also developed theory and an implementation for SMC on phylogenies. </plain></SENT>
<SENT sid="265" pm="."><plain>In their case, they are focused on inferring ultrametric trees in a coalescent framework, whereas OPSMC as described here is for unrooted trees. </plain></SENT>
<SENT sid="266" pm="."><plain>Their clever attachment proposal is described in terms of lineage (path from root to leaf) and branching time. </plain></SENT>
<SENT sid="267" pm="."><plain>They use proposals choosing lineage based on differences from the leaf to be attached and the existing leaves using a distribution based on Ewens’ sampling formula (Ewens 1972), and a branching time which also uses pairwise differences. </plain></SENT>
<SENT sid="268" pm="."><plain>They also make an interesting suggestion to ease the transition between the different posterior distributions by using “intermediate distributions.” However, they do not compare their output to samples from an existing MCMC phylogenetics package, and they have not yet provided an open source implementation that would allow others to do so. </plain></SENT>
</text></p></sec><sec id="SEC3.2"><title><text><SENT sid="269" pm="."><plain>Guided Proposals Work </plain></SENT>
</text></title><p><text><SENT sid="270" pm="."><plain>In contrast with previous suggestions (Bouchard-Côté et al. 2012), we show that guided proposal schemes can greatly improve both the computational efficiency and the accuracy of a phylogenetic posterior approximation over simple uniform proposal schemes. </plain></SENT>
<SENT sid="272" pm="."><plain>When quality of posterior approximation is measured by either the split frequencies (Figs. </plain></SENT>
<SENT sid="273" pm="."><plain>3 and 4) or ASDSF (Fig. 5), the LAF and PAF proposals clearly outperform the other schemes. </plain></SENT>
<SENT sid="274" pm="."><plain>Both LAF and PAF are able to achieve ASDSF below the 0.01 threshold that is typically used as an indicator of MCMC convergence, and can do so even with relatively small particle system sizes. </plain></SENT>
<SENT sid="275" pm="."><plain>This finding is especially important for the future application of SMC to phylogenetics, suggesting that proposal efficiency matters much more for SMC than MCMC. </plain></SENT>
</text></p></sec><sec id="SEC3.3"><title><text><SENT sid="276" pm="."><plain>High ESS Does Not Imply Accurate Posterior Approximation </plain></SENT>
</text></title><p><text><SENT sid="277" pm="."><plain>On the other hand the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}AF proposal provides the highest ESSs among any of the various proposal schemes, yet fails to achieve a low ASDSF, suggesting a poor posterior approximation. </plain></SENT>
<SENT sid="278" pm="."><plain>Detailed inspection of the behavior of \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}AF reveals that, without heating the likelihoods, the highest scoring attachment branch can be several log units above the others (including the correct branch), resulting in a multinomial weight close to 1 while the others are close to zero. </plain></SENT>
<SENT sid="279" pm="."><plain>The bias leads \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\widetilde{\textrm{L}}$\end{document}AF to always propose the same attachment branch even when a large particle system is employed, causing it to sample a narrow region of the tree space. </plain></SENT>
<SENT sid="280" pm="."><plain>The subsequent Steps 2 and 3 proposals yield a large number of configurations with similar weights, resulting in a high ESS. </plain></SENT>
</text></p></sec><sec id="SEC3.4"><title><text><SENT sid="281" pm="."><plain>Opportunities for Computational Optimization </plain></SENT>
</text></title><p><text><SENT sid="282" pm="."><plain>Path degeneracy is a well-known drawback of SMC algorithms, characterized by a large number of identical particles after the resampling step. </plain></SENT>
<SENT sid="283" pm="."><plain>However, path degeneracy offers an opportunity for computational optimization of guided proposals. </plain></SENT>
<SENT sid="284" pm="."><plain>The Step 1 proposal distributions for identical particles can be computed once and then reused. </plain></SENT>
<SENT sid="285" pm="."><plain>Similarly, Step 2 involves repeatedly calculating MLEs of the distal and pendant branch lengths, which are identical for identical trees. </plain></SENT>
<SENT sid="286" pm="."><plain>For the cost of a modest amount of bookkeeping, those estimates can be computed just once for each tree in the particle system, rather than once for each particle, yielding a significant speedup. </plain></SENT>
</text></p></sec><sec id="SEC3.5"><title><text><SENT sid="287" pm="."><plain>Limitations </plain></SENT>
</text></title><sec id="SEC3.5.1"><title><text><SENT sid="288" pm="."><plain>Limitations: OPSMC proposals. </plain></SENT>
</text></title><p><text><SENT sid="289" pm="."><plain>A common feature of the proposals we evaluated are that they consist of three steps: (i) selection of an attachment branch, (ii) selection of an attachment point on the attachment branch, and (iii) selection of a pendant branch length. </plain></SENT>
<SENT sid="290" pm="."><plain>However, the three step structure imposes some potentially undesirable restrictions on the resulting trees. </plain></SENT>
<SENT sid="291" pm="."><plain>One such restriction is that the length of the attachment branch selected in Step 1 is fixed, and is not adjusted in Steps 2 or 3. </plain></SENT>
<SENT sid="292" pm="."><plain>Another potential issue is that the length of two adjacent branches in a phylogenetic tree can be strongly correlated. </plain></SENT>
<SENT sid="293" pm="."><plain>The current three step proposal scheme does not account for this correlation structure. </plain></SENT>
<SENT sid="294" pm="."><plain>The efficiency of the sampler could in principle be increased by combining the proposals in Steps 2 and 3 to account for the dependency in lengths of the three branches incident to the attachment point. </plain></SENT>
<SENT sid="295" pm="."><plain>The branch lengths could be modeled as a multivariate truncated normal distribution where the covariance matrix captures correlations across branches. </plain></SENT>
<SENT sid="296" pm="."><plain>Alternatively, an extension of the surrogate function described in the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{lcfit}$\end{document} algorithm to multiple branches could improve the proposal. </plain></SENT>
</text></p></sec><sec id="SEC3.5.2"><title><text><SENT sid="297" pm="."><plain>Limitations: computational complexity. </plain></SENT>
</text></title><p><text><SENT sid="298" pm="."><plain>The computational complexity of choosing the attachment branch (i.e. Step 1) grows linearly with the number of taxa in the tree. </plain></SENT>
<SENT sid="299" pm="."><plain>Profiling of our implementation indicates that at the data set sizes we evaluated, Step 1 consumes less than 5% of total compute time. </plain></SENT>
<SENT sid="300" pm="."><plain>Nevertheless, scaling our approach to thousands of sequences or beyond is likely to require new heuristics or other techniques to reduce the time complexity of branch selection in Step 1. </plain></SENT>
<SENT sid="301" pm="."><plain>This is in contrast with drawing branch lengths in the other steps, which has a constant complexity with respect to the number of taxa. </plain></SENT>
<SENT sid="302" pm="."><plain>As in other standard SMCs, the memory requirement of \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} scales linearly with the number of particles. </plain></SENT>
<SENT sid="303" pm="."><plain>The development of memory-efficient (Jun and Bouchard-Côté 2014) and highly parallel (Paige et al. 2014) variants would be an essential step for scaling to large data sets. </plain></SENT>
</text></p></sec><sec id="SEC3.5.3"><title><text><SENT sid="305" pm="."><plain>Limitations: evolutionary models. </plain></SENT>
</text></title><p><text><SENT sid="306" pm="."><plain>The present work has focused on updating the tree topology and branch lengths in the very simple JC69 model of sequence evolution. </plain></SENT>
<SENT sid="307" pm="."><plain>In practice, richer phylogenetic models will almost always be preferred as they can provide a better fit to the sequence data, for example by modeling unequal rates of nucleotide substitution or clade-specific evolutionary rates. </plain></SENT>
<SENT sid="308" pm="."><plain>These additional model parameters are often continuous real-valued parameters. </plain></SENT>
<SENT sid="309" pm="."><plain>One way to sample these parameters was described and implemented by Bouchard and colleagues (Wang et al. 2015) who developed a method based on particle MCMC (Andrieu et al. 2010). </plain></SENT>
<SENT sid="312" pm="."><plain>Particle MCMC uses SMC on the tree topology and branch lengths to approximate the marginal likelihood of the remaining continuous parameters, which are sampled using MCMC moves. </plain></SENT>
<SENT sid="313" pm="."><plain>A similar particle MCMC approach, or another means to sample the evolutionary model parameters has yet to be developed in the context of online phylogenetic SMC. </plain></SENT>
</text></p></sec><sec id="SEC3.5.4"><title><text><SENT sid="314" pm="."><plain>Limitations: path degeneracy. </plain></SENT>
</text></title><p><text><SENT sid="315" pm="."><plain>OPSMC, like all SMC algorithms, is prone to path degeneracy, especially when the sampler iterates through generations with low ESS. </plain></SENT>
<SENT sid="316" pm="."><plain>As previously suggested (Bouchard-Côté et al. 2012; Dinh et al. 2016), the use of MCMC moves between generations of an SMC can help alleviate the path degeneracy problem. </plain></SENT>
<SENT sid="319" pm="."><plain>Although some simple MCMC moves have been implemented in \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document}, preliminary results suggest that such a large number of these simple moves would be required to address the path degeneracy problem that a better result can be achieved by simply using a larger particle system. Dinh et al. (2016) suggest a valid sampler could be constructed using any mix of MCMC and SMC moves, ranging from entirely SMC to almost entirely MCMC, but a thorough investigation of the optimal blend, incorporating known advanced MCMC proposals (Ronquist et al. 2012), is yet to be done. </plain></SENT>
</text></p></sec><sec id="SEC3.5.5"><title><text><SENT sid="321" pm="."><plain>Limitations: constraints on the properties of new sequences. </plain></SENT>
</text></title><p><text><SENT sid="322" pm="."><plain>In order to guarantee the quality of the OPSMC posterior approximation, the sequences to be added must satisfy certain properties described in the theoretical work of Dinh et al. (2016). </plain></SENT>
<SENT sid="323" pm="."><plain>In particular, the sequences to be added must introduce new branches with lengths that are similar to the average branch length of existing sequences. </plain></SENT>
<SENT sid="324" pm="."><plain>Addition of one or a series of outgroup taxa which introduce many long branches would not satisfy these criteria. </plain></SENT>
<SENT sid="325" pm="."><plain>Addition of such sequences has the potential to shift the posterior on clades present in earlier iterations of the SMC, leading to degeneracy, low ESS, and a poor approximation to the true posterior. </plain></SENT>
</text></p></sec><sec id="SEC3.5.6"><title><text><SENT sid="326" pm="."><plain>Limitations: convergence diagnostics. </plain></SENT>
</text></title><p><text><SENT sid="327" pm="."><plain>In the current work we have evaluated the accuracy of the OPSMC’s posterior approximation by comparing the sample to a collection of MCMC samples derived from MrBayes. </plain></SENT>
<SENT sid="328" pm="."><plain>This approach is inviable in practice, since an independent posterior approximation derived from MCMC will not generally be available. </plain></SENT>
<SENT sid="329" pm="."><plain>Further work is needed to develop and evaluate comparable approaches for convergence diagnostics to be used with OPSMC. </plain></SENT>
</text></p></sec></sec></sec></SecTag><SecTag type="CONCL"><sec sec-type="conclusions" id="SEC4"><title><text><SENT sid="330" pm="."><plain>Conclusion </plain></SENT>
</text></title><p><text><SENT sid="331" pm="."><plain>Phylogenetic inference is quickly becoming an essential tool in modern infectious disease epidemiology. </plain></SENT>
<SENT sid="332" pm="."><plain>When sequence data arrives continuously, as in the case of an outbreak, it would be preferable to simply update a previous analysis rather than recomputing results for all sequences. </plain></SENT>
<SENT sid="333" pm="."><plain>Here, we show that online Bayesian phylogenetics using Sequential Monte Carlo can be a practical means of updating an existing posterior. </plain></SENT>
<SENT sid="334" pm="."><plain>Our findings suggest that the choice of proposal distribution is especially important for successful inference with OPSMC, and to this end we have described several transition kernels and evaluated their strengths and weaknesses. </plain></SENT>
<SENT sid="335" pm="."><plain>We have also found that simple likelihood-based proposals can strongly bias the proposal distribution away from the posterior and have shown that smoothing of these proposals can yield a posterior approximation that meets the de facto standard criteria for topological convergence in phylogenetic MCMC. </plain></SENT>
<SENT sid="336" pm="."><plain>The current \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} implementation is limited to the simplest evolutionary models, and although our initial findings are promising, significant future work will be required to integrate the approach into the familiar software packages that implement the more complex evolutionary models in common use today. </plain></SENT>
</text></p><p><text><SENT sid="337" pm="."><plain>In the last two decades, MCMC has become the de facto standard method to approximate posterior distributions in phylogenetics. </plain></SENT>
<SENT sid="338" pm="."><plain>Although OPSMC has the attractive advantage over MCMC that it becomes possible to efficiently update a posterior distribution with new data, several challenges remain to be solved in order to realize this promise. </plain></SENT>
<SENT sid="339" pm="."><plain>At a minimum, work must be done to develop methods that jointly sample evolutionary model parameters and tree topologies in the OPSMC framework and to develop and evaluate appropriate methods to estimate the quality of posterior approximations computed via OPSMC. </plain></SENT>
<SENT sid="340" pm="."><plain>Combination of MCMC and SMC could in principle yield superior results to application of either approach in isolation, but the efficacy of such strategies remain largely unexplored. </plain></SENT>
<SENT sid="341" pm="."><plain>Research into OPSMC is still in its infancy and although we have demonstrated a proof of concept in the \documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{upgreek} \usepackage{mathrsfs} \setlength{\oddsidemargin}{-69pt} \begin{document} }{}$\textsf{sts}$\end{document} software, much work remains to be done before these approaches can be routinely applied in phylogenetics. </plain></SENT>
</text></p></sec></SecTag></body><back><SecTag type="AUTH_CONT"><ack><title>Acknowledgements</title><p>The authors would like to thank Aaron Gallagher for his early contributions to the <inline-formula><tex-math id="M162">\documentclass[12pt]{minimal}
\usepackage{amsmath}
\usepackage{wasysym} 
\usepackage{amsfonts} 
\usepackage{amssymb} 
\usepackage{amsbsy}
\usepackage{upgreek}
\usepackage{mathrsfs}
\setlength{\oddsidemargin}{-69pt}
\begin{document}
}{}$\textsf{sts}$\end{document}</tex-math></inline-formula> source code, and to Julien Dutheil and Bastien Boussau for assistance with the Bio++ suite.</p></ack></SecTag><SecTag type="SUPPL"><sec sec-type="materials"><title>Supplementary Material</title><p>Data available from the Dryad Digital Repository: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.5061/dryad.n7n85">http://dx.doi.org/10.5061/dryad.n7n85</ext-link>.</p></sec></SecTag><SecTag type="ACK_FUND"><sec><title>Funding</title><p><text4fund><text><SENT sid="342" pm="."><plain>This work was funded by National Science Foundation grants [DMS-1223057, CISE-1564137 to V.D. and F.A.M.]; National Institutes of Health grant [U54-GM111274 to V.D. and F.A.M.]; Faculty Scholar grant from the Howard Hughes Medical Institute and the Simons Foundation to F.A.M. </plain></SENT>
</text></text4fund></p></sec></SecTag><SecTag type="REF"><ref-list><title>References</title><ref id="B1"><text><SENT sid="343" pm="."><plain> AndrieuC.,DoucetA.,HolensteinR. 2010 Particle Markov chain Monte Carlo methods.J. </plain></SENT>
<SENT sid="344" pm="."><plain>R. </plain></SENT>
<SENT sid="345" pm="."><plain>Stat. </plain></SENT>
<SENT sid="346" pm="."><plain>Soc. </plain></SENT>
<SENT sid="347" pm="."><plain>Ser. </plain></SENT>
<SENT sid="348" pm="."><plain>B72:269–342. </plain></SENT>
</text></ref><ref id="B2"><text><SENT sid="349" pm="."><plain> BeskosA.,CrisanD.,JasraA. 2014 On the stability of sequential Monte Carlo methods in high dimensions.Ann. </plain></SENT>
<SENT sid="350" pm="."><plain>Appl. </plain></SENT>
<SENT sid="351" pm="."><plain>Probab.24:1396–1445. </plain></SENT>
</text></ref><ref id="B3"><text><SENT sid="352" pm="."><plain> Bouchard-CôtéA.,SankararamanS.,JordanM.I. 2012 Phylogenetic inference via sequential Monte Carlo.Syst. </plain></SENT>
<SENT sid="353" pm="."><plain>Biol.61:579–593.22223445 </plain></SENT>
</text></ref><ref id="B4"><text><SENT sid="354" pm="."><plain> BouckaertR.,HeledJ.,KühnertD.,VaughanT.,WuC.-H.,XieD.,SuchardM.A.,RambautA.,DrummondA. </plain></SENT>
<SENT sid="355" pm="."><plain>J. 2014 BEAST 2: a software platform for Bayesian evolutionary analysis.PLoS Comput. </plain></SENT>
<SENT sid="356" pm="."><plain>Biol.10:e1003537.24722319 </plain></SENT>
</text></ref><ref id="B5"><text><SENT sid="357" pm="."><plain> BrentR. 1973 Algorithms for minimization without derivatives.Englewood Clifts, New Jersey: Prentice-Hall. </plain></SENT>
</text></ref><ref id="B6"><text><SENT sid="358" pm="."><plain> ClaywellB.C.,DinhV.,FourmentM.,McCoyC.O.,MatsenF.A. IV 2017 A surrogate function for one-dimensional phylogenetic likelihoods.Mol. </plain></SENT>
<SENT sid="359" pm="."><plain>Biol. </plain></SENT>
<SENT sid="360" pm="."><plain>Evol.Advance online publication.10.1093/molbev/msx253. </plain></SENT>
</text></ref><ref id="B7"><text><SENT sid="361" pm="."><plain> Del MoralP.,DoucetA.,JasraA. 2012 On adaptive resampling strategies for sequential Monte Carlo methods.Bernoulli18:252–278. </plain></SENT>
</text></ref><ref id="B8"><text><SENT sid="362" pm="."><plain> DinhV.,DarlingA.E.,MatsenF.A. IV. </plain></SENT>
<SENT sid="363" pm="."><plain>Forthcoming 2016 Online Bayesian phylogenetic inference: theoretical foundations via sequential Monte Carlo.Syst. </plain></SENT>
<SENT sid="364" pm="."><plain>Biol,Advance online publication.<ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1610.08148">https://arxiv.org/abs/1610.08148</ext-link>. </plain></SENT>
</text></ref><ref id="B9"><text><SENT sid="365" pm="."><plain> DoucetA.,De FreitasN.,GordonN. 2001 An introduction to sequential Monte Carlo methods. In: Doucet,A,De Freitas,N,Gordon,N, editors. Sequential Monte Carlo methods in practice.New York: Springer p. 3–14. </plain></SENT>
</text></ref><ref id="B10"><text><SENT sid="366" pm="."><plain> EverittR.G.,CullifordR.,Medina-AguayoF.,WilsonD.J. 2016 Sequential Bayesian inference for mixture models and the coalescent using sequential Monte Carlo samplers with transformations.<ext-link ext-link-type="uri" xlink:href="https://arxiv.org/abs/1612.06468">https://arxiv.org/abs/1612.06468</ext-link>. </plain></SENT>
</text></ref><ref id="B11"><text><SENT sid="367" pm="."><plain> EverittR.G.,JohansenA.M.,RowingE.,Evdemon-HoganM. 2017 Bayesian model comparison with un-normalised likelihoods.Stat. </plain></SENT>
<SENT sid="368" pm="."><plain>Comput.27:403–422. </plain></SENT>
</text></ref><ref id="B12"><text><SENT sid="369" pm="."><plain> EwensW.J. 1972 The sampling theory of selectively neutral alleles.Theor. </plain></SENT>
<SENT sid="370" pm="."><plain>Popul. </plain></SENT>
<SENT sid="371" pm="."><plain>Biol.3:87–112.4667078 </plain></SENT>
</text></ref><ref id="B13"><text><SENT sid="372" pm="."><plain> FDA. 2016 GenomeTrakr. Available from: <ext-link ext-link-type="uri" xlink:href="http://www.fda.gov/Food/FoodScienceResearch/WholeGenomeSequencingProgramWGS/">http://www.fda.gov/Food/FoodScienceResearch/WholeGenomeSequencingProgramWGS/</ext-link>. accessed June 1 2017. </plain></SENT>
</text></ref><ref id="B14"><text><SENT sid="373" pm="."><plain> FelsensteinJ. 2004 Inferring phylogenies.2nd ed.Sunderland (MA): Sinauer Associates, Inc. </plain></SENT>
</text></ref><ref id="B15"><text><SENT sid="374" pm="."><plain> FitchW.M. 1971 Toward defining the course of evolution: minimum change for a specific tree topology.Syst. </plain></SENT>
<SENT sid="375" pm="."><plain>Biol.20:406–416. </plain></SENT>
</text></ref><ref id="B16"><text><SENT sid="376" pm="."><plain> GardyJ.,LomanN.J.,RambautA. 2015 Real-time digital pathogen surveillance–-the time is now.Genome Biol.16:155.25622821 </plain></SENT>
</text></ref><ref id="B17"><text><SENT sid="377" pm="."><plain> GeyerC.J. 1991 Markov chain monte carlo maximum likelihood. In: KeramidasE.M.,KaufmanS.M., editors. Computing Science and Statistics: Proceedings of the 23rd Symposium on the Interface.Fairfax Station: Inferface Foundation p. 156–163. </plain></SENT>
</text></ref><ref id="B18"><text><SENT sid="378" pm="."><plain> GuéguenL.,GaillardS.,BoussauB.,GouyM.,GroussinM.,RochetteN.C.,BigotT.,FournierD.,PouyetF.,CahaisV.,AurélienB.,CélineS.,BenoîtN.,AnnabelleH.,LoïcD.,NicolasG.,KhalidB.,JulienD. </plain></SENT>
<SENT sid="379" pm="."><plain>Y. 2013 Bio++: efficient extensible libraries and tools for computational molecular evolution.Mol. </plain></SENT>
<SENT sid="380" pm="."><plain>Biol. </plain></SENT>
<SENT sid="381" pm="."><plain>Evol.30:1745–1750.23699471 </plain></SENT>
</text></ref><ref id="B19"><text><SENT sid="382" pm="."><plain> GuindonS.,DufayardJ.-F.,LefortV.,AnisimovaM.,HordijkW.,GascuelO. 2010 New algorithms and methods to estimate maximum-likelihood phylogenies: assessing the performance of PhyML 3.0.Syst. </plain></SENT>
<SENT sid="383" pm="."><plain>Biol.59:307–321.20525638 </plain></SENT>
</text></ref><ref id="B20"><text><SENT sid="384" pm="."><plain> Izquierdo-CarrascoF.,CazesJ.,SmithS.A.,StamatakisA. 2014 PUmPER: phylogenies updated perpetually.Bioinformatics30:1476–1477.24478338 </plain></SENT>
</text></ref><ref id="B21"><text><SENT sid="385" pm="."><plain> JohansenA.M. 2009 SMCTC: sequential Monte Carlo in C++.J. </plain></SENT>
<SENT sid="386" pm="."><plain>Stat. </plain></SENT>
<SENT sid="387" pm="."><plain>Softw.30:1–41.21666874 </plain></SENT>
</text></ref><ref id="B22"><text><SENT sid="388" pm="."><plain> JukesT.H.,CantorC.R. 1969 Evolution of protein molecules. In: MunroH.N., ed. Mammalian protein metabolism.Vol. </plain></SENT>
<SENT sid="389" pm="."><plain>3.New York:Academic Press p. 132. </plain></SENT>
</text></ref><ref id="B23"><text><SENT sid="390" pm="."><plain> JunS.-H.,Bouchard-Côté,A. 2014 Memory (and time) efficient sequential Monte Carlo. In: Proceedings of the 31st International Conference on Machine Learning, Beijing, China,2014 JMLR: W&amp;CPvolume 32. </plain></SENT>
</text></ref><ref id="B24"><text><SENT sid="391" pm="."><plain> KitagawaG. 1996 Monte Carlo filter and smoother for non-Gaussian nonlinear state space models.J. </plain></SENT>
<SENT sid="392" pm="."><plain>Comput. </plain></SENT>
<SENT sid="393" pm="."><plain>Graph. </plain></SENT>
<SENT sid="394" pm="."><plain>Stat.5:1–25. </plain></SENT>
</text></ref><ref id="B25"><text><SENT sid="395" pm="."><plain> KühnertD.,StadlerT.,VaughanT.G.,DrummondA.J. 2014 Simultaneous reconstruction of evolutionary history and epidemiological dynamics from viral sequences with the birth–death SIR model.J. </plain></SENT>
<SENT sid="396" pm="."><plain>R. </plain></SENT>
<SENT sid="397" pm="."><plain>Soc. </plain></SENT>
<SENT sid="398" pm="."><plain>Interface11:20131106. </plain></SENT>
</text></ref><ref id="B26"><text><SENT sid="399" pm="."><plain> LaknerC.,van der MarkP.,HuelsenbeckJ.P.,LargetB.,RonquistF. 2008 Efficiency of Markov chain Monte Carlo tree proposals in Bayesian phylogenetics.Syst. </plain></SENT>
<SENT sid="400" pm="."><plain>Biol.57:86–103.18278678 </plain></SENT>
</text></ref><ref id="B27"><text><SENT sid="401" pm="."><plain> LemeyP.,RambautA.,DrummondA.J.,SuchardM.A. 2009 Bayesian phylogeography finds its roots.PLoS Comput. </plain></SENT>
<SENT sid="402" pm="."><plain>Biol.5:e1000520.19779555 </plain></SENT>
</text></ref><ref id="B28"><text><SENT sid="403" pm="."><plain> LooseM.,MallaS.,StoutM. 2016 Real-time selective sequencing using nanopore technology.Nat. </plain></SENT>
<SENT sid="404" pm="."><plain>Methods13:751–754.27454285 </plain></SENT>
</text></ref><ref id="B29"><text><SENT sid="405" pm="."><plain> MatsenF.A.,KodnerR.B.,ArmbrustE.V. 2010 pplacer: linear time maximum-likelihood and Bayesian phylogenetic placement of sequences onto a fixed reference tree.BMC Bioinform.11:1. </plain></SENT>
</text></ref><ref id="B30"><text><SENT sid="406" pm="."><plain> NeherR.A.,BedfordT. 2015 nextflu: real-time tracking of seasonal influenza virus evolution in humans.Bioinformatics31:3546–3548.26115986 </plain></SENT>
</text></ref><ref id="B31"><text><SENT sid="407" pm="."><plain> PaigeB.,WoodF.,DoucetA.,TehY.W. 2014 Asynchronous anytime sequential Monte Carlo.In: Advances in Neural Information Processing Systems.27 p. 3410–3418. </plain></SENT>
</text></ref><ref id="B32"><text><SENT sid="408" pm="."><plain> RobinsonD.F.,FouldsL.R. 1981 Comparison of phylogenetic trees.Math. </plain></SENT>
<SENT sid="409" pm="."><plain>Biosci.53:131–147. </plain></SENT>
</text></ref><ref id="B33"><text><SENT sid="410" pm="."><plain> RonquistF.,TeslenkoM.,van der MarkP.,AyresD.L.,DarlingA.,HöhnaS.,LargetB.,LiuL.,SuchardM.A.,HuelsenbeckJ.P. 2012 MrBayes 3.2: efficient Bayesian phylogenetic inference and model choice across a large model space.Syst. </plain></SENT>
<SENT sid="411" pm="."><plain>Biol.61:539–42.22357727 </plain></SENT>
</text></ref><ref id="B34"><text><SENT sid="412" pm="."><plain> RusuL.I.,WyresK.L.,ReumannM.,QueirozC.,BojovschiA.,ConwayT.,GargS.,EdwardsD.J.,HoggG.,HoltK.E. 2015 A platform for leveraging next generation sequencing for routine microbiology and public health use.Health Inf. </plain></SENT>
<SENT sid="413" pm="."><plain>Sci. </plain></SENT>
<SENT sid="414" pm="."><plain>Syst.3:S7.25870761 </plain></SENT>
</text></ref><ref id="B35"><text><SENT sid="415" pm="."><plain> St. JohnK. 2016 Review paper: the shape of phylogenetic treespace.Syst. </plain></SENT>
<SENT sid="416" pm="."><plain>Biol.66:83–94. </plain></SENT>
</text></ref><ref id="B36"><text><SENT sid="417" pm="."><plain> StadlerT. 2017 TreeSim - simulating phylogenetic treespace [Internet], 2017Available from: <ext-link ext-link-type="uri" xlink:href="http://cran.r-project.org/web/packages/TreeSim/index.html">http://cran.r-project.org/web/packages/TreeSim/index.html</ext-link> </plain></SENT>
</text></ref><ref id="B37"><text><SENT sid="418" pm="."><plain> SuchardM.A.,RedelingsB.D. 2006 BAli-Phy: simultaneous Bayesian inference of alignment and phylogeny.Bioinformatics22:2047–2048.16679334 </plain></SENT>
</text></ref><ref id="B38"><text><SENT sid="419" pm="."><plain> SukumaranJ.,HolderM.T. 2010 DendroPy: a Python library for phylogenetic computing.Bioinformatics26:1569–1571.20421198 </plain></SENT>
</text></ref><ref id="B39"><text><SENT sid="420" pm="."><plain> TehY.W.,HsuD.J.,DaumeH. 2008 Bayesian agglomerative clustering with coalescents. In: PlattJ.C.,KollerD.,SingerY.,RoweisS.T., editors. Advances in Neural Information Processing Systems 20.Curran Associates, Inc. </plain></SENT>
<SENT sid="421" pm="."><plain>Cambridge (MA): MIT Press, p. 1473–1480. </plain></SENT>
</text></ref><ref id="B40"><text><SENT sid="422" pm="."><plain> WangL.,Bouchard-Côté,A.,DoucetA. 2015 Bayesian phylogenetic inference using a combinatorial sequential Monte Carlo method.J. </plain></SENT>
<SENT sid="423" pm="."><plain>Am. </plain></SENT>
<SENT sid="424" pm="."><plain>Stat. </plain></SENT>
<SENT sid="425" pm="."><plain>Assoc.110:1362–1374. </plain></SENT>
</text></ref></ref-list></SecTag></back></article>
