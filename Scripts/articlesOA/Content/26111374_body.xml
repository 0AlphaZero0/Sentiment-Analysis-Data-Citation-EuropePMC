<disp-quote><p>This is a <italic>PLOS Computational Biology</italic> Methods paper.</p></disp-quote><sec sec-type="intro" id="sec001"><title>Introduction</title><p>Microarray experiments are increasingly used for evaluating changes in gene expression over time. The analysis of the temporal change of gene expression should help in understanding the complex mechanisms of gene regulation. For instance, transcriptional profiles have been repeatedly measured to study the change in gene expression during the natural history of SIV/HIV infection [<xref rid="pcbi.1004310.ref001" ref-type="bibr">1</xref>, <xref rid="pcbi.1004310.ref002" ref-type="bibr">2</xref>] or to evaluate the effect of vaccines [<xref rid="pcbi.1004310.ref003" ref-type="bibr">3</xref>, <xref rid="pcbi.1004310.ref004" ref-type="bibr">4</xref>]. In the applications considered in this paper [<xref rid="pcbi.1004310.ref005" ref-type="bibr">5</xref>, <xref rid="pcbi.1004310.ref006" ref-type="bibr">6</xref>], the investigators wanted to detect the genes for which the abundance changed over time after a vaccination (against HIV, influenza or pneumococcus).</p><p>In order to analyze such longitudinal high-dimensional data, several approaches have been suggested including a gene-by-gene statistical analysis [<xref rid="pcbi.1004310.ref007" ref-type="bibr">7</xref>, <xref rid="pcbi.1004310.ref008" ref-type="bibr">8</xref>], dimension reduction methods [<xref rid="pcbi.1004310.ref009" ref-type="bibr">9</xref>] or gene set analysis [<xref rid="pcbi.1004310.ref010" ref-type="bibr">10</xref>]. A gene set is a group of genes that are <italic>a priori</italic> co-regulated or functionally linked. Examples of such gene set relating to biological processes or pathways are those defined by KEGG [<xref rid="pcbi.1004310.ref011" ref-type="bibr">11</xref>], Gene Ontology [<xref rid="pcbi.1004310.ref012" ref-type="bibr">12</xref>] or Chaussabel&#x02019;s functional modules [<xref rid="pcbi.1004310.ref013" ref-type="bibr">13</xref>]. The gene set analysis [<xref rid="pcbi.1004310.ref014" ref-type="bibr">14</xref>&#x02013;<xref rid="pcbi.1004310.ref016" ref-type="bibr">16</xref>] is supposed to be more powerful than a gene-by-gene analysis because it can detect a change of expression of a group of genes although none of them show a very high absolute fold change. Furthermore, a change of all genes in a given pathway may be biologically more meaningful than a large increase of a single gene. Also, provided that the gene sets are well defined, the result should be more sound and comparable across studies than a gene-by-gene analysis [<xref rid="pcbi.1004310.ref014" ref-type="bibr">14</xref>]. Finally, gene set analysis avoids a second step for a global interpretation as described in the &#x0201c;bottom up&#x0201d; approach [<xref rid="pcbi.1004310.ref010" ref-type="bibr">10</xref>, <xref rid="pcbi.1004310.ref017" ref-type="bibr">17</xref>].</p><p>The analysis of longitudinal microarray experiments through a gene set approach is not trivial because the dynamics of gene expressions inside a gene set can be complex and heterogeneous. This has already been underlined in some of the approaches developed to analyze gene sets [<xref rid="pcbi.1004310.ref015" ref-type="bibr">15</xref>, <xref rid="pcbi.1004310.ref018" ref-type="bibr">18</xref>&#x02013;<xref rid="pcbi.1004310.ref020" ref-type="bibr">20</xref>]. <xref ref-type="fig" rid="pcbi.1004310.g001">Fig 1</xref> shows an example of a homogeneous gene set, whereas <xref ref-type="fig" rid="pcbi.1004310.g002">Fig 2</xref> shows an example of a heterogeneous one. Actually, such a heterogeneity is frequently observed [<xref rid="pcbi.1004310.ref020" ref-type="bibr">20</xref>], and cannot be ignored, as genes inside a functional gene set are not expected to change their expression synchronously. Moreover this heterogeneity can be biologically meaningful by itself. Prieto et al. [<xref rid="pcbi.1004310.ref021" ref-type="bibr">21</xref>] provide an example from a cancer application, where deregulated pathways are of primary biological interest. They identified heterogeneous gene sets linked to acute promyelocytic leukemia. Another example is given by Hu et al.: pathways affected by the HER2, such as the KEGG pathways of &#x02018;Ubiquitin mediated proteolysis&#x02019;, &#x02018;Glioma&#x02019;, and &#x02018;Prostate cancer&#x02019; were identified by studying heterogeneity [<xref rid="pcbi.1004310.ref022" ref-type="bibr">22</xref>]. The main advantage of detecting the heterogeneity inside a gene set is to detect any change over time whatever the specification of the model for the trends. In other words, the dynamics of gene expression inside a stable gene set will be summarized by a flat slope and no heterogeneity. Hence, in the spirit of [<xref rid="pcbi.1004310.ref019" ref-type="bibr">19</xref>], to find any significant change of the overall expression of genes inside a gene set over time, we suggest to look for any significant trend over time or any heterogeneity between gene trends inside the gene set.</p><fig id="pcbi.1004310.g001" orientation="portrait" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1004310.g001</object-id><label>Fig 1</label><caption><title>Example of a homogeneous gene set (M1.2: interferon&#x02014;from the DALIA trial, after treatment interruption).</title><p>Each line is the median expression of a gene inside this particular gene set across all the patients. The expression of the genes inside this gene set is quite homogeneous and it is easy to identify a global time trend, displayed by the dashed black line (smoothed median). For more information see the presentation of the DALIA-trial in the &#x0201c;Results&#x0201d; section.</p></caption><graphic xlink:href="pcbi.1004310.g001"/></fig><fig id="pcbi.1004310.g002" orientation="portrait" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1004310.g002</object-id><label>Fig 2</label><caption><title>Example of a heterogeneous gene set (M4.16: cell cycle&#x02014;from the DALIA trial, after treatment interruption).</title><p>Each line is the median expression of a gene inside this particular gene set across all the patients. The expression of the genes inside this gene set is rather heterogeneous. This makes it difficult to identify any time trend, as the mean expression inside this gene set stays close to zero. However a closer look reveals two distinct time trends, displayed by the two respectively dashed and dotted black lines (smoothed medians). For more information see the presentation of the DALIA-trial in the &#x0201c;Results&#x0201d; section.</p></caption><graphic xlink:href="pcbi.1004310.g002"/></fig><p>Several approaches have already been proposed to analyze longitudinal measurements of gene expression [<xref rid="pcbi.1004310.ref007" ref-type="bibr">7</xref>, <xref rid="pcbi.1004310.ref023" ref-type="bibr">23</xref>&#x02013;<xref rid="pcbi.1004310.ref028" ref-type="bibr">28</xref>], but only a few include gene set analysis [<xref rid="pcbi.1004310.ref010" ref-type="bibr">10</xref>, <xref rid="pcbi.1004310.ref018" ref-type="bibr">18</xref>, <xref rid="pcbi.1004310.ref029" ref-type="bibr">29</xref>&#x02013;<xref rid="pcbi.1004310.ref031" ref-type="bibr">31</xref>]. Among the latter, all but Nueda et al. [<xref rid="pcbi.1004310.ref018" ref-type="bibr">18</xref>] fail to account for possible heterogeneity inside a gene set. An extension of the popular Gene Set Enrichment Analysis (GSEA) method [<xref rid="pcbi.1004310.ref014" ref-type="bibr">14</xref>] is available for the analysis of time series data: GSEA for time series. Unfortunately, it does not account for the structure of longitudinal data, simply treating all observations as independent and calculating Pearson correlation of the genes with the time variable. Therefore this is quite a limited modeling strategy for longitudinal data. The globalANCOVA procedure developed by Hummel et al. [<xref rid="pcbi.1004310.ref029" ref-type="bibr">29</xref>] focuses on the comparison of groups, testing whether there is a group influence on change over time of any gene expression inside a gene set. In practice, the global null hypothesis tested is quite flexible relying on the ANOVA framework, but cannot accommodate missing values. Wang et al. [<xref rid="pcbi.1004310.ref010" ref-type="bibr">10</xref>] proposed to use a linear mixed effects model to explain gene expression inside a gene set. They considered a random effect for the array level rather than for the patient or the gene level. Zhang et al. [<xref rid="pcbi.1004310.ref030" ref-type="bibr">30</xref>] proposed a robust non-parametric approach to compare gene expression dynamics between different treatment-groups. Wu et al. [<xref rid="pcbi.1004310.ref031" ref-type="bibr">31</xref>] proposed the CAMERA procedure, a gene set test based on linear modeling that takes into account inter-gene correlations. However, CAMERA accounts for neither potential heterogeneity inside a gene set nor for repeated measurement correlation. Of note, it is not possible to look at the change of gene expression in only one group using Zhang et al. [<xref rid="pcbi.1004310.ref030" ref-type="bibr">30</xref>] approach. In contrast, the PCA-maSigFun procedure developed by Nueda et al. [<xref rid="pcbi.1004310.ref018" ref-type="bibr">18</xref>, <xref rid="pcbi.1004310.ref032" ref-type="bibr">32</xref>] can account for possible heterogeneity inside a gene set. It is based on a Principal Component Analysis (PCA) of each gene set followed by a linear regression of the significant principal components (i.e. components that have a variation above the mean gene variance) over time. However, they did not consider time-course experiments where repeated measures are available for multiple patient.</p><p>Gene set analysis methods can also be distinguished by their choice of the null hypothesis. Those can be classified into two main types of hypothesis: i) the competitive null hypothesis, that tests the genes inside a given gene set against all the other genes outside the gene set; ii) the self-contained null hypothesis, that only uses the genes inside the gene set of interest [<xref rid="pcbi.1004310.ref020" ref-type="bibr">20</xref>, <xref rid="pcbi.1004310.ref033" ref-type="bibr">33</xref>, <xref rid="pcbi.1004310.ref034" ref-type="bibr">34</xref>]. In the present paper, interest is focused on self-contained null hypotheses because the question was &#x0201c;Which gene sets have a change of gene abundance over time?&#x0201d;. According to Emmert-Streib et al. [<xref rid="pcbi.1004310.ref035" ref-type="bibr">35</xref>], self-contained gene set tests are biologically easier to interpret and can be more powerful compared to competitive tests. Self-contained gene set tests are especially appropriate in a hypothesis driven context where <italic>a priori</italic> defined gene sets are validated and relevant regarding the biological question.</p><p>We propose the implementation of a hypothesis driven method that directly tests the time-course significance of predefined gene sets: the <italic>Time-course Gene Set Analysis</italic> (TcGSA). It relies on the use of linear mixed effect models, a very useful and well established statistical tool [<xref rid="pcbi.1004310.ref036" ref-type="bibr">36</xref>, <xref rid="pcbi.1004310.ref037" ref-type="bibr">37</xref>] especially suited for longitudinal settings. By using all available repeated measures, it provides increased statistical power. TcGSA can accommodate for heterogeneity of gene expression within the gene sets through random effects, and is robust to unbalanced designed due to missing (at random) values thanks to the maximum likelihood estimates. No previously proposed approach combines all of TcGSA features. A simulation study demonstrated the good statistical performance of the proposed method. It has been applied to two studies: one HIV vaccine trial, and one influenza and pneumoccocal vaccine study [<xref rid="pcbi.1004310.ref006" ref-type="bibr">6</xref>], using the same definition of gene sets [<xref rid="pcbi.1004310.ref013" ref-type="bibr">13</xref>] that is increasingly used in systems immunology research [<xref rid="pcbi.1004310.ref038" ref-type="bibr">38</xref>&#x02013;<xref rid="pcbi.1004310.ref042" ref-type="bibr">42</xref>]. Compared to gene-by-gene analyses, TcGSA disclosed changes of additional gene sets that endorse previous conclusions [<xref rid="pcbi.1004310.ref006" ref-type="bibr">6</xref>], but also revealed common pathways across the three vaccines.</p></sec><sec sec-type="materials|methods" id="sec002"><title>Methods</title><sec id="sec003"><title>Time-course gene set analysis</title><p>The TcGSA method includes three steps: 1) modeling gene expression in a gene set with mixed models, 2) testing the significance of a gene set, and 3) estimating individual gene profiles.</p><sec id="sec004"><title>1. Modeling gene expression in a gene set with mixed models</title><p>Let <italic>S</italic> be a gene set of interest. We start by the case of a one group experiment, where each patient act as her/his own respective control, her/his condition changing over time. The expression of genes inside <italic>S</italic> is modeled over time according to a function <italic>f</italic> as:</p><p>for all the genes <italic>g</italic> &#x02208; <italic>S</italic>, 
<disp-formula id="pcbi.1004310.e001"><alternatives><graphic xlink:href="pcbi.1004310.e001.jpg" id="pcbi.1004310.e001g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M1"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>&#x003bc;</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>&#x003b2;</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>&#x003b5;</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(1)</label></disp-formula>
where <italic>y</italic>
<sub><italic>gpi</italic></sub> is expression of the <italic>g</italic>
<sup><italic>th</italic></sup> gene for the <italic>p</italic>
<sup><italic>th</italic></sup> patient at the <italic>i</italic>
<sup><italic>th</italic></sup> time, <italic>&#x003bc;</italic> is the intercept in the gene set <italic>S</italic>, <italic>&#x003b2;</italic>
<sub><italic>g</italic></sub> is the fixed effect of the <italic>g</italic>
<sup><italic>th</italic></sup> gene, <italic>c</italic>
<sub><italic>gp</italic></sub> &#x0223c; &#x1d4dd;(0, <italic>&#x003c3;</italic>
<sub><italic>c</italic></sub>) is a random effect grouped by the <italic>g</italic>
<sup><italic>th</italic></sup> gene of the <italic>p</italic>
<sup><italic>th</italic></sup> patient, <italic>t</italic>
<sub><italic>i</italic></sub> is the <italic>i</italic>
<sup><italic>th</italic></sup> measurement time, <italic>&#x0025b;</italic>
<sub><italic>gpi</italic></sub> &#x0223c; &#x1d4dd;(0, <italic>&#x003c3;</italic>) is an error term. Finally <italic>f</italic>
<sub><italic>g</italic></sub>(<italic>t</italic>
<sub><italic>i</italic></sub>) is a function of time, that can be linear, polynomials, etc. Every time coefficient of the trend <italic>f</italic>
<sub><italic>g</italic></sub>(<italic>t</italic>
<sub><italic>i</italic></sub>) is actually divided into a fixed effect <italic>&#x003b7;</italic>
<sub>&#x022c5;</sub> (representing the average trend in the gene set <italic>S</italic>) and a random effect <italic>h</italic>
<sub><italic>g</italic>,&#x022c5;</sub> &#x0223c; &#x1d4dd;(0, <italic>&#x003c3;</italic>
<sub><italic>h</italic><sub>&#x022c5;</sub></sub>) grouped on the gene <italic>g</italic>, accounting for the possible heterogeneity between the genes in the gene set <italic>S</italic>. In this paper we focus on three forms for <italic>f</italic>
<sub><italic>g</italic></sub> (but other forms, such as exponential, etc. could easily be envisaged):
<list list-type="bullet"><list-item><p>linear polynomials:</p><p>
<inline-formula id="pcbi.1004310.e002"><alternatives><graphic xlink:href="pcbi.1004310.e002.jpg" id="pcbi.1004310.e002g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M2"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msub><mml:mi>&#x003b7;</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:mi>t</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>
</p></list-item><list-item><p>cubic polynomials:</p><p>
<italic>f</italic>
<sub><italic>g</italic></sub>(<italic>t</italic>) = (<italic>&#x003b7;</italic>
<sub>1</sub>+<italic>h</italic>
<sub><italic>g</italic>,1</sub>)<italic>t</italic>+(<italic>&#x003b7;</italic>
<sub>2</sub>+<italic>h</italic>
<sub><italic>g</italic>,2</sub>)<italic>t</italic>
<sup>2</sup>+(<italic>&#x003b7;</italic>
<sub>3</sub>+<italic>h</italic>
<sub><italic>g</italic>,3</sub>)<italic>t</italic>
<sup>3</sup>
</p></list-item><list-item><p>natural cubic splines:</p><p>
<inline-formula id="pcbi.1004310.e003"><alternatives><graphic xlink:href="pcbi.1004310.e003.jpg" id="pcbi.1004310.e003g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M3"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msubsup><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>K</mml:mi><mml:mo>+</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mrow><mml:mo stretchy="true">(</mml:mo><mml:msub><mml:mi>&#x003b7;</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="true">)</mml:mo></mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>
</p></list-item></list>
where the <italic>N</italic>
<sub><italic>k</italic></sub>(<italic>t</italic>) form the natural cubic splines basis [<xref rid="pcbi.1004310.ref043" ref-type="bibr">43</xref>] for the time variable <italic>t</italic> (with <italic>K</italic> internal knots), <italic>&#x003b7;</italic>
<sub>&#x022c5;</sub> are the fixed effects of time shared across the gene set <italic>S</italic>, and <italic>h</italic>
<sub><italic>g</italic>,&#x022c5;</sub> are the random effects of time accounting for possible heterogeneity between genes. (<italic>h</italic>
<sub><italic>g</italic>,1</sub>,&#x02026;, <italic>h</italic>
<sub><italic>g</italic>, <italic>d</italic></sub>) &#x0223c; &#x1d4dd;(0,&#x003a3;<sub><italic>h</italic></sub>) with <italic>d</italic> being the degree of the time function, and for <italic>k</italic> = 1,&#x02026;, <italic>d</italic>
<italic>h</italic>
<sub><italic>g</italic>, <italic>k</italic></sub> &#x0223c; &#x1d4dd;(0, <italic>&#x003c3;</italic>
<sub><italic>h</italic><sub><italic>k</italic></sub></sub>). Alternatively, one can make the assumption that the patient effect is the same for all the genes. In that case, the random effect <italic>c</italic> is no longer grouped on the gene level, and the model can be written as:</p><p>for all the genes <italic>g</italic> &#x02208; <italic>S</italic>,
<disp-formula id="pcbi.1004310.e004"><alternatives><graphic xlink:href="pcbi.1004310.e004.jpg" id="pcbi.1004310.e004g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M4"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>&#x003bc;</mml:mi><mml:mo>+</mml:mo><mml:msubsup><mml:mi>&#x003b2;</mml:mi><mml:mi>g</mml:mi><mml:msup><mml:mrow/><mml:mo>&#x02032;</mml:mo></mml:msup></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>c</mml:mi><mml:mi>p</mml:mi><mml:msup><mml:mrow/><mml:mo>&#x02032;</mml:mo></mml:msup></mml:msubsup><mml:mo>+</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>&#x003b5;</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(1bis)</label></disp-formula>
with <inline-formula id="pcbi.1004310.e005"><alternatives><graphic xlink:href="pcbi.1004310.e005.jpg" id="pcbi.1004310.e005g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M5"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi><mml:mi>p</mml:mi><mml:mo>&#x02032;</mml:mo></mml:msubsup><mml:mo>&#x0223c;</mml:mo><mml:mo>&#x1d4dd;</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:msup><mml:mi>c</mml:mi><mml:mo>&#x02032;</mml:mo></mml:msup></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> the random effect of the patient <italic>p</italic>, and <inline-formula id="pcbi.1004310.e006"><alternatives><graphic xlink:href="pcbi.1004310.e006.jpg" id="pcbi.1004310.e006g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M6"><mml:mrow><mml:msubsup><mml:mi>&#x003b2;</mml:mi><mml:mi>g</mml:mi><mml:mo>&#x02032;</mml:mo></mml:msubsup><mml:mo>&#x0223c;</mml:mo><mml:mo>&#x1d4dd;</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:msup><mml:mi>&#x003b2;</mml:mi><mml:mo>&#x02032;</mml:mo></mml:msup></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> the random effect of the gene <italic>g</italic>. This alternative modeling has the advantage to be more parsimonious than the <xref ref-type="disp-formula" rid="pcbi.1004310.e001">Eq (1)</xref>, with less parameters to be estimated.</p><p>Let&#x02019;s now consider the case of a multiple group experiment (such as treatment/vaccine groups for instance). The expression of genes inside <italic>S</italic> is modeled over time according to a function <italic>f</italic>
<sub><italic>g</italic>, <italic>m</italic></sub> that is now stratified on the groups:</p><p>for all the genes <italic>g</italic> &#x02208; <italic>S</italic>,
<disp-formula id="pcbi.1004310.e007"><alternatives><graphic xlink:href="pcbi.1004310.e007.jpg" id="pcbi.1004310.e007g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M7"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>y</mml:mi><mml:mrow><mml:mi>m</mml:mi><mml:mi>g</mml:mi><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>&#x003bc;</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>&#x003b2;</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>&#x003b4;</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>p</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>+</mml:mo><mml:msub><mml:mi>&#x003b5;</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mi>p</mml:mi><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(2)</label></disp-formula>
where <italic>m</italic> indicates which group is concerned and <italic>&#x003b4;</italic>
<sub><italic>m</italic></sub> is the fixed intercept of the <italic>m</italic>
<sup><italic>th</italic></sup> group, everything else being the same as in the <xref ref-type="disp-formula" rid="pcbi.1004310.e001">Eq (1)</xref>.</p></sec><sec id="sec005"><title>2. Testing the significance of a gene set</title><p>In TcGSA, a &#x0201c;significant&#x0201d; gene set is a gene set whose expression is not stable either over time (in one group experiments) or over groups (in several groups experiments), once between genes and patients variability is taken into account. In other words, we want to test the significance of the time trend while being sensitive to both homogeneous and heterogeneous changes of gene expression over time inside a gene set. Testing the significance of a given gene set <italic>S</italic> therefore means testing both fixed and random effects at once, in a single test. A likelihood ratio test is the natural way to do so, fitting models under both the null hypothesis and the alternative.</p><p>In the case of one group experiment (Eqs (<xref ref-type="disp-formula" rid="pcbi.1004310.e001">1</xref>) and (<xref ref-type="disp-formula" rid="pcbi.1004310.e004">1bis</xref>)) the null hypothesis (H<sub>0</sub>) is that the genes inside <italic>S</italic> are stable over time, <italic>i.e.</italic> that their expressions are constant and homogeneous over time (all coefficients of the function of time <italic>f</italic> are not significantly different from zero). The alternative hypothesis (H<sub>1</sub>) is that the genes inside <italic>S</italic> vary significantly over time:
<disp-formula id="pcbi.1004310.e008"><alternatives><graphic xlink:href="pcbi.1004310.e008.jpg" id="pcbi.1004310.e008g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M8"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mtext>(H</mml:mtext><mml:mtext>0</mml:mtext></mml:msub><mml:mtext>):</mml:mtext><mml:mspace width="0.166667em"/><mml:mspace width="0.166667em"/></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>&#x02200;</mml:mo><mml:mspace width="0.166667em"/><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:msub><mml:mi>&#x003b7;</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mspace width="1.em"/><mml:mtext>and</mml:mtext><mml:mspace width="1.em"/><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:msub><mml:mi>h</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(1.0)</label></disp-formula>
<disp-formula id="pcbi.1004310.e009"><alternatives><graphic xlink:href="pcbi.1004310.e009.jpg" id="pcbi.1004310.e009g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M9"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mtext>(H</mml:mtext><mml:mtext>1</mml:mtext></mml:msub><mml:mtext>):</mml:mtext><mml:mspace width="0.166667em"/><mml:mspace width="0.166667em"/></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>&#x02203;</mml:mo><mml:mspace width="0.166667em"/><mml:mi>k</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:msub><mml:mi>&#x003b7;</mml:mi><mml:mi>k</mml:mi></mml:msub><mml:mo>&#x02260;</mml:mo><mml:mn>0</mml:mn><mml:mspace width="1.em"/><mml:mspace width="2.41867pt"/><mml:mtext>or</mml:mtext><mml:mspace width="2.41867pt"/><mml:mspace width="1.em"/><mml:msub><mml:mi>&#x003c3;</mml:mi><mml:msub><mml:mi>h</mml:mi><mml:mi>k</mml:mi></mml:msub></mml:msub><mml:mo>&#x02260;</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(1.1)</label></disp-formula>
</p><p>In the case of a multiple group experiment (<xref ref-type="disp-formula" rid="pcbi.1004310.e007">Eq (2)</xref>), the null hypothesis is that inside the gene set <italic>S</italic>, the evolution of gene expressions over time is the same regardless of the group. The alternative hypothesis is that time trends <italic>f</italic> are different depending on the group <italic>m</italic>:
<disp-formula id="pcbi.1004310.e010"><alternatives><graphic xlink:href="pcbi.1004310.e010.jpg" id="pcbi.1004310.e010g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M10"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mtext>(H</mml:mtext><mml:mtext>0</mml:mtext></mml:msub><mml:mtext>):</mml:mtext><mml:mspace width="0.166667em"/><mml:mspace width="0.166667em"/></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>&#x02200;</mml:mo><mml:mspace width="0.166667em"/><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:mspace width="0.166667em"/><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mo>&#x000b7;</mml:mo><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mo>&#x000b7;</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(2.0)</label></disp-formula>
<disp-formula id="pcbi.1004310.e011"><alternatives><graphic xlink:href="pcbi.1004310.e011.jpg" id="pcbi.1004310.e011g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M11"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mtext>(H</mml:mtext><mml:mtext>1</mml:mtext></mml:msub><mml:mtext>):</mml:mtext><mml:mspace width="0.166667em"/><mml:mspace width="0.166667em"/></mml:mrow></mml:mtd><mml:mtd><mml:mrow><mml:mo>&#x02203;</mml:mo><mml:mspace width="0.166667em"/><mml:mi>m</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.166667em"/><mml:msup><mml:mi>m</mml:mi><mml:mo>&#x02032;</mml:mo></mml:msup><mml:mspace width="0.166667em"/><mml:mspace width="0.166667em"/><mml:mtext>such</mml:mtext><mml:mspace width="4.pt"/><mml:mtext>that</mml:mtext><mml:mspace width="0.166667em"/><mml:mspace width="0.166667em"/><mml:mspace width="0.166667em"/><mml:mspace width="0.166667em"/><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:mi>m</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mo>&#x000b7;</mml:mo><mml:mo>)</mml:mo></mml:mrow><mml:mo>&#x02260;</mml:mo><mml:msub><mml:mi>f</mml:mi><mml:mrow><mml:mi>g</mml:mi><mml:mo>,</mml:mo><mml:msup><mml:mi>m</mml:mi><mml:mo>&#x02032;</mml:mo></mml:msup></mml:mrow></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mo>&#x000b7;</mml:mo><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives><label>(2.1)</label></disp-formula>
</p><p>In both case, one model is fitted under the null hypothesis, and one is fitted under the alternative. The likelihood ratio is then computed.</p><p>However, since both fixed and random effects are tested simultaneously in this likelihood ratio, its null distribution is not the standard chi-square distribution (because of boundary constraints due to the variance of random effects). According to Self et al. [<xref rid="pcbi.1004310.ref044" ref-type="bibr">44</xref>], it can be approximated by a mixture of chi-square distributions with the following formula:
<disp-formula id="pcbi.1004310.e012"><alternatives><graphic xlink:href="pcbi.1004310.e012.jpg" id="pcbi.1004310.e012g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M12"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>L</mml:mi><mml:msub><mml:mi>R</mml:mi><mml:msub><mml:mi>H</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:msub><mml:mo>&#x0223c;</mml:mo><mml:munderover><mml:mo>&#x02211;</mml:mo><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>q</mml:mi><mml:mo>+</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:munderover><mml:mo>(</mml:mo><mml:mfrac linethickness="0.0pt"><mml:mi>r</mml:mi><mml:mrow><mml:mi>k</mml:mi><mml:mo>-</mml:mo><mml:mi>q</mml:mi></mml:mrow></mml:mfrac><mml:mo>)</mml:mo><mml:msup><mml:mn>2</mml:mn><mml:mrow><mml:mo>-</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msup><mml:msubsup><mml:mi>&#x003c7;</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mi>k</mml:mi><mml:mo>)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
where <italic>q</italic> is the number of fixed effects and <italic>r</italic> the number of random effects to be tested simultaneously. This approximation implies that the tested random effects are independent of one another [<xref rid="pcbi.1004310.ref045" ref-type="bibr">45</xref>&#x02013;<xref rid="pcbi.1004310.ref047" ref-type="bibr">47</xref>]. This seems an acceptable assumption according to our simulations under the null (see <xref ref-type="supplementary-material" rid="pcbi.1004310.s001">S1</xref> and <xref ref-type="supplementary-material" rid="pcbi.1004310.s002">S2</xref> Figs). This allows to compute a p-value for the significance of the variation of a given gene set over time.</p><p>When several gene sets are investigated at a time, it is necessary to take into account multiple testing. A number of procedures are available to do so [<xref rid="pcbi.1004310.ref048" ref-type="bibr">48</xref>]. As the TcGSA is mostly an exploratory analysis (even though hypothesis driven in the sense that gene set are defined <italic>a priori</italic>), we recommend using the Benjamini-Yekutieli procedure for controlling the False Discovery Rate [<xref rid="pcbi.1004310.ref049" ref-type="bibr">49</xref>], as gene sets are necessarily correlated between each others and this procedure is robust to some of these dependances. Other mutliple testing correction procedures are available in the <italic>TcGSA</italic> R package.</p></sec><sec id="sec006"><title>3. Estimation of individual gene profiles</title><p>In the estimation of linear mixed model, it is common to use the Restricted Maximum Likelihood (REML) instead of the classic Maximum Likelihood (ML) in order to avoid biased estimates of the variance components [<xref rid="pcbi.1004310.ref050" ref-type="bibr">50</xref>]. But note that REML cannot be used to estimate the likelihood ratios presented here. Indeed, REML estimation of the likelihood ratio between two models can only be used when both models have the same fixed part [<xref rid="pcbi.1004310.ref051" ref-type="bibr">51</xref>]. Since here the compared models (under H<sub>0</sub> and under H<sub>1</sub>) have different fixed components (due to the <italic>&#x003b7;</italic>
<sub>&#x022c5;</sub> coefficients under H<sub>1</sub>), the use of ML estimation is needed.</p><p>For the inference of the random effects, Best Linear Unbiased Predictor (BLUP) are used [<xref rid="pcbi.1004310.ref052" ref-type="bibr">52</xref>], giving access to estimations of a single profile for each gene among a gene set, in each patient. As a result, the estimations from the mixed model are shrunken towards the average expression inside the gene set. This shrinkage occurs when the residuals variability is relatively large compared to the the random effects estimated variances [<xref rid="pcbi.1004310.ref052" ref-type="bibr">52</xref>]. The mixed model uses the repeated pattern of the longitudinal measurements to structure the variation. Its estimations give smoother trajectories for the genes than the raw data, which makes the general evolution of the set clearer [<xref rid="pcbi.1004310.ref053" ref-type="bibr">53</xref>], as it can be seen in Figs <xref ref-type="fig" rid="pcbi.1004310.g003">3</xref> and <xref ref-type="fig" rid="pcbi.1004310.g004">4</xref>.</p><fig id="pcbi.1004310.g003" orientation="portrait" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1004310.g003</object-id><label>Fig 3</label><caption><title>Three significant gene sets during pre-ATI in DALIA-1.</title><p>Each line is the median over the patients of the expression of one gene. Each graph shows all the genes in one particular gene set. The left graph displays the raw gene expression, the right one displays the estimations from the mixed model for the same gene set. The expressions have been centered and reduced for this representation.</p></caption><graphic xlink:href="pcbi.1004310.g003"/></fig><fig id="pcbi.1004310.g004" orientation="portrait" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1004310.g004</object-id><label>Fig 4</label><caption><title>Ten significant gene sets during post-ATI in DALIA-1.</title><p>Each line is the median over the patients of the expression of one gene. Each graph shows all the genes in one particular gene set. The left graph displays the raw gene expression, the right one displays the estimations from the mixed model for the same gene set. If several dynamics are identified by the gap statistics among the estimated expressions inside one gene set, they are displayed in different colors&#x02014;such as for the gene sets M 4.16 and M 7.1 that each features three different dynamics. The expressions have been centered and reduced for this representation.</p></caption><graphic xlink:href="pcbi.1004310.g004"/></fig></sec></sec><sec id="sec007"><title>Characterization and visualization of dynamics</title><sec id="sec008"><title>Dynamic of a significant gene set</title><p>Once a gene set <italic>S</italic> has been identified as significant through the previous mixed likelihood ratio statistics, a summary of its dynamic over time is needed. However, due to the possible heterogeneity of <italic>S</italic>, giving a summary representation of <italic>S</italic> dynamic is not obvious. We propose to automatically identify the number of trends in a significant gene set from the fit of the model. Predicted gene expressions from the linear mixed model are clustered, and the optimal number of trends is selected with the gap statistic [<xref rid="pcbi.1004310.ref054" ref-type="bibr">54</xref>]. It is a formalization of the elbow criterion for the within-cluster variance. In order to determine the optimal partition of each gene set here, the gap statistics is applied onto a hierarchical clustering of gene expressions inside each gene set. Then the median within each of the identified clusters can summarize each trend. Therefore, gene sets are actually split when heterogeneous, before being summarized. The predicted gene expression from the linear mixed model is used for this (and not the observed expression) because smoothness of trajectories facilitates classification [<xref rid="pcbi.1004310.ref053" ref-type="bibr">53</xref>]. Examples of such representations are given in Figs <xref ref-type="fig" rid="pcbi.1004310.g003">3</xref> and <xref ref-type="fig" rid="pcbi.1004310.g004">4</xref>.</p></sec><sec id="sec009"><title>Global dynamics</title><p>Most often, TcGSA will be used to investigate a large number of gene sets (from a few hundreds to a few thousands). This multiplicity can make visualization of the results more challenging, in addition of requiring a multiple testing correction. TcGSA is designed to identify gene sets that shows a simultaneous evolution of gene expression, but possibly of a small intensity. The method can therefore be quite sensitive, and it can be of interest to rank the significant gene sets to identify the most acute signals. The likelihood ratio provides insight on the magnitude of the variation of each gene set. The percentile of their corresponding likelihood ratio gives an idea of the importance of the variation for a significant gene set. Examples of such representations are given in <xref ref-type="fig" rid="pcbi.1004310.g005">Fig 5</xref>.</p><fig id="pcbi.1004310.g005" orientation="portrait" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1004310.g005</object-id><label>Fig 5</label><caption><title>Heatmap of estimated dynamics from the significant gene sets among the 62 investigated gene sets when comparing vaccines arms to placebo arm.</title><p>The median estimated gene expression over the patients is used for each trend. Each trend has seen its values reduced (so that its variance is 1) in order to make the dynamics more comparable. Each row is a group of gene having the same trend inside a gene set, and each column is a time point. The color key represents the median of the standardized estimation of gene expression over the patients for a given trend in a significant gene set. It becomes red as median expression is up-regulated or blue as it is down-regulated compared to the value in the placebo (saline) at the same time. A and C show the hierarchically clustered trends for pneumoccocal and flu respectively. B and D show the same trends but instead ranked by decreasing likelihood ratio percentiles of the associated gene set, for pneumoccocal and flu respectively.</p></caption><graphic xlink:href="pcbi.1004310.g005"/></fig></sec></sec><sec id="sec010"><title>Implementation</title><p>The TcGSA method has been implemented in R as a package <italic>TcGSA</italic>, whose latest release is available from the CRAN repository (<ext-link ext-link-type="uri" xlink:href="http://cran.r-project.org/web/packages/TcGSA/index.html">http://cran.r-project.org/web/packages/TcGSA/index.html</ext-link>).</p></sec></sec><sec sec-type="results" id="sec011"><title>Results</title><sec id="sec012"><title>Motivating example: The DALIA-1 trial</title><p>The DALIA-1 trial is a phase 1 therapeutic HIV vaccine trial whose details are described on <ext-link ext-link-type="uri" xlink:href="http://clinicaltrials.gov">http://clinicaltrials.gov</ext-link> (ClinicalTrial.gov identifier: NCT00796770) and in [<xref rid="pcbi.1004310.ref005" ref-type="bibr">5</xref>]. The vaccine candidate was based on ex-vivo generated interferon-<italic>&#x003b1;</italic> dendritic cells loaded with HIV-1 lipopeptides and activated with lipopolysaccharide. The objectives of the trial were to evaluate the safety of the strategy and to evaluate the immune response to the vaccine. For the purpose of the present paper, we focus on the gene expression component of this study. Gene abundance in whole blood was measured through Illumina HumanHT-12 v4 Expression BeadChips.</p><sec id="sec013"><title>The DALIA-1 trial design</title><p>All of the nineteen HIV infected patients received the therapeutic vaccine while under antiretroviral treatment. The patients received four injections at week 0, 4, 8 and 12. This vaccination period was followed by an antiretroviral treatment interruption (ATI) at week 24. The patients were followed up to week 48. Antiretroviral treatment was resumed from week 24 to week 48 at any time under the following criteria: i) if the patients or their doctors wished so; ii) if CD4+ T-cell count was &#x0003c; 350 cells/<italic>&#x003bc;</italic>L and &#x0003c; 25% of total lymphocytes. Fourteen time points (five in pre-ATI from week 0 to week 22, and nine in post-ATI from week 24 to week 44) were used for this analysis (see <xref ref-type="fig" rid="pcbi.1004310.g006">Fig 6</xref>). One patient was removed from the analysis as his/her antiretroviral treatment compliance was irregular during the vaccination phase.</p><fig id="pcbi.1004310.g006" orientation="portrait" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1004310.g006</object-id><label>Fig 6</label><caption><title>DALIA-1 trial design.</title><p>Gene expression was measured at each time point, represented by a week number above the time axis. The trial was composed of two separated stages: (1) the treatment phase, during which the patients were vaccinated but remained under antiretroviral treatment; and(2) the follow- up phase commencing after the week 24 antiretroviral treatment interruption. Those two phases will be referred as pre-ATI and post-ATI respectively. The three apheresis time points were removed from the analysis due to a possible effect of the apheresis on the gene expression samples, and so was the first measurement (week -8) occurring right at the inclusion in the study.</p></caption><graphic xlink:href="pcbi.1004310.g006"/></fig><p>In the following analysis, two distinct datasets were considered: pre-ATI and post-ATI. The two datasets were normalized separately&#x02014;via a normal-exponential convolution model [<xref rid="pcbi.1004310.ref055" ref-type="bibr">55</xref>, <xref rid="pcbi.1004310.ref056" ref-type="bibr">56</xref>], followed by the application of the <italic>ComBat</italic> method [<xref rid="pcbi.1004310.ref057" ref-type="bibr">57</xref>] to correct for batch effects. Splitting the data allows us to study separately the vaccine effect and the treatment interruption, otherwise the ATI effect would mask any noticeable vaccine effect, because of the huge modification of gene expression related to viral replication [<xref rid="pcbi.1004310.ref001" ref-type="bibr">1</xref>, <xref rid="pcbi.1004310.ref002" ref-type="bibr">2</xref>]. We investigated the gene sets defined by Chaussabel et al. [<xref rid="pcbi.1004310.ref013" ref-type="bibr">13</xref>], which are oriented towards the immune system. The definition and annotations of those 260 gene sets (called &#x02018;Modules&#x02019;) are available online (<ext-link ext-link-type="uri" xlink:href="http://www.biir.net/public_wikis/module_annotation/V2_Trial_8_Modules">http://www.biir.net/public_wikis/module_annotation/V2_Trial_8_Modules</ext-link>).</p></sec><sec id="sec014"><title>Pre-ATI: The vaccination phase</title><p>During the vaccination period, a standard gene-by-gene mixed model analysis, with a cubic polynomial function of time, did not found any significant change of gene abundance at a 5% False Discovery Rate (see <xref rid="pcbi.1004310.t001" ref-type="table">Table 1</xref>). However, during this vaccination phase, cytokines production analysis of the same blood samples (as measured by Luminex or intracellular staining) have showed that a response was induced by the vaccine at week 16 [<xref rid="pcbi.1004310.ref005" ref-type="bibr">5</xref>]. Therefore, one expected to observe a signal at the gene expression level between week 0 and week 16, the gene expression preceding molecular activation. Although the measurements were not performed in the hours or days following vaccination, the changes of gene abundance may reflect a change of the equilibrium of the overall expression in some gene sets. This kind of results has already been reported in cross-sectional studies [<xref rid="pcbi.1004310.ref058" ref-type="bibr">58</xref>]. Likewise, GSEA for time-series did not identify any significant gene set during vaccination. This can be explained by the lack of power of GSEA for time-series, as this method does not take into account the repeated structure of the data and is not suitable for longitudinal measurements. Finally, CAMERA did not identified any significant gene set either, in spite of testing a competitive null hypothesis.</p><table-wrap id="pcbi.1004310.t001" orientation="portrait" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1004310.t001</object-id><label>Table 1</label><caption><title>Number of significant units in DALIA-1 at a FDR of 5%.</title></caption><alternatives><graphic id="pcbi.1004310.t001g" xlink:href="pcbi.1004310.t001"/><table frame="box" rules="all" border="0"><colgroup span="1"><col align="left" valign="top" span="1"/><col align="left" valign="top" span="1"/><col align="left" valign="top" span="1"/><col align="left" valign="top" span="1"/></colgroup><thead><tr><th align="left" rowspan="1" colspan="1"/><th align="left" rowspan="1" colspan="1">Pre-ATI</th><th align="left" rowspan="1" colspan="1">Post-ATI</th><th align="left" rowspan="1" colspan="1">Units</th></tr></thead><tbody><tr><td align="left" rowspan="1" colspan="1">Gene-by-gene</td><td align="left" rowspan="1" colspan="1">0</td><td align="left" rowspan="1" colspan="1">3,389</td><td align="left" rowspan="1" colspan="1">probes <xref ref-type="table-fn" rid="t001fn001">
<sup>a</sup>
</xref>
</td></tr><tr><td align="left" rowspan="1" colspan="1">GSEA for time series</td><td align="left" rowspan="1" colspan="1">0</td><td align="left" rowspan="1" colspan="1">67</td><td align="left" rowspan="1" colspan="1">genes set <xref ref-type="table-fn" rid="t001fn002">
<sup>b</sup>
</xref>
</td></tr><tr><td align="left" rowspan="1" colspan="1">CAMERA</td><td align="left" rowspan="1" colspan="1">0</td><td align="left" rowspan="1" colspan="1">2</td><td align="left" rowspan="1" colspan="1">genes set <xref ref-type="table-fn" rid="t001fn002">
<sup>b</sup>
</xref>
</td></tr><tr><td align="left" rowspan="1" colspan="1">TcGSA linear</td><td align="left" rowspan="1" colspan="1">23</td><td align="left" rowspan="1" colspan="1">203</td><td align="left" rowspan="1" colspan="1">gene sets <xref ref-type="table-fn" rid="t001fn002">
<sup>b</sup>
</xref>
</td></tr><tr><td align="left" rowspan="1" colspan="1">TcGSA cubic polynom.</td><td align="left" rowspan="1" colspan="1">69</td><td align="left" rowspan="1" colspan="1">216</td><td align="left" rowspan="1" colspan="1">gene sets <xref ref-type="table-fn" rid="t001fn002">
<sup>b</sup>
</xref>
</td></tr><tr><td align="left" rowspan="1" colspan="1">TcGSA splines</td><td align="left" rowspan="1" colspan="1">68</td><td align="left" rowspan="1" colspan="1">219</td><td align="left" rowspan="1" colspan="1">gene sets <xref ref-type="table-fn" rid="t001fn002">
<sup>b</sup>
</xref>
</td></tr></tbody></table></alternatives><table-wrap-foot><fn id="t001fn001"><p>
<sup>a</sup> 32,978 probes investigated after filtering</p></fn><fn id="t001fn002"><p>
<sup>b</sup> 260 immune-related gene sets investigated (29 gene sets were automatically discarded because less than 10 probes were observed)</p></fn></table-wrap-foot></table-wrap><p>We applied the Time Course Gene set Analysis (see <xref ref-type="sec" rid="sec002">Methods</xref>) that allows to detect any change over time of gene abundance inside a gene set by detecting either trends over time or heterogeneity between gene dynamics. Fitting the <xref ref-type="disp-formula" rid="pcbi.1004310.e001">Eq (1)</xref> with a cubic polynomial function of time, 69 gene sets out of 260 turned out to vary significantly. <xref ref-type="fig" rid="pcbi.1004310.g003">Fig 3</xref> displays the raw sample-normalized and batch-corrected) and estimated gene expressions of 3 of the significant gene sets identified by TcGSA: T-cell, inflammation and B-cell gene sets. The identification of gene sets such as M4.1: T-cell (that includes CD402, CCR7, BCl2) was expected with regards to the CD4 T-cell response observed at Week 16 [<xref rid="pcbi.1004310.ref005" ref-type="bibr">5</xref>]. Also, the gene sets M4.6: inflammation and M6.7: B-cell are good examples of how smoothing from the estimations can give a much clearer dynamic pattern compared to the raw expression (see <xref ref-type="sec" rid="sec002">Methods</xref>).</p></sec><sec id="sec015"><title>Post-ATI: After antiretroviral treatment interruption</title><p>
<xref ref-type="disp-formula" rid="pcbi.1004310.e001">Eq (1)</xref> was then fitted to the data after antiretroviral treatment interruption that occurred at week 24: 216 gene sets out of 260 were found to be significant with a cubic polynomial function of time. <xref ref-type="fig" rid="pcbi.1004310.g004">Fig 4</xref> displays the raw and estimated expressions of nine of those significant gene sets. It features heterogeneous gene sets, such as M4.16 and M7.1, which are both also good examples of the shrinkage that occurs with the estimations (see <xref ref-type="sec" rid="sec002">Methods</xref>). Meanwhile, GSEA for time series identifies 67 significant, whereas CAMERA identified only 2. These results are consistent with the lower statistical power found in our simulation study.</p><p>The large number of significant gene sets post-ATI illustrates the tremendous impact of the treatment interruption on the organism. Followed by a viral rebound, the treatment interruption is indeed a major event that triggers the expression of thousand of genes. Indeed, a gene-by-gene analysis revealed 3,389 significant probes (more than 10% of all the investigated probes&#x02014;an unusually high number of differentially expressed genes). The immune system is very much in demand during the viral rebound. Therefore most of the gene sets from the Modules defined by Chaussabel et al. [<xref rid="pcbi.1004310.ref013" ref-type="bibr">13</xref>] are activated, as they are tightly linked with the immune system activity. Of particular interest are the three gene sets M1.2, M3.4 and M5.12 which are all annotated as <italic>interferon</italic>-related. These three gene sets exhibit similar dynamics (see <xref ref-type="fig" rid="pcbi.1004310.g004">Fig 4</xref>). Such a timely upregulation was expected, as it is associated to the viral rebound after treatment interruption and was previously reported [<xref rid="pcbi.1004310.ref001" ref-type="bibr">1</xref>, <xref rid="pcbi.1004310.ref002" ref-type="bibr">2</xref>]. The gene set M3.4 is also linked with <italic>antiviral response</italic>.</p></sec></sec><sec id="sec016"><title>Another application: Influenza and pneumococcal vaccines responses</title><p>In a recent paper, Obermoser et al. [<xref rid="pcbi.1004310.ref006" ref-type="bibr">6</xref>] investigated the response to influenza and pneumococcal vaccines in healthy individuals at the gene expression level.</p><sec id="sec017"><title>Study design</title><p>Healthy, young adults were randomly split in three groups of six volunteers each, receiving either a 2009&#x02013;2010 seasonal influenza vaccine (Fluzone), a 23-valent pneumococcal vaccine (Pneumovax23), or a placebo (saline injections). Blood samples were collected at days -7, 0, 1, 3, 7, 10, 14, 21, and 28 to measure gene expression in whole blood. A more detailed description of the study can be found in Obermoser et al. [<xref rid="pcbi.1004310.ref006" ref-type="bibr">6</xref>].</p></sec><sec id="sec018"><title>Original analysis</title><p>In their modular analysis, Obermoser et al. [<xref rid="pcbi.1004310.ref006" ref-type="bibr">6</xref>] focused on 62 of the 260 available gene sets defined in Chaussabel et al. [<xref rid="pcbi.1004310.ref013" ref-type="bibr">13</xref>]. They investigated the changes of gene expression in those 62 gene sets for each of the seven time points from day 1 to day 28 in regards of the baseline, that was considered as the average of the two measurements at days -7 and 0. So hierarchical structure of the data was not taken into account. The three arms (saline, flu and pneumococcal) were analyzed separately, and only significant gene sets at day 1 and day 7 (not further on) are presented in their paper. Changes in eight gene sets were common to both vaccines: M4.6 (inflammation), M6.6 and M6.13 (apoptosis/cell death) and modules M4.1 and M4.15 (T cells), M4.3 (protein synthesis), M5.11, and M6.9 (no functional annotation). Nine gene sets were uniquely changing after the influenza vaccine, three were associated with antiviral responses (M1.2, M3.4, M5.12) and included genes coding for interferon (IFN)-inducible molecules. Six gene sets were uniquely responsive to the pneumococcal vaccine. Of these, five were modules including genes associated with inflammation: M3.2, M4.2, M4.13, M5.1 and M5.7.</p></sec><sec id="sec019"><title>TcGSA results</title><p>To compare the gene expression at the gene set level between the vaccine arm (flu or pneumococcal) and the placebo (saline) arm, we applied TcGSA on these data using <xref ref-type="disp-formula" rid="pcbi.1004310.e007">Eq (2)</xref> (for each vaccine separately). In both vaccines, a large response is observed at Day 1. To avoid smoothing down the expression at <italic>t</italic>
<sub><italic>i</italic></sub> = 1, we used the following function of time to model the dynamic evolution of gene expression:
<disp-formula id="pcbi.1004310.e013"><alternatives><graphic xlink:href="pcbi.1004310.e013.jpg" id="pcbi.1004310.e013g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M13"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>f</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mo>=</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mi>&#x003b7;</mml:mi><mml:mi>m</mml:mi></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mo>&#x1d7d9;</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:msubsup><mml:mi>&#x003b7;</mml:mi><mml:mi>m</mml:mi><mml:mo>&#x02032;</mml:mo></mml:msubsup><mml:mo>+</mml:mo><mml:msubsup><mml:mi>h</mml:mi><mml:mi>g</mml:mi><mml:mo>&#x02032;</mml:mo></mml:msubsup><mml:mo>)</mml:mo></mml:mrow><mml:msub><mml:mo>&#x1d7d9;</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>&#x02260;</mml:mo><mml:mn>1</mml:mn><mml:mo>}</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
with <inline-formula id="pcbi.1004310.e014"><alternatives><graphic xlink:href="pcbi.1004310.e014.jpg" id="pcbi.1004310.e014g" mimetype="image" position="anchor" orientation="portrait"/><mml:math id="M14"><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>h</mml:mi><mml:mi>g</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mi>h</mml:mi><mml:mi>g</mml:mi><mml:mo>&#x02032;</mml:mo></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>&#x0223c;</mml:mo><mml:mo>&#x1d4dd;</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>&#x003a3;</mml:mi><mml:mi>h</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, and <italic>m</italic> the group (either vaccine or placebo).</p><p>Most of the 62 investigated gene sets presented a significantly different evolution in vaccine arms compared to the placebo arm. Globally, the intensity of the response was stronger with the pneumoccocal vaccine than with the flu vaccine (<xref ref-type="fig" rid="pcbi.1004310.g005">Fig 5</xref>). The early response induced by the pneumococcal vaccine was dominated by inflammation whereas the top signal triggered by the flu vaccine involved an interferon signature (Fig <xref ref-type="fig" rid="pcbi.1004310.g005">5B</xref> and <xref ref-type="fig" rid="pcbi.1004310.g005">5D</xref>). In both vaccine, a T-cell response was also visible. In the pneumoccocal vaccine, a plasma cell signal, in association with cell cycle gene sets (Figs <xref ref-type="fig" rid="pcbi.1004310.g005">5A</xref> and <xref ref-type="fig" rid="pcbi.1004310.g005">5C</xref>), started at Day 7 until Day 14. This plasma blast signal was much less clear in the flu vaccine (Figs <xref ref-type="fig" rid="pcbi.1004310.g005">5B</xref> and <xref ref-type="fig" rid="pcbi.1004310.g005">5D</xref>). This is in agreement with the results of Obermoser et al. modular analysis.</p><p>TcGSA offers an extended and appropriate hierarchical analysis of these data. It provides a truly longitudinal insight into the vaccine responses, that are intrinsically compared to the placebo response. One of the main difference from the results presented in Obermoser et al. paper [<xref rid="pcbi.1004310.ref006" ref-type="bibr">6</xref>] is that, according to our analysis, the inflammation gene sets (M3.2, M4.13, M5.1 and M5.7) were also involved with the flu vaccine and were not specific to the pneumoccocal vaccine. This result is important as it means that both vaccine involved these inflammatory pathways. This result was not obvious from the original analysis because their approach was less powerful compared to TcGSA.</p></sec></sec><sec id="sec020"><title>Assessment of statistical performances on simulated data</title><p>In order to assess the behavior of the proposed method, a simulation study of TcGSA has been performed. The simulation scheme was chosen to be very close to the motivating exemple: the DALIA-1 trial. In each simulation run, gene expression data was simulated for 20 patients at 8 time points. 5,000 genes were simulated, divided into 100 non overlapping gene sets of 50 genes each. Each of the 100 gene sets was either simulated under (H<sub>0</sub>) or (H<sub>1</sub>). The proportion of genes under (H<sub>1</sub>) varied between 0%, 27% (which corresponds to results found in pre-ATI) and 85% (which corresponds to results found in post-ATI). When there are gene sets simulated under (H<sub>1</sub>), 75% of those were homogeneous (simulated with parameters close to those estimated for gene set M1.2 in DALIA post-ATI&#x02014;see <xref ref-type="fig" rid="pcbi.1004310.g004">Fig 4</xref>) while the remaining 25% were heterogeneous (simulated with parameters close to those estimated for gene set M7.1 in DALIA post-ATI&#x02014;see <xref ref-type="fig" rid="pcbi.1004310.g004">Fig 4</xref>).</p><p>Statistical performances of the proposed method are presented in <xref rid="pcbi.1004310.t002" ref-type="table">Table 2</xref>. Without correcting for the fact that 100 gene set were investigated by TcGSA at each simulation runs, the average Type I error (the probability of rejecting H<sub>0</sub> given that H<sub>0</sub> is actually true) over a hundred runs was between 0.03 and 0.07 depending on the situation. But as soon as a control of the FDR was used, the Type-I error rate dropped well below 1%, regardless of the flexibility of the time function estimated (linear or cubic polynomials). The average statistical power (the probability of rejecting H<sub>0</sub> given that H<sub>0</sub> is actually false) is very good, always above 0.8 (dropping a little bit after multiple testing correction as expected).</p><table-wrap id="pcbi.1004310.t002" orientation="portrait" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1004310.t002</object-id><label>Table 2</label><caption><title>Assessment of statistical performances through a simulation study.</title></caption><alternatives><graphic id="pcbi.1004310.t002g" xlink:href="pcbi.1004310.t002"/><table frame="box" rules="all" border="0"><colgroup span="1"><col align="left" valign="top" span="1"/><col align="left" valign="top" span="1"/><col align="left" valign="top" span="1"/><col align="left" valign="top" span="1"/><col align="left" valign="top" span="1"/><col align="left" valign="top" span="1"/></colgroup><thead><tr><th align="left" rowspan="1" colspan="1">Percentage of simulated gene sets under H<sub>1</sub>
</th><th align="left" rowspan="1" colspan="1">Method</th><th align="left" rowspan="1" colspan="1">Type I error</th><th align="left" rowspan="1" colspan="1">Type I error after MTC<xref ref-type="table-fn" rid="t002fn001">*</xref>
</th><th align="left" rowspan="1" colspan="1">Statistical power</th><th align="left" rowspan="1" colspan="1">Statistical power after MTC<xref ref-type="table-fn" rid="t002fn001">*</xref>
</th></tr></thead><tbody><tr><td align="left" rowspan="1" colspan="1">0%</td><td align="left" rowspan="1" colspan="1">TcGSA (linear)</td><td align="left" rowspan="1" colspan="1">0.0394</td><td align="left" rowspan="1" colspan="1">0.0002</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td></tr><tr><td align="left" rowspan="1" colspan="1">0%</td><td align="left" rowspan="1" colspan="1">TcGSA (cubic)</td><td align="left" rowspan="1" colspan="1">0.0649</td><td align="left" rowspan="1" colspan="1">0.0004</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td></tr><tr><td align="left" rowspan="1" colspan="1">0%</td><td align="left" rowspan="1" colspan="1">globalANCOVA (perm)</td><td align="left" rowspan="1" colspan="1">0.0483</td><td align="left" rowspan="1" colspan="1">0.0001</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td></tr><tr><td align="left" rowspan="1" colspan="1">0%</td><td align="left" rowspan="1" colspan="1">globalANCOVA (approx)</td><td align="left" rowspan="1" colspan="1">0.0006</td><td align="left" rowspan="1" colspan="1">0</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td></tr><tr><td align="left" rowspan="1" colspan="1">0%</td><td align="left" rowspan="1" colspan="1">GSEA for time series</td><td align="left" rowspan="1" colspan="1">0</td><td align="left" rowspan="1" colspan="1">0</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td></tr><tr><td align="left" rowspan="1" colspan="1">0%</td><td align="left" rowspan="1" colspan="1">CAMERA</td><td align="left" rowspan="1" colspan="1">0</td><td align="left" rowspan="1" colspan="1">0</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td></tr><tr><td align="left" rowspan="1" colspan="1">27%</td><td align="left" rowspan="1" colspan="1">TcGSA (linear)</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.883</td><td align="char" char="." rowspan="1" colspan="1">0.829</td></tr><tr><td align="left" rowspan="1" colspan="1">27%</td><td align="left" rowspan="1" colspan="1">TcGSA (cubic)</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.882</td><td align="char" char="." rowspan="1" colspan="1">0.810</td></tr><tr><td align="left" rowspan="1" colspan="1">27%</td><td align="left" rowspan="1" colspan="1">globalANCOVA (perm)</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.787</td><td align="char" char="." rowspan="1" colspan="1">0.706</td></tr><tr><td align="left" rowspan="1" colspan="1">27%</td><td align="left" rowspan="1" colspan="1">globalANCOVA (approx)</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.660</td><td align="char" char="." rowspan="1" colspan="1">0.510</td></tr><tr><td align="left" rowspan="1" colspan="1">27%</td><td align="left" rowspan="1" colspan="1">GSEA for time series</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.459</td><td align="char" char="." rowspan="1" colspan="1">0.214</td></tr><tr><td align="left" rowspan="1" colspan="1">27%</td><td align="left" rowspan="1" colspan="1">CAMERA</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.374</td><td align="char" char="." rowspan="1" colspan="1">0.109</td></tr><tr><td align="left" rowspan="1" colspan="1">85%</td><td align="left" rowspan="1" colspan="1">TcGSA (linear)</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.885</td><td align="char" char="." rowspan="1" colspan="1">0.847</td></tr><tr><td align="left" rowspan="1" colspan="1">85%</td><td align="left" rowspan="1" colspan="1">TcGSA (cubic)</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.882</td><td align="char" char="." rowspan="1" colspan="1">0.833</td></tr><tr><td align="left" rowspan="1" colspan="1">85%</td><td align="left" rowspan="1" colspan="1">globalANCOVA (perm)</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.785</td><td align="char" char="." rowspan="1" colspan="1">0.728</td></tr><tr><td align="left" rowspan="1" colspan="1">85%</td><td align="left" rowspan="1" colspan="1">globalANCOVA (approx)</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.660</td><td align="char" char="." rowspan="1" colspan="1">0.549</td></tr><tr><td align="left" rowspan="1" colspan="1">85%</td><td align="left" rowspan="1" colspan="1">GSEA for time series</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.289</td><td align="char" char="." rowspan="1" colspan="1">0.074</td></tr><tr><td align="left" rowspan="1" colspan="1">85%</td><td align="left" rowspan="1" colspan="1">CAMERA</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="char" char="." rowspan="1" colspan="1">0.177</td><td align="char" char="." rowspan="1" colspan="1">0.013</td></tr></tbody></table></alternatives><table-wrap-foot><fn id="t002fn001"><p>* Multiple Testing Correction: performed via Benjamini-Yekutieli procedure with a 5% threshold.</p></fn><fn id="t002fn002"><p>In each simulation, 100 gene sets are simulated and significance level <italic>&#x003b1;</italic> = 5% is applied. This table displays the Type I error and the statistical power means over a hundred simulation runs for 3 different situations (0%, 27% and 85% of simulated gene sets are simulated under <italic>H</italic>
<sub>1</sub>). Whenever the percentage of gene sets simulated under <italic>H</italic>
<sub>1</sub> is not null, 25% of the gene sets simulated under H<sub>1</sub> are heterogeneous, the remaining 75% being homogeneous. Type I error is the probability of rejecting H<sub>0</sub> given that H<sub>0</sub> is true, i.e. for declaring a gene set significant when it actually is not. Statistical power is the probability of rejecting H<sub>0</sub> given that H<sub>1</sub> is true, i.e. for declaring a gene set significant when it actually is. Four methods are evaluated: i) TcGSA, the proposed approach, fitted either with a linear or with a cubic function of time; ii) the GlobalANCOVA procedure [<xref rid="pcbi.1004310.ref029" ref-type="bibr">29</xref>] in which p-values are either computed by permutation (10,000) or approximated; iii) the GSEA for time series [<xref rid="pcbi.1004310.ref014" ref-type="bibr">14</xref>], iv) CAMERA [<xref rid="pcbi.1004310.ref031" ref-type="bibr">31</xref>]. Default values are used for the various methods (see <xref ref-type="supplementary-material" rid="pcbi.1004310.s006">S1 Text</xref> and <xref ref-type="supplementary-material" rid="pcbi.1004310.s007">S1 Software</xref>).</p></fn></table-wrap-foot></table-wrap><p>Three other methods were also evaluated on those simulations, namely globalANCOVA [<xref rid="pcbi.1004310.ref029" ref-type="bibr">29</xref>] (using either permutations or an approximation to compute p-values), GSEA for time series and CAMERA. Their statistical performances are also presented in <xref rid="pcbi.1004310.t002" ref-type="table">Table 2</xref>. Type I error is always well controlled by those three methods. However, both CAMERA and GSEA for time series exhibit very low statistical power (as low as 10 times less than TcGSA after multiple testing correction when there is a high proportion of significant gene sets). globalANCOVA, whose global null hypothesis is not so different from the one tested in TcGSA, performs quite well in terms of statistical power. Nonetheless it is still about 10% below TcGSA performances.</p><p>Those simulation results confirm that the higher number of selected gene sets by TcGSA in the two real-life examples presented in this paper are mainly due to the increased power of gene set analysis over gene-by-gene analysis (when repeated structure of the measurement is properly accounted for), and not to a large number of false positives.</p></sec></sec><sec sec-type="conclusions" id="sec021"><title>Discussion</title><p>In this paper, we present a method to analyze repeated measurements of gene expression using a gene set approach. Provided that the definition of the gene sets is relevant, this method helps with detecting and interpreting subtle changes of gene expression over time. In our applications where the same definition of gene sets has been applied, we were able to compare the response to several vaccines (against HIV, Influenza and Pneumococcus). Interestingly, we found common pathways that were triggered by all three vaccines, mostly related to inflammation, as well as pathways specific to each vaccine.</p><p>The capacity of the proposed approach to detect subtle changes of gene expression is due to two main factors: i) the use of a predefined gene sets that are functionally related ii) the use of all available information, taking advantage of repeated measurements using mixed models. Measurements of gene expression data in longitudinal studies may be missing because of missed visits or poor quality of the samples, leading to unbalanced data. Missing at random (MAR) processes (i.e. when the probability of missing data is associated to the previously measured information) may lead to biased estimates when using least squares or generalized estimating equations [<xref rid="pcbi.1004310.ref037" ref-type="bibr">37</xref>]. TcGSA can cope with such issues because of the use of Maximum Likelihood to estimate the parameters of the mixed models. This is an advantage of the TcGSA approach over those of Hummel et al. [<xref rid="pcbi.1004310.ref029" ref-type="bibr">29</xref>] or Nueda et al. [<xref rid="pcbi.1004310.ref032" ref-type="bibr">32</xref>].</p><p>An increasing number of gene sets databases are available, such as KEGG [<xref rid="pcbi.1004310.ref011" ref-type="bibr">11</xref>], Gene Ontology [<xref rid="pcbi.1004310.ref012" ref-type="bibr">12</xref>], Modules [<xref rid="pcbi.1004310.ref013" ref-type="bibr">13</xref>]. An immune related subset of Gene Ontology as well as an immune related subset of KEGG pathway have been used in additional analyses (see <xref ref-type="supplementary-material" rid="pcbi.1004310.s003">S3 Fig</xref>). The choice of the database used for the analysis impacts the interpretability but also the limitations of TcGSA. The efficiency of TcGSA will vary according to the number of genes represented in each gene set. The size of a given gene set has an impact on its significance, as the more genes it includes, the more likely a significant variation will be detected. The average size of the Chaussabel&#x02019;s V2 modules is 55 genes. 17% of the 260 modules include more than 100 genes, and 31% less than 20 genes. For small gene sets, the normality assumptions of random effects of the Eqs (<xref ref-type="disp-formula" rid="pcbi.1004310.e001">1</xref>), (<xref ref-type="disp-formula" rid="pcbi.1004310.e004">1bis</xref>) and (<xref ref-type="disp-formula" rid="pcbi.1004310.e007">2</xref>) are questionable (even though inference should still be robust [<xref rid="pcbi.1004310.ref059" ref-type="bibr">59</xref>]). Nevertheless, even though we expect that the models could be misspecified in many cases (if not all), the objective of such an analysis is to detect any significant variation over time (in the spirit of Shahbaba et al. [<xref rid="pcbi.1004310.ref019" ref-type="bibr">19</xref>], a significant variability of the trajectories between the genes inside a gene set indicates a change over time regardless of the fixed effects specification). The use of flexible time functions may help to get a better fit of dynamics although beyond cubic polynomials it did not have a substantial impact in our motivating example&#x02014;see <xref rid="pcbi.1004310.t001" ref-type="table">Table 1</xref>. These results vary according to the dataset and the number of time points available, and we recommend to try several models to check the robustness of the results.</p><p>TcGSA focuses on self-contained hypothesis. While competitive gene sets tests are appropriate in the presence of a strong signal (e.g. when comparing pre-ATI versus post-ATI), self-contained approaches are able to detect more subtle and sparse signals (e.g in pre-ATI). The choice between a competitive or a self-contained approach is therefore highly dependent on the biological question.</p><p>Several extensions of the TcGSA are possible for its use in other contexts. One can also model time trends with a random effect grouped on the patient level as of <italic>&#x003b3;</italic>
<sub><italic>p</italic>,&#x022c5;</sub>, instead of on the gene level as in Eqs (<xref ref-type="disp-formula" rid="pcbi.1004310.e001">1</xref>), (<xref ref-type="disp-formula" rid="pcbi.1004310.e004">1bis</xref>) and (<xref ref-type="disp-formula" rid="pcbi.1004310.e007">2</xref>). This identifies gene sets whose dynamic differs across the patients. This option is also implemented in the <italic>TcGSA</italic> R package. TcGSA could easily be adapted to mRNA counts data. In that case, generalized linear mixed effects models could be used, with a Poisson distribution for instance, instead of linear mixed effect models that rely on a Gaussian assumption. Or else, precision weights estimated with voom [<xref rid="pcbi.1004310.ref060" ref-type="bibr">60</xref>] could also be used to model the mean-variance relationship while fitting the proposed linear mixed effect directly on log-counts data from RNA-seq, thus taking into account heteroscedasticity.</p><p>In conclusion, the method presented gives a solution for the full exploitation of any repeated measurements of gene expression data based on a gene set analysis where a great sensibility to detect subtle change, while controlling false discovery, is needed.</p></sec><sec sec-type="supplementary-material" id="sec022"><title>Supporting Information</title><supplementary-material content-type="local-data" id="pcbi.1004310.s001"><label>S1 Fig</label><caption><title>Density plot for both the 100,000 simulations under the null and a 100,000 sample of the corresponding <italic>&#x003c7;</italic>
<sup>2</sup> mixture approximation.</title><p>(EPS)</p></caption><media xlink:href="pcbi.1004310.s001.eps"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="pcbi.1004310.s002"><label>S2 Fig</label><caption><title>Quantile-quantile plot comparing the 100,000 simulations under the null to a 100,000 sample of the corresponding <italic>&#x003c7;</italic>
<sup>2</sup> mixture approximation.</title><p>(TIFF)</p></caption><media xlink:href="pcbi.1004310.s002.tiff"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="pcbi.1004310.s003"><label>S3 Fig</label><caption><title>Comparison of TcGSA results on DALIA-1 trial data for the three gene sets databases considered.</title><p>During pre-ATI, 3 out of 75 gene sets were significant in the subset of KEGG, and 0 out of 131 in the subset of GO. During post-ATI, 73 out of 75 gene sets were significant in the subset of KEGG, and 101 out of 131 in the subset of GO. 2 gene sets the subset of KEGG and 20 from the subset of GO were automatically discarded because less than 10 probes or more than 500 probes were observed.</p><p>(TIFF)</p></caption><media xlink:href="pcbi.1004310.s003.tiff"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="pcbi.1004310.s004"><label>S1 Table</label><caption><title>Selected KEGG pathways for investigating DALIA-1.</title><p>Hand picked KEGG pathways [<xref rid="pcbi.1004310.ref011" ref-type="bibr">11</xref>] of interest for investigating DALIA-1 trial data.</p><p>(PDF)</p></caption><media xlink:href="pcbi.1004310.s004.pdf"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="pcbi.1004310.s005"><label>S2 Table</label><caption><title>Selected GO pathways for investigating DALIA-1.</title><p>Hand picked Gene Ontology pathways [<xref rid="pcbi.1004310.ref012" ref-type="bibr">12</xref>] of interest for investigating DALIA-1 trial data.</p><p>(PDF)</p></caption><media xlink:href="pcbi.1004310.s005.pdf"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="pcbi.1004310.s006"><label>S1 Text</label><caption><title>Supporting Information about TcGSA.</title><p>(PDF)</p></caption><media xlink:href="pcbi.1004310.s006.pdf"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="pcbi.1004310.s007"><label>S1 Software</label><caption><title>R files helping to reproduce the results from this article.</title><p>(ZIP)</p></caption><media xlink:href="pcbi.1004310.s007.zip"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="pcbi.1004310.s008"><label>S1 File</label><caption><title>The raw p-value and the adjusted false discovery rate&#x02014;calculated with the Benjamini-Yiekutieli procedure&#x02014;in pre-ATI in the DALIA-1 trial.</title><p>(TXT)</p></caption><media xlink:href="pcbi.1004310.s008.txt"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="pcbi.1004310.s009"><label>S2 File</label><caption><title>The raw p-value and the adjusted false discovery rate&#x02014;calculated with the Benjamini-Yiekutieli procedure&#x02014;in post-ATI in the DALIA-1 trial.</title><p>(TXT)</p></caption><media xlink:href="pcbi.1004310.s009.txt"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="pcbi.1004310.s010"><label>S3 File</label><caption><title>The raw p-value and the adjusted false discovery rate&#x02014;calculated with the Benjamini-Yiekutieli procedure&#x02014;for the pneumoccocal vaccine.</title><p>(TXT)</p></caption><media xlink:href="pcbi.1004310.s010.txt"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material><supplementary-material content-type="local-data" id="pcbi.1004310.s011"><label>S4 File</label><caption><title>The raw p-value and the adjusted false discovery rate&#x02014;calculated with the Benjamini-Yiekutieli procedure&#x02014;for the flu vaccine.</title><p>(TXT)</p></caption><media xlink:href="pcbi.1004310.s011.txt"><caption><p>Click here for additional data file.</p></caption></media></supplementary-material></sec>